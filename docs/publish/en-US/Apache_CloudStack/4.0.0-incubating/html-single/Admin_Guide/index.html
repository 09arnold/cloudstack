<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CloudStack Administrator's Guide</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 2.8" /><meta name="package" content="Apache_CloudStack-Admin_Guide-4.0.0-incubating-en-US-1-" /><meta name="description" content="Administration Guide for CloudStack." /><script type="text/javascript" src="../../../../../toc.js"></script><script type="text/javascript">
              addID('Apache_CloudStack');
              
	      addID('Apache_CloudStack.4.0.0-incubating');
              
              addID('Apache_CloudStack.4.0.0-incubating.books');
	      addID('Apache_CloudStack.4.0.0-incubating.Admin_Guide');
              </script></head><body class="toc_embeded "><div id="tocdiv" class="toc"><iframe id="tocframe" class="toc" src="../../../../toc.html">This is an iframe, to view it upgrade your browser or enable iframe display.</iframe></div><p id="title"><a class="left" href="http://cloudstack.org"><img src="Common_Content/images/image_left.png" alt="Product Site" /></a><a class="right" href="http://docs.cloudstack.org"><img src="Common_Content/images/image_right.png" alt="Documentation Site" /></a></p><div xml:lang="en-US" class="book" id="idm15308352" lang="en-US"><div class="titlepage"><div><div class="producttitle"><span class="productname">Apache CloudStack</span> <span class="productnumber">4.0.0-incubating</span></div><div><h1 id="idm15308352" class="title">CloudStack Administrator's Guide</h1></div><p class="edition">Edition 1</p><div><h3 class="corpauthor">
			<span class="inlinemediaobject"><object data="Common_Content/images/title_logo.svg" type="image/svg+xml"> </object></span>

		</h3></div><div><div xml:lang="en-US" class="authorgroup" lang="en-US"><div class="author"><h3 class="author"><span class="firstname">Apache</span> <span class="surname">CloudStack</span></h3></div></div></div><hr /><div><div id="idp5437592" class="legalnotice"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at
	</div><div class="para">
		http://www.apache.org/licenses/LICENSE-2.0
	</div><div class="para">
		Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
	</div><div class="para">
		Apache CloudStack is an effort undergoing incubation at The Apache Software Foundation (ASF).
	</div><div class="para">
		Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
	</div></div></div><div><div class="abstract"><h6>Abstract</h6><div class="para">
				Administration Guide for CloudStack.
			</div></div></div></div><hr /></div><div class="toc"><dl><dt><span class="chapter"><a href="#concepts">1. Concepts</a></span></dt><dd><dl><dt><span class="section"><a href="#whatis">1.1. What Is CloudStack?</a></span></dt><dt><span class="section"><a href="#feature-overview">1.2. What Can CloudStack Do?</a></span></dt><dt><span class="section"><a href="#deployment-architecture-overview">1.3. Deployment Architecture Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#management-server-overview">1.3.1. Management Server Overview</a></span></dt><dt><span class="section"><a href="#cloud-infrastructure-overview">1.3.2. Cloud Infrastructure Overview</a></span></dt><dt><span class="section"><a href="#networking-overview">1.3.3. Networking Overview</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#cloud-infrastructure-concepts">2. Cloud Infrastructure Concepts</a></span></dt><dd><dl><dt><span class="section"><a href="#about-zones">2.1. About Zones</a></span></dt><dt><span class="section"><a href="#about-pods">2.2. About Pods</a></span></dt><dt><span class="section"><a href="#about-clusters">2.3. About Clusters</a></span></dt><dt><span class="section"><a href="#about-hosts">2.4. About Hosts</a></span></dt><dt><span class="section"><a href="#about-primary-storage">2.5. About Primary Storage</a></span></dt><dt><span class="section"><a href="#about-secondary-storage">2.6. About Secondary Storage</a></span></dt><dt><span class="section"><a href="#about-physical-networks">2.7. About Physical Networks</a></span></dt><dd><dl><dt><span class="section"><a href="#physical-network-configuration-settings">2.7.1. Configurable Characteristics of Physical Networks</a></span></dt><dt><span class="section"><a href="#basic-zone-network-traffic-types">2.7.2. Basic Zone Network Traffic Types</a></span></dt><dt><span class="section"><a href="#basic-zone-guest-ip-addresses">2.7.3. Basic Zone Guest IP Addresses</a></span></dt><dt><span class="section"><a href="#advanced-zone-network-traffic-types">2.7.4. Advanced Zone Network Traffic Types</a></span></dt><dt><span class="section"><a href="#advanced-zone-guest-ip-addresses">2.7.5. Advanced Zone Guest IP Addresses</a></span></dt><dt><span class="section"><a href="#advanced-zone-public-ip-addresses">2.7.6. Advanced Zone Public IP Addresses</a></span></dt><dt><span class="section"><a href="#system-reserved-ip-addresses">2.7.7. System Reserved IP Addresses</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#accounts">3. Accounts</a></span></dt><dd><dl><dt><span class="section"><a href="#accounts-users-domains">3.1. Accounts, Users, and Domains</a></span></dt><dt><span class="section"><a href="#LDAPserver-for-user-authentication">3.2. Using an LDAP Server for User Authentication</a></span></dt><dd><dl><dt><span class="section"><a href="#example-LDAP-configuration-commands">3.2.1. Example LDAP Configuration Commands</a></span></dt><dt><span class="section"><a href="#search-base">3.2.2. Search Base</a></span></dt><dt><span class="section"><a href="#query-filter">3.2.3. Query Filter</a></span></dt><dt><span class="section"><a href="#search-user-bind-dn">3.2.4. Search User Bind DN</a></span></dt><dt><span class="section"><a href="#SSL-keystore-path-and-password">3.2.5. SSL Keystore Path and Password</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#user-services-overview">4. User Services Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#offerings-and-templates">4.1. Service Offerings, Disk Offerings, Network Offerings, and Templates</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ui">5. User Interface</a></span></dt><dd><dl><dt><span class="section"><a href="#log-in">5.1. Log In to the UI</a></span></dt><dd><dl><dt><span class="section"><a href="#end-user-ui-overview">5.1.1. End User's UI Overview</a></span></dt><dt><span class="section"><a href="#root-admin-ui-overview">5.1.2. Root Administrator's UI Overview</a></span></dt><dt><span class="section"><a href="#log-in-root-admin">5.1.3. Logging In as the Root Administrator</a></span></dt><dt><span class="section"><a href="#changing-root-password">5.1.4. Changing the Root Password</a></span></dt></dl></dd><dt><span class="section"><a href="#using-sshkeys">5.2. Using SSH Keys for Authentication</a></span></dt><dd><dl><dt><span class="section"><a href="#create-ssh-template">5.2.1.  Creating an Instance Template that Supports SSH Keys</a></span></dt><dt><span class="section"><a href="#create-ssh-keypair">5.2.2. Creating the SSH Keypair</a></span></dt><dt><span class="section"><a href="#creating-ssh-instance">5.2.3. Creating an Instance</a></span></dt><dt><span class="section"><a href="#logging-in-ssh">5.2.4. Logging In Using the SSH Keypair</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#projects">6. Using Projects to Organize Users and Resources</a></span></dt><dd><dl><dt><span class="section"><a href="#projects-overview">6.1. Overview of Projects</a></span></dt><dt><span class="section"><a href="#configuring-projects">6.2. Configuring Projects</a></span></dt><dd><dl><dt><span class="section"><a href="#set-up-invitations">6.2.1. Setting Up Invitations</a></span></dt><dt><span class="section"><a href="#set-resource-limits-for-projects">6.2.2. Setting Resource Limits for Projects</a></span></dt><dt><span class="section"><a href="#set-projects-creator-permissions">6.2.3. Setting Project Creator Permissions</a></span></dt></dl></dd><dt><span class="section"><a href="#create-new-projects">6.3. Creating a New Project</a></span></dt><dt><span class="section"><a href="#add-members-to-projects">6.4. Adding Members to a Project</a></span></dt><dd><dl><dt><span class="section"><a href="#send-projects-membership-invitation">6.4.1. Sending Project Membership Invitations</a></span></dt><dt><span class="section"><a href="#add-projects-members-from-ui">6.4.2. Adding Project Members From the UI</a></span></dt></dl></dd><dt><span class="section"><a href="#accept-membership-invite">6.5. Accepting a Membership Invitation</a></span></dt><dt><span class="section"><a href="#suspend-project">6.6. Suspending or Deleting a Project</a></span></dt><dt><span class="section"><a href="#use-project-view">6.7. Using the Project View</a></span></dt></dl></dd><dt><span class="chapter"><a href="#provisioning-steps">7. Steps to Provisioning Your Cloud Infrastructure</a></span></dt><dd><dl><dt><span class="section"><a href="#provisioning-steps-overview">7.1. Overview of Provisioning Steps</a></span></dt><dt><span class="section"><a href="#zone-add">7.2. Adding a Zone</a></span></dt><dd><dl><dt><span class="section"><a href="#basic-zone-configuration">7.2.1. Basic Zone Configuration</a></span></dt><dt><span class="section"><a href="#advanced-zone-configuration">7.2.2. Advanced Zone Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#pod-add">7.3. Adding a Pod</a></span></dt><dt><span class="section"><a href="#cluster-add">7.4. Adding a Cluster</a></span></dt><dd><dl><dt><span class="section"><a href="#add-clusters-kvm-xenserver">7.4.1. Add Cluster: KVM or XenServer</a></span></dt><dt><span class="section"><a href="#add-clusters-vsphere">7.4.2. Add Cluster: vSphere</a></span></dt></dl></dd><dt><span class="section"><a href="#host-add">7.5. Adding a Host</a></span></dt><dd><dl><dt><span class="section"><a href="#host-add-xenserver-kvm-ovm">7.5.1. Adding a Host (XenServer or KVM)</a></span></dt><dt><span class="section"><a href="#host-add-vsphere">7.5.2. Adding a Host (vSphere)</a></span></dt></dl></dd><dt><span class="section"><a href="#primary-storage-add">7.6. Add Primary Storage</a></span></dt><dd><dl><dt><span class="section"><a href="#sys-require-primary-storage">7.6.1. System Requirements for Primary Storage</a></span></dt><dt><span class="section"><a href="#adding-primary-storage">7.6.2. Adding Primary Stroage</a></span></dt></dl></dd><dt><span class="section"><a href="#secondary-storage-add">7.7. Add Secondary Storage</a></span></dt><dd><dl><dt><span class="section"><a href="#sys-require-secondary-storage">7.7.1. System Requirements for Secondary Storage</a></span></dt><dt><span class="section"><a href="#adding-secondary-storage">7.7.2. Adding Secondary Storage</a></span></dt></dl></dd><dt><span class="section"><a href="#initialize-and-test">7.8. Initialize and Test</a></span></dt></dl></dd><dt><span class="chapter"><a href="#offerings">8. Service Offerings</a></span></dt><dd><dl><dt><span class="section"><a href="#compute-disk-service-offerings">8.1. Compute and Disk Service Offerings</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-compute-offerings">8.1.1. Creating a New Compute Offering</a></span></dt><dt><span class="section"><a href="#creating-disk-offerings">8.1.2. Creating a New Disk Offering</a></span></dt><dt><span class="section"><a href="#modify-delete-service-offerings">8.1.3. Modifying or Deleting a Service Offering</a></span></dt></dl></dd><dt><span class="section"><a href="#system-service-offerings">8.2. System Service Offerings</a></span></dt></dl></dd><dt><span class="chapter"><a href="#set-up-network-for-users">9. Setting Up Networking for Users</a></span></dt><dd><dl><dt><span class="section"><a href="#networks-for-users-overview">9.1. Overview of Setting Up Networking for Users</a></span></dt><dt><span class="section"><a href="#about-virtual-networks">9.2. About Virtual Networks</a></span></dt><dd><dl><dt><span class="section"><a href="#isolated-networks">9.2.1. Isolated Networks</a></span></dt><dt><span class="section"><a href="#shared-networks">9.2.2. Shared Networks</a></span></dt><dt><span class="section"><a href="#runtime-allocation-virtual-network-resources">9.2.3. Runtime Allocation of Virtual Network Resources</a></span></dt></dl></dd><dt><span class="section"><a href="#network-service-providers">9.3. Network Service Providers</a></span></dt><dt><span class="section"><a href="#network-offerings">9.4. Network Offerings</a></span></dt></dl></dd><dt><span class="chapter"><a href="#virtual-machines">10. Working With Virtual Machines</a></span></dt><dd><dl><dt><span class="section"><a href="#about-working-with-vms">10.1. About Working with Virtual Machines</a></span></dt><dt><span class="section"><a href="#best-practices-vm">10.2. Best Practices for Virtual Machines</a></span></dt><dt><span class="section"><a href="#vm-lifecycle">10.3. VM Lifecycle</a></span></dt><dt><span class="section"><a href="#creating-vms">10.4. Creating VMs</a></span></dt><dt><span class="section"><a href="#accessing-vms">10.5. Accessing VMs</a></span></dt><dt><span class="section"><a href="#stopping-and-starting-vms">10.6. Stopping and Starting VMs</a></span></dt><dt><span class="section"><a href="#changing-vm-name-os-group">10.7. Changing the VM Name, OS, or Group</a></span></dt><dt><span class="section"><a href="#changing-service-offering-for-vm">10.8. Changing the Service Offering for a VM</a></span></dt><dt><span class="section"><a href="#manual-live-migration">10.9. Moving VMs Between Hosts (Manual Live Migration)</a></span></dt><dt><span class="section"><a href="#deleting-vms">10.10. Deleting VMs</a></span></dt><dt><span class="section"><a href="#working-with-iso">10.11. Working with ISOs</a></span></dt><dd><dl><dt><span class="section"><a href="#add-iso">10.11.1. Adding an ISO</a></span></dt><dt><span class="section"><a href="#attach-iso-to-vm">10.11.2. Attaching an ISO to a VM</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#working-with-hosts">11. Working With Hosts</a></span></dt><dd><dl><dt><span class="section"><a href="#adding-hosts">11.1. Adding Hosts</a></span></dt><dt><span class="section"><a href="#scheduled-maintenance-maintenance-mode-hosts">11.2. Scheduled Maintenance and Maintenance Mode for Hosts</a></span></dt><dt><span class="section"><a href="#disable-enable-zones-pods-clusters">11.3. Disabling and Enabling Zones, Pods, and Clusters</a></span></dt><dt><span class="section"><a href="#removing-hosts">11.4. Removing Hosts</a></span></dt><dd><dl><dt><span class="section"><a href="#removing-xenserver-kvm-hosts">11.4.1. Removing XenServer and KVM Hosts</a></span></dt><dt><span class="section"><a href="#removing-vsphere-hosts">11.4.2. Removing vSphere Hosts</a></span></dt></dl></dd><dt><span class="section"><a href="#re-install-hosts">11.5. Re-Installing Hosts</a></span></dt><dt><span class="section"><a href="#maintain-hypervisors-on-hosts">11.6. Maintaining Hypervisors on Hosts</a></span></dt><dt><span class="section"><a href="#change-host-password">11.7. Changing Host Password</a></span></dt><dt><span class="section"><a href="#host-allocation">11.8. Host Allocation</a></span></dt><dt><span class="section"><a href="#vlan-provisioning">11.9. VLAN Provisioning</a></span></dt></dl></dd><dt><span class="chapter"><a href="#working-with-templates">12. Working with Templates</a></span></dt><dd><dl><dt><span class="section"><a href="#create-templates-overview">12.1. Creating Templates: Overview</a></span></dt><dt><span class="section"><a href="#requirements-templates">12.2. Requirements for Templates</a></span></dt><dt><span class="section"><a href="#best-practices-templates">12.3. Best Practices for Templates</a></span></dt><dt><span class="section"><a href="#default-template">12.4. The Default Template</a></span></dt><dt><span class="section"><a href="#private-public-template">12.5. Private and Public Templates</a></span></dt><dt><span class="section"><a href="#create-template-from-existing-vm">12.6. Creating a Template from an Existing Virtual Machine</a></span></dt><dt><span class="section"><a href="#create-template-from-snapshot">12.7. Creating a Template from a Snapshot</a></span></dt><dt><span class="section"><a href="#upload-template">12.8. Uploading Templates</a></span></dt><dt><span class="section"><a href="#export-template">12.9. Exporting Templates</a></span></dt><dt><span class="section"><a href="#create-windows-template">12.10. Creating a Windows Template</a></span></dt><dd><dl><dt><span class="section"><a href="#sysprep-windows-server-2008R2">12.10.1. System Preparation for Windows Server 2008 R2</a></span></dt><dt><span class="section"><a href="#sysprep-for-windows-server-2003R2">12.10.2. Sysprep for Windows Server 2003 R2</a></span></dt></dl></dd><dt><span class="section"><a href="#import-ami">12.11. Importing Amazon Machine Images</a></span></dt><dt><span class="section"><a href="#convert-hyperv-vm-to-template">12.12. Converting a Hyper-V VM to a Template</a></span></dt><dt><span class="section"><a href="#add-password-management-to-templates">12.13. Adding Password Management to Your Templates</a></span></dt><dd><dl><dt><span class="section"><a href="#linux-installation">12.13.1. Linux OS Installation</a></span></dt><dt><span class="section"><a href="#windows-installation">12.13.2. Windows OS Installation</a></span></dt></dl></dd><dt><span class="section"><a href="#delete-templates">12.14. Deleting Templates</a></span></dt></dl></dd><dt><span class="chapter"><a href="#storage">13. Working With Storage</a></span></dt><dd><dl><dt><span class="section"><a href="#storage-overview">13.1. Storage Overview</a></span></dt><dt><span class="section"><a href="#primary-storage">13.2. Primary Storage</a></span></dt><dt><span class="section"><a href="#secondary-storage">13.3. Secondary Storage</a></span></dt><dt><span class="section"><a href="#working-with-volumes">13.4. Using Swift for Secondary Storage</a></span></dt><dt><span class="section"><a href="#working-with-snapshots">13.5. Working with Snapshots</a></span></dt></dl></dd><dt><span class="chapter"><a href="#work-with-usage">14. Working with Usage</a></span></dt><dd><dl><dt><span class="section"><a href="#configure-usage-server">14.1. Configuring the Usage Server</a></span></dt><dt><span class="section"><a href="#set-usage-limit">14.2. Setting Usage Limits</a></span></dt><dt><span class="section"><a href="#globally-configured-limit">14.3. Globally Configured Limits</a></span></dt><dt><span class="section"><a href="#default-account-resource-limit">14.4. Default Account Resource Limits</a></span></dt><dt><span class="section"><a href="#per-domain-limits">14.5. Per-Domain Limits</a></span></dt></dl></dd><dt><span class="chapter"><a href="#networks">15. Managing Networks and Traffic</a></span></dt><dd><dl><dt><span class="section"><a href="#guest-traffic">15.1. Guest Traffic</a></span></dt><dt><span class="section"><a href="#networking-in-a-pod">15.2. Networking in a Pod</a></span></dt><dt><span class="section"><a href="#networking-in-a-zone">15.3. Networking in a Zone</a></span></dt><dt><span class="section"><a href="#basic-zone-physical-network-configuration">15.4. Basic Zone Physical Network Configuration</a></span></dt><dt><span class="section"><a href="#advanced-zone-physical-network-configuration">15.5. Advanced Zone Physical Network Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#configure-guest-traffic-in-advanced-zone">15.5.1. Configure Guest Traffic in an Advanced Zone</a></span></dt><dt><span class="section"><a href="#configure-public-traffic-in-an-advanced-zone">15.5.2. Configure Public Traffic in an Advanced Zone</a></span></dt></dl></dd><dt><span class="section"><a href="#using-multiple-guest-networks">15.6. Using Multiple Guest Networks</a></span></dt><dd><dl><dt><span class="section"><a href="#add-additional-guest-network">15.6.1. Adding an Additional Guest Network</a></span></dt><dt><span class="section"><a href="#change-network-offering-on-guest-network">15.6.2. Changing the Network Offering on a Guest Network</a></span></dt></dl></dd><dt><span class="section"><a href="#security-groups">15.7. Security Groups</a></span></dt><dd><dl><dt><span class="section"><a href="#about-security-groups">15.7.1. About Security Groups</a></span></dt><dt><span class="section"><a href="#add-security-group">15.7.2. Adding a Security Group</a></span></dt><dt><span class="section"><a href="#enable-security-groups">15.7.3. Enabling Security Groups</a></span></dt><dt><span class="section"><a href="#add-ingress-egress-rules">15.7.4. Adding Ingress and Egress Rules to a Security Group</a></span></dt></dl></dd><dt><span class="section"><a href="#external-firewalls-and-load-balancers">15.8. External Firewalls and Load Balancers</a></span></dt><dt><span class="section"><a href="#load-balancer-rules">15.9. Load Balancer Rules</a></span></dt><dt><span class="section"><a href="#guest-ip-ranges">15.10. Guest IP Ranges</a></span></dt><dt><span class="section"><a href="#acquire-new-ip-address">15.11. Acquiring a New IP Address</a></span></dt><dt><span class="section"><a href="#release-ip-address">15.12. Releasing an IP Address</a></span></dt><dt><span class="section"><a href="#static-nat">15.13. Static NAT</a></span></dt><dt><span class="section"><a href="#ip-forwarding-firewalling">15.14. IP Forwarding and Firewalling</a></span></dt><dt><span class="section"><a href="#ip-load-balancing">15.15. IP Load Balancing</a></span></dt><dt><span class="section"><a href="#dns-dhcp">15.16. DNS and DHCP</a></span></dt><dt><span class="section"><a href="#vpn">15.17. VPN</a></span></dt><dd><dl><dt><span class="section"><a href="#configure-vpn">15.17.1. Configuring VPN</a></span></dt><dt><span class="section"><a href="#using-vpn-with-windows">15.17.2. Using VPN with Windows</a></span></dt><dt><span class="section"><a href="#using-vpn-with-mac">15.17.3. Using VPN with Mac OS X</a></span></dt><dt><span class="section"><a href="#site-to-site-vpn">15.17.4. Setting Up a Site-to-Site VPN Connection</a></span></dt></dl></dd><dt><span class="section"><a href="#inter-vlan-routing">15.18. About Inter-VLAN Routing</a></span></dt><dt><span class="section"><a href="#configure-vpc">15.19. Configuring a Virtual Private Cloud</a></span></dt><dd><dl><dt><span class="section"><a href="#vpc">15.19.1. About Virtual Private Clouds</a></span></dt><dt><span class="section"><a href="#add-vpc">15.19.2. Adding a Virtual Private Cloud</a></span></dt><dt><span class="section"><a href="#add-tier">15.19.3. Adding Tiers</a></span></dt><dt><span class="section"><a href="#configure-acl">15.19.4. Configuring Access Control List</a></span></dt><dt><span class="section"><a href="#add-gateway-vpc">15.19.5. Adding a Private Gateway to a VPC</a></span></dt><dt><span class="section"><a href="#add-vm-to-tier">15.19.6. Deploying VMs to the Tier</a></span></dt><dt><span class="section"><a href="#acquire-new-ip-for-vpc">15.19.7. Acquiring a New IP Address for a VPC</a></span></dt><dt><span class="section"><a href="#release-ip-for-vpc">15.19.8. Releasing an IP Address Alloted to a VPC</a></span></dt><dt><span class="section"><a href="#enable-disable-static-nat-vpc">15.19.9. Enabling or Disabling Static NAT on a VPC</a></span></dt><dt><span class="section"><a href="#add-loadbalancer-rule-vpc">15.19.10. Adding Load Balancing Rules on a VPC</a></span></dt><dt><span class="section"><a href="#add-portforward-vpc">15.19.11. Adding a Port Forwarding Rule on a VPC</a></span></dt><dt><span class="section"><a href="#remove-tier">15.19.12. Removing Tiers</a></span></dt><dt><span class="section"><a href="#remove-vpc">15.19.13. Editing, Restarting, and Removing a Virtual Private Cloud</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#working-with-system-vm">16. Working with System Virtual Machines</a></span></dt><dd><dl><dt><span class="section"><a href="#system-vm-template">16.1. The System VM Template</a></span></dt><dt><span class="section"><a href="#multiple-system-vm-vmware">16.2. Multiple System VM Support for VMware</a></span></dt><dt><span class="section"><a href="#console-proxy">16.3. Console Proxy</a></span></dt><dt><span class="section"><a href="#virtual-router">16.4. Virtual Router</a></span></dt><dt><span class="section"><a href="#secondary-storage-vm">16.5. Secondary Storage VM</a></span></dt></dl></dd><dt><span class="chapter"><a href="#sys-reliability-and-ha">17. System Reliability and High Availability</a></span></dt><dd><dl><dt><span class="section"><a href="#ha-management-server">17.1. HA for Management Server</a></span></dt><dt><span class="section"><a href="#ha-enabled-vm">17.2. HA-Enabled Virtual Machines</a></span></dt><dt><span class="section"><a href="#ha-for-hosts">17.3. HA for Hosts</a></span></dt><dt><span class="section"><a href="#primary-storage-outage-and-data-loss">17.4. Primary Storage Outage and Data Loss</a></span></dt><dt><span class="section"><a href="#secondary-storage-outage-and-data-loss">17.5. Secondary Storage Outage and Data Loss</a></span></dt></dl></dd><dt><span class="chapter"><a href="#manage-cloud">18. Managing the Cloud</a></span></dt><dd><dl><dt><span class="section"><a href="#tagging-resources">18.1. Using Tags to Organize Resources in the Cloud</a></span></dt><dt><span class="section"><a href="#change-database-config">18.2. Changing the Database Configuration</a></span></dt><dt><span class="section"><a href="#admin-alerts">18.3. Administrator Alerts</a></span></dt><dt><span class="section"><a href="#customizing-dns">18.4. Customizing the Network Domain Name</a></span></dt><dt><span class="section"><a href="#stop-restart-management-server">18.5. Stopping and Restarting the Management Server</a></span></dt></dl></dd><dt><span class="chapter"><a href="#global-config">19. Setting Global Configuration Parameters</a></span></dt><dt><span class="chapter"><a href="#api-overview">20. CloudStack API</a></span></dt><dd><dl><dt><span class="section"><a href="#provisioning-auth-api">20.1. Provisioning and Authentication API</a></span></dt><dt><span class="section"><a href="#allocators">20.2. Allocators</a></span></dt><dt><span class="section"><a href="#user-data-and-meta-data">20.3. User Data and Meta Data</a></span></dt></dl></dd><dt><span class="chapter"><a href="#tuning">21. Tuning</a></span></dt><dd><dl><dt><span class="section"><a href="#performance-monitoring">21.1. Performance Monitoring</a></span></dt><dt><span class="section"><a href="#increase-management-server-max-memory">21.2. Increase Management Server Maximum Memory</a></span></dt><dt><span class="section"><a href="#set-database-buffer-pool-size">21.3. Set Database Buffer Pool Size</a></span></dt><dt><span class="section"><a href="#set-monitor-total-vm-limits-per-host">21.4. Set and Monitor Total VM Limits per Host</a></span></dt><dt><span class="section"><a href="#configure-xenserver-dom0-memory">21.5. Configure XenServer dom0 Memory</a></span></dt></dl></dd><dt><span class="chapter"><a href="#troubleshooting">22. Troubleshooting</a></span></dt><dd><dl><dt><span class="section"><a href="#events">22.1. Events</a></span></dt><dd><dl><dt><span class="section"><a href="#events-log">22.1.1. Event Logs</a></span></dt><dt><span class="section"><a href="#standard-events">22.1.2. Standard Events</a></span></dt><dt><span class="section"><a href="#long-running-job-events">22.1.3. Long Running Job Events</a></span></dt><dt><span class="section"><a href="#event-log-queries">22.1.4. Event Log Queries</a></span></dt></dl></dd><dt><span class="section"><a href="#troubleshooting-working-with-server-logs">22.2. Working with Server Logs</a></span></dt><dt><span class="section"><a href="#troubleshooting-dataloss-on-exported-primary-storage">22.3. Data Loss on Exported Primary Storage</a></span></dt><dt><span class="section"><a href="#troubleshooting-recover-lost-virtual-router">22.4. Recovering a Lost Virtual Router </a></span></dt><dt><span class="section"><a href="#troubleshooting-maintenance-mode-not-working-on-vCenter">22.5. Maintenance mode not working on vCenter</a></span></dt><dt><span class="section"><a href="#troubleshooting-unable-to-deploy-vms">22.6. Unable to deploy VMs from uploaded vSphere template</a></span></dt><dt><span class="section"><a href="#troubleshooting-unable-to-power-on-vm">22.7. Unable to power on virtual machine on VMware</a></span></dt><dt><span class="section"><a href="#troubleshooting-lb-rules-fails">22.8. Load balancer rules fail after changing network offering</a></span></dt></dl></dd><dt><span class="appendix"><a href="#time-zones">A. Time Zones</a></span></dt><dt><span class="appendix"><a href="#event-types">B. Event Types</a></span></dt><dt><span class="appendix"><a href="#alerts">C. Alerts</a></span></dt><dt><span class="appendix"><a href="#appe-cloudstack-Revision_History">D. Revision History</a></span></dt></dl></div><div xml:lang="en-US" class="chapter" id="concepts" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 1. Concepts</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#whatis">1.1. What Is CloudStack?</a></span></dt><dt><span class="section"><a href="#feature-overview">1.2. What Can CloudStack Do?</a></span></dt><dt><span class="section"><a href="#deployment-architecture-overview">1.3. Deployment Architecture Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#management-server-overview">1.3.1. Management Server Overview</a></span></dt><dt><span class="section"><a href="#cloud-infrastructure-overview">1.3.2. Cloud Infrastructure Overview</a></span></dt><dt><span class="section"><a href="#networking-overview">1.3.3. Networking Overview</a></span></dt></dl></dd></dl></div><div xml:lang="en-US" class="section" id="whatis" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="whatis">1.1. What Is CloudStack?</h2></div></div></div><div class="para">
		CloudStack is an open source software platform that pools computing resources to build public, private, and hybrid Infrastructure as a Service (IaaS) clouds. CloudStack manages the network, storage, and compute nodes that make up a cloud infrastructure. Use CloudStack to deploy, manage, and configure cloud computing environments.
	</div><div class="para">
		Typical users are service providers and enterprises. With CloudStack, you can:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Set up an on-demand, elastic cloud computing service. Service providers can sell self service virtual machine instances, storage volumes, and networking configurations over the Internet.
			</div></li><li class="listitem"><div class="para">
				Set up an on-premise private cloud for use by employees. Rather than managing virtual machines in the same way as physical machines, with CloudStack an enterprise can offer self-service virtual machines to users without involving IT departments.
			</div></li></ul></div><div class="mediaobject"><img src="./images/1000-foot-view.png" width="444" alt="1000-foot-view.png: Overview of CloudStack" /></div></div><div xml:lang="en-US" class="section" id="feature-overview" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="feature-overview">1.2. What Can CloudStack Do?</h2></div></div></div><div class="para">
		<span class="bold bold"><strong>Multiple Hypervisor Support</strong></span>
	</div><div class="para">
		CloudStack works with a variety of hypervisors, and a single cloud deployment can contain multiple hypervisor implementations. The current release of CloudStack supports pre-packaged enterprise solutions like Citrix XenServer and VMware vSphere, as well as KVM or Xen running on Ubuntu or CentOS.
	</div><div class="para">
		<span class="bold bold"><strong>Massively Scalable Infrastructure Management</strong></span>
	</div><div class="para">
		CloudStack can manage tens of thousands of servers installed in multiple geographically distributed datacenters. The centralized management server scales linearly, eliminating the need for intermediate cluster-level management servers. No single component failure can cause cloud-wide outage. Periodic maintenance of the management server can be performed without affecting the functioning of virtual machines running in the cloud.
	</div><div class="para">
		<span class="bold bold"><strong>Automatic Configuration Management</strong></span>
	</div><div class="para">
		CloudStack automatically configures each guest virtual machine’s networking and storage settings.
	</div><div class="para">
		CloudStack internally manages a pool of virtual appliances to support the cloud itself. These appliances offer services such as firewalling, routing, DHCP, VPN access, console proxy, storage access, and storage replication. The extensive use of virtual appliances simplifies the installation, configuration, and ongoing management of a cloud deployment.
	</div><div class="para">
		<span class="bold bold"><strong>Graphical User Interface</strong></span>
	</div><div class="para">
		CloudStack offers an administrator's Web interface, used for provisioning and managing the cloud, as well as an end-user's Web interface, used for running VMs and managing VM templates. The UI can be customized to reflect the desired service provider or enterprise look and feel.
	</div><div class="para">
		<span class="bold bold"><strong>API and Extensibility</strong></span>
	</div><div class="para">
		CloudStack provides an API that gives programmatic access to all the management features available in the UI. The API is maintained and documented. This API enables the creation of command line tools and new user interfaces to suit particular needs. See the Developer’s Guide and API Reference, both available at <a href="http://incubator.apache.org/cloudstack/docs">Apache CloudStack Guides</a> and <a href="http://incubator.apache.org/cloudstack/docs/api">Apache CloudStack API Reference</a> respectively.
	</div><div class="para">
		The CloudStack pluggable allocation architecture allows the creation of new types of allocators for the selection of storage and Hosts. See the Allocator Implementation Guide (<a href="http://docs.cloudstack.org/CloudStack_Documentation/Allocator_Implementation_Guide">http://docs.cloudstack.org/CloudStack_Documentation/Allocator_Implementation_Guide</a>).
	</div><div class="para">
		<span class="bold bold"><strong>High Availability</strong></span>
	</div><div class="para">
		CloudStack has a number of features to increase the availability of the system. The Management Server itself may be deployed in a multi-node installation where the servers are load balanced. MySQL may be configured to use replication to provide for a manual failover in the event of database loss. For the hosts, CloudStack supports NIC bonding and the use of separate networks for storage as well as iSCSI Multipath.
	</div></div><div xml:lang="en-US" class="section" id="deployment-architecture-overview" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="deployment-architecture-overview">1.3. Deployment Architecture Overview</h2></div></div></div><div class="para">
		A CloudStack installation consists of two parts: the Management Server and the cloud infrastructure that it manages. When you set up and manage a CloudStack cloud, you provision resources such as hosts, storage devices, and IP addresses into the Management Server, and the Management Server manages those resources.
	</div><div class="para">
		The minimum production installation consists of one machine running the CloudStack Management Server and another machine to act as the cloud infrastructure (in this case, a very simple infrastructure consisting of one host running hypervisor software). In its smallest deployment, a single machine can act as both the Management Server and the hypervisor host (using the KVM hypervisor).
	</div><div class="mediaobject"><img src="./images/basic-deployment.png" alt="basic-deployment.png: Basic two-machine deployment" /></div><div class="para">
		A more full-featured installation consists of a highly-available multi-node Management Server installation and up to tens of thousands of hosts using any of several advanced networking setups. For information about deployment options, see Choosing a Deployment Architecture.
	</div><div xml:lang="en-US" class="section" id="management-server-overview" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="management-server-overview">1.3.1. Management Server Overview</h3></div></div></div><div class="para">
		The Management Server is the CloudStack software that manages cloud resources. By interacting with the Management Server through its UI or API, you can configure and manage your cloud infrastructure.
	</div><div class="para">
		The Management Server runs on a dedicated server or VM. It controls allocation of virtual machines to hosts and assigns storage and IP addresses to the virtual machine instances. The Management Server runs in a Tomcat container and requires a MySQL database for persistence.
	</div><div class="para">
		The machine must meet the system requirements described in System Requirements.
	</div><div class="para">
		The Management Server:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Provides the web user interface for the administrator and a reference user interface for end users.
			</div></li><li class="listitem"><div class="para">
				Provides the APIs for CloudStack.
			</div></li><li class="listitem"><div class="para">
				Manages the assignment of guest VMs to particular hosts.
			</div></li><li class="listitem"><div class="para">
				Manages the assignment of public and private IP addresses to particular accounts.
			</div></li><li class="listitem"><div class="para">
				Manages the allocation of storage to guests as virtual disks.
			</div></li><li class="listitem"><div class="para">
				Manages snapshots, templates, and ISO images, possibly replicating them across data centers.
			</div></li><li class="listitem"><div class="para">
				Provides a single point of configuration for the cloud.
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="cloud-infrastructure-overview" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="cloud-infrastructure-overview">1.3.2. Cloud Infrastructure Overview</h3></div></div></div><div class="para">
		The Management Server manages one or more zones (typically, datacenters) containing host computers where guest virtual machines will run. The cloud infrastructure is organized as follows:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Zone: Typically, a zone is equivalent to a single datacenter. A zone consists of one or more pods and secondary storage.
			</div></li><li class="listitem"><div class="para">
				Pod: A pod is usually one rack of hardware that includes a layer-2 switch and one or more clusters.
			</div></li><li class="listitem"><div class="para">
				Cluster: A cluster consists of one or more hosts and primary storage.
			</div></li><li class="listitem"><div class="para">
				Host: A single compute node within a cluster. The hosts are where the actual cloud services run in the form of guest virtual machines.
			</div></li><li class="listitem"><div class="para">
				Primary storage is associated with a cluster, and it stores the disk volumes for all the VMs running on hosts in that cluster.
			</div></li><li class="listitem"><div class="para">
				Secondary storage is associated with a zone, and it stores templates, ISO images, and disk volume snapshots.
			</div></li></ul></div><div class="mediaobject"><img src="./images/infrastructure-overview.png" width="444" alt="infrastructure_overview.png: Nested organization of a zone" /></div><div class="para">
		<span class="bold bold"><strong>More Information</strong></span>
	</div><div class="para">
		For more information, see documentation on cloud infrastructure concepts.
	</div></div><div xml:lang="en-US" class="section" id="networking-overview" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="networking-overview">1.3.3. Networking Overview</h3></div></div></div><div class="para">
		CloudStack offers two types of networking scenario:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Basic. For AWS-style networking. Provides a single network where guest isolation can be provided through layer-3 means such as security groups (IP address source filtering).
			</div></li><li class="listitem"><div class="para">
				Advanced. For more sophisticated network topologies. This network model provides the most flexibility in defining guest networks.
			</div></li></ul></div><div class="para">
		For more details, see Network Setup.
	</div></div></div></div><div xml:lang="en-US" class="chapter" id="cloud-infrastructure-concepts" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 2. Cloud Infrastructure Concepts</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#about-zones">2.1. About Zones</a></span></dt><dt><span class="section"><a href="#about-pods">2.2. About Pods</a></span></dt><dt><span class="section"><a href="#about-clusters">2.3. About Clusters</a></span></dt><dt><span class="section"><a href="#about-hosts">2.4. About Hosts</a></span></dt><dt><span class="section"><a href="#about-primary-storage">2.5. About Primary Storage</a></span></dt><dt><span class="section"><a href="#about-secondary-storage">2.6. About Secondary Storage</a></span></dt><dt><span class="section"><a href="#about-physical-networks">2.7. About Physical Networks</a></span></dt><dd><dl><dt><span class="section"><a href="#physical-network-configuration-settings">2.7.1. Configurable Characteristics of Physical Networks</a></span></dt><dt><span class="section"><a href="#basic-zone-network-traffic-types">2.7.2. Basic Zone Network Traffic Types</a></span></dt><dt><span class="section"><a href="#basic-zone-guest-ip-addresses">2.7.3. Basic Zone Guest IP Addresses</a></span></dt><dt><span class="section"><a href="#advanced-zone-network-traffic-types">2.7.4. Advanced Zone Network Traffic Types</a></span></dt><dt><span class="section"><a href="#advanced-zone-guest-ip-addresses">2.7.5. Advanced Zone Guest IP Addresses</a></span></dt><dt><span class="section"><a href="#advanced-zone-public-ip-addresses">2.7.6. Advanced Zone Public IP Addresses</a></span></dt><dt><span class="section"><a href="#system-reserved-ip-addresses">2.7.7. System Reserved IP Addresses</a></span></dt></dl></dd></dl></div><div xml:lang="en-US" class="section" id="about-zones" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="about-zones">2.1. About Zones</h2></div></div></div><div class="para">
		A zone is the largest organizational unit within a CloudStack deployment. A zone typically corresponds to a single datacenter, although it is permissible to have multiple zones in a datacenter. The benefit of organizing infrastructure into zones is to provide physical isolation and redundancy. For example, each zone can have its own power supply and network uplink, and the zones can be widely separated geographically (though this is not required).
	</div><div class="para">
		A zone consists of:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				One or more pods. Each pod contains one or more clusters of hosts and one or more primary storage servers.
			</div></li><li class="listitem"><div class="para">
				Secondary storage, which is shared by all the pods in the zone.
			</div></li></ul></div><div class="mediaobject"><img src="./images/zone-overview.png" width="444" alt="zone-overview.png: Nested structure of a simple zone" /></div><div class="para">
		Zones are visible to the end user. When a user starts a guest VM, the user must select a zone for their guest. Users might also be required to copy their private templates to additional zones to enable creation of guest VMs using their templates in those zones.
	</div><div class="para">
		Zones can be public or private. Public zones are visible to all users. This means that any user may create a guest in that zone. Private zones are reserved for a specific domain. Only users in that domain or its subdomains may create guests in that zone.
	</div><div class="para">
		Hosts in the same zone are directly accessible to each other without having to go through a firewall. Hosts in different zones can access each other through statically configured VPN tunnels.
	</div><div class="para">
		For each zone, the administrator must decide the following.
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				How many pods to place in a zone.
			</div></li><li class="listitem"><div class="para">
				How many clusters to place in each pod.
			</div></li><li class="listitem"><div class="para">
				How many hosts to place in each cluster.
			</div></li><li class="listitem"><div class="para">
				How many primary storage servers to place in each cluster and total capacity for the storage servers.
			</div></li><li class="listitem"><div class="para">
				How much secondary storage to deploy in a zone.
			</div></li></ul></div><div class="para">
		When you add a new zone, you will be prompted to configure the zone’s physical network and add the first pod, cluster, host, primary storage, and secondary storage.
	</div></div><div xml:lang="en-US" class="section" id="about-pods" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="about-pods">2.2. About Pods</h2></div></div></div><div class="para">
		A pod often represents a single rack. Hosts in the same pod are in the same subnet.
	</div><div class="para">
		A pod is the second-largest organizational unit within a CloudStack deployment. Pods are contained within zones. Each zone can contain one or more pods.
	</div><div class="para">
		Pods are not visible to the end user.
	</div><div class="para">
		A pod consists of one or more clusters of hosts and one or more primary storage servers.
	</div><div class="mediaobject"><img src="./images/pod-overview.png" alt="pod-overview.png: Nested structure of a simple pod" /></div></div><div xml:lang="en-US" class="section" id="about-clusters" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="about-clusters">2.3. About Clusters</h2></div></div></div><div class="para">
		A cluster provides a way to group hosts. To be precise, a cluster is a XenServer server pool, a set of KVM servers, , or a VMware cluster preconfigured in vCenter. The hosts in a cluster all have identical hardware, run the same hypervisor, are on the same subnet, and access the same shared primary storage. Virtual machine instances (VMs) can be live-migrated from one host to another within the same cluster, without interrupting service to the user.
	</div><div class="para">
		A cluster is the third-largest organizational unit within a CloudStack deployment. Clusters are contained within pods, and pods are contained within zones. Size of the cluster is limited by the underlying hypervisor, although the CloudStack recommends less in most cases; see Best Practices.
	</div><div class="para">
		A cluster consists of one or more hosts and one or more primary storage servers.
	</div><div class="mediaobject"><img src="./images/cluster-overview.png" alt="cluster-overview.png: Structure of a simple cluster" /></div><div class="para">
		CloudStack allows multiple clusters in a cloud deployment.
	</div><div class="para">
		Even when local storage is used exclusively, clusters are still required organizationally, even if there is just one host per cluster.
	</div><div class="para">
		When VMware is used, every VMware cluster is managed by a vCenter server. Administrator must register the vCenter server with CloudStack. There may be multiple vCenter servers per zone. Each vCenter server may manage multiple VMware clusters.
	</div></div><div xml:lang="en-US" class="section" id="about-hosts" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="about-hosts">2.4. About Hosts</h2></div></div></div><div class="para">
		A host is a single computer. Hosts provide the computing resources that run the guest virtual machines. Each host has hypervisor software installed on it to manage the guest VMs. For example, a Linux KVM-enabled server, a Citrix XenServer server, and an ESXi server are hosts.
	</div><div class="para">
		The host is the smallest organizational unit within a CloudStack deployment. Hosts are contained within clusters, clusters are contained within pods, and pods are contained within zones.
	</div><div class="para">
		Hosts in a CloudStack deployment:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Provide the CPU, memory, storage, and networking resources needed to host the virtual machines
			</div></li><li class="listitem"><div class="para">
				Interconnect using a high bandwidth TCP/IP network and connect to the Internet
			</div></li><li class="listitem"><div class="para">
				May reside in multiple data centers across different geographic locations
			</div></li><li class="listitem"><div class="para">
				May have different capacities (different CPU speeds, different amounts of RAM, etc.), although the hosts within a cluster must all be homogeneous
			</div></li></ul></div><div class="para">
		Additional hosts can be added at any time to provide more capacity for guest VMs.
	</div><div class="para">
		CloudStack automatically detects the amount of CPU and memory resources provided by the Hosts.
	</div><div class="para">
		Hosts are not visible to the end user. An end user cannot determine which host their guest has been assigned to.
	</div><div class="para">
		For a host to function in CloudStack, you must do the following:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Install hypervisor software on the host
			</div></li><li class="listitem"><div class="para">
				Assign an IP address to the host
			</div></li><li class="listitem"><div class="para">
				Ensure the host is connected to the CloudStack Management Server
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="about-primary-storage" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="about-primary-storage">2.5. About Primary Storage</h2></div></div></div><div class="para">
		Primary storage is associated with a cluster, and it stores the disk volumes for all the VMs running on hosts in that cluster. You can add multiple primary storage servers to a cluster. At least one is required. It is typically located close to the hosts for increased performance.
	</div><div class="para">
		CloudStack is designed to work with all standards-compliant iSCSI and NFS servers that are supported by the underlying hypervisor, including, for example:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Dell EqualLogic™ for iSCSI
			</div></li><li class="listitem"><div class="para">
				Network Appliances filers for NFS and iSCSI
			</div></li><li class="listitem"><div class="para">
				Scale Computing for NFS
			</div></li></ul></div><div class="para">
		If you intend to use only local disk for your installation, you can skip to Add Secondary Storage.
	</div></div><div xml:lang="en-US" class="section" id="about-secondary-storage" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="about-secondary-storage">2.6. About Secondary Storage</h2></div></div></div><div class="para">
		Secondary storage is associated with a zone, and it stores the following:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Templates — OS images that can be used to boot VMs and can include additional configuration information, such as installed applications
			</div></li><li class="listitem"><div class="para">
				ISO images — disc images containing data or bootable media for operating systems
			</div></li><li class="listitem"><div class="para">
				Disk volume snapshots — saved copies of VM data which can be used for data recovery or to create new templates
			</div></li></ul></div><div class="para">
		The items in zone-based NFS secondary storage are available to all hosts in the zone. CloudStack manages the allocation of guest virtual disks to particular primary storage devices.
	</div><div class="para">
		To make items in secondary storage available to all hosts throughout the cloud, you can add OpenStack Object Storage (Swift, <a href="http://swift.openstack.org">swift.openstack.org</a>) in addition to the zone-based NFS secondary storage. When using Swift, you configure Swift storage for the entire CloudStack, then set up NFS secondary storage for each zone as usual. The NFS storage in each zone acts as a staging area through which all templates and other secondary storage data pass before being forwarded to Swift. The Swift storage acts as a cloud-wide resource, making templates and other data available to any zone in the cloud. There is no hierarchy in the Swift storage, just one Swift container per storage object. Any secondary storage in the whole cloud can pull a container from Swift at need. It is not necessary to copy templates and snapshots from one zone to another, as would be required when using zone NFS alone. Everything is available everywhere.
	</div></div><div xml:lang="en-US" class="section" id="about-physical-networks" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="about-physical-networks">2.7. About Physical Networks</h2></div></div></div><div class="para">
		Part of adding a zone is setting up the physical network. One or (in an advanced zone) more physical networks can be associated with each zone. The network corresponds to a NIC on the hypervisor host. Each physical network can carry one or more types of network traffic. The choices of traffic type for each network vary depending on whether you are creating a zone with basic networking or advanced networking.
	</div><div class="para">
		A physical network is the actual network hardware and wiring in a zone. A zone can have multiple physical networks. An administrator can:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Add/Remove/Update physical networks in a zone
			</div></li><li class="listitem"><div class="para">
				Configure VLANs on the physical network
			</div></li><li class="listitem"><div class="para">
				Configure a name so the network can be recognized by hypervisors
			</div></li><li class="listitem"><div class="para">
				Configure the service providers (firewalls, load balancers, etc.) available on a physical network
			</div></li><li class="listitem"><div class="para">
				Configure the IP addresses trunked to a physical network
			</div></li><li class="listitem"><div class="para">
				Specify what type of traffic is carried on the physical network, as well as other properties like network speed
			</div></li></ul></div><div xml:lang="en-US" class="section" id="physical-network-configuration-settings" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="physical-network-configuration-settings">2.7.1. Configurable Characteristics of Physical Networks</h3></div></div></div><div class="para">
		CloudStack provides configuration settings you can use to set up a physical network in a zone, including:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				What type of network traffic it carries (guest, public, management, storage)
			</div></li><li class="listitem"><div class="para">
				VLANs
			</div></li><li class="listitem"><div class="para">
				Unique name that the hypervisor can use to find that particular network
			</div></li><li class="listitem"><div class="para">
				Enabled or disabled. When a network is first set up, it is disabled – not in use yet. The administrator sets the physical network to enabled, and it begins to be used. The administrator can later disable the network again, which prevents any new virtual networks from being created on that physical network; the existing network traffic continues even though the state is disabled.
			</div></li><li class="listitem"><div class="para">
				Speed
			</div></li><li class="listitem"><div class="para">
				Tags, so network offerings can be matched to physical networks
			</div></li><li class="listitem"><div class="para">
				Isolation method
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="basic-zone-network-traffic-types" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="basic-zone-network-traffic-types">2.7.2. Basic Zone Network Traffic Types</h3></div></div></div><div class="para">
		When basic networking is used, there can be only one physical network in the zone. That physical network carries the following traffic types:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Guest. When end users run VMs, they generate guest traffic. The guest VMs communicate with each other over a network that can be referred to as the guest network. Each pod in a basic zone is a broadcast domain, and therefore each pod has a different IP range for the guest network. The administrator must configure the IP range for each pod.
			</div></li><li class="listitem"><div class="para">
				Management. When CloudStack’s internal resources communicate with each other, they generate management traffic. This includes communication between hosts, system VMs (VMs used by CloudStack to perform various tasks in the cloud), and any other component that communicates directly with the CloudStack Management Server. You must configure the IP range for the system VMs to use.
			</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					We strongly recommend the use of separate NICs for management traffic and guest traffic.
				</div></div></div></li><li class="listitem"><div class="para">
				Public. Public traffic is generated when VMs in the cloud access the Internet. Publicly accessible IPs must be allocated for this purpose. End users can use the CloudStack UI to acquire these IPs to implement NAT between their guest network and the public network, as described in Acquiring a New IP Address.
			</div></li><li class="listitem"><div class="para">
				Storage. Traffic such as VM templates and snapshots, which is sent between the secondary storage VM and secondary storage servers. CloudStack uses a separate Network Interface Controller (NIC) named storage NIC for storage network traffic. Use of a storage NIC that always operates on a high bandwidth network allows fast template and snapshot copying. You must configure the IP range to use for the storage network.
			</div></li></ul></div><div class="para">
		In a basic network, configuring the physical network is fairly straightforward. In most cases, you only need to configure one guest network to carry traffic that is generated by guest VMs. If you use a NetScaler load balancer and enable its elastic IP and elastic load balancing (EIP and ELB) features, you must also configure a network to carry public traffic. CloudStack takes care of presenting the necessary network configuration steps to you in the UI when you add a new zone.
	</div></div><div xml:lang="en-US" class="section" id="basic-zone-guest-ip-addresses" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="basic-zone-guest-ip-addresses">2.7.3. Basic Zone Guest IP Addresses</h3></div></div></div><div class="para">
		When basic networking is used, CloudPlatform will assign IP addresses in the CIDR of the pod to the guests in that pod. The administrator must add a Direct IP range on the pod for this purpose. These IPs are in the same VLAN as the hosts.
	</div></div><div xml:lang="en-US" class="section" id="advanced-zone-network-traffic-types" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="advanced-zone-network-traffic-types">2.7.4. Advanced Zone Network Traffic Types</h3></div></div></div><div class="para">
		When advanced networking is used, there can be multiple physical networks in the zone. Each physical network can carry one or more traffic types, and you need to let CloudStack know which type of network traffic you want each network to carry. The traffic types in an advanced zone are:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Guest. When end users run VMs, they generate guest traffic. The guest VMs communicate with each other over a network that can be referred to as the guest network. This network can be isolated or shared. In an isolated guest network, the administrator needs to reserve VLAN ranges to provide isolation for each CloudStack account’s network (potentially a large number of VLANs). In a shared guest network, all guest VMs share a single network.
			</div></li><li class="listitem"><div class="para">
				Management. When CloudStack’s internal resources communicate with each other, they generate management traffic. This includes communication between hosts, system VMs (VMs used by CloudStack to perform various tasks in the cloud), and any other component that communicates directly with the CloudStack Management Server. You must configure the IP range for the system VMs to use.
			</div></li><li class="listitem"><div class="para">
				Public. Public traffic is generated when VMs in the cloud access the Internet. Publicly accessible IPs must be allocated for this purpose. End users can use the CloudStack UI to acquire these IPs to implement NAT between their guest network and the public network, as described in “Acquiring a New IP Address” in the Administration Guide.
			</div></li><li class="listitem"><div class="para">
				Storage. Traffic such as VM templates and snapshots, which is sent between the secondary storage VM and secondary storage servers. CloudStack uses a separate Network Interface Controller (NIC) named storage NIC for storage network traffic. Use of a storage NIC that always operates on a high bandwidth network allows fast template and snapshot copying. You must configure the IP range to use for the storage network.
			</div></li></ul></div><div class="para">
		These traffic types can each be on a separate physical network, or they can be combined with certain restrictions. When you use the Add Zone wizard in the UI to create a new zone, you are guided into making only valid choices.
	</div></div><div xml:lang="en-US" class="section" id="advanced-zone-guest-ip-addresses" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="advanced-zone-guest-ip-addresses">2.7.5. Advanced Zone Guest IP Addresses</h3></div></div></div><div class="para">
		When advanced networking is used, the administrator can create additional networks for use by the guests. These networks can span the zone and be available to all accounts, or they can be scoped to a single account, in which case only the named account may create guests that attach to these networks. The networks are defined by a VLAN ID, IP range, and gateway. The administrator may provision thousands of these networks if desired.
	</div></div><div xml:lang="en-US" class="section" id="advanced-zone-public-ip-addresses" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="advanced-zone-public-ip-addresses">2.7.6. Advanced Zone Public IP Addresses</h3></div></div></div><div class="para">
		When advanced networking is used, the administrator can create additional networks for use by the guests. These networks can span the zone and be available to all accounts, or they can be scoped to a single account, in which case only the named account may create guests that attach to these networks. The networks are defined by a VLAN ID, IP range, and gateway. The administrator may provision thousands of these networks if desired.
	</div></div><div xml:lang="en-US" class="section" id="system-reserved-ip-addresses" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="system-reserved-ip-addresses">2.7.7. System Reserved IP Addresses</h3></div></div></div><div class="para">
		In each zone, you need to configure a range of reserved IP addresses for the management network. This network carries communication between the CloudStack Management Server and various system VMs, such as Secondary Storage VMs, Console Proxy VMs, and DHCP.
	</div><div class="para">
		The reserved IP addresses must be unique across the cloud. You cannot, for example, have a host in one zone which has the same private IP address as a host in another zone.
	</div><div class="para">
		The hosts in a pod are assigned private IP addresses. These are typically RFC1918 addresses. The Console Proxy and Secondary Storage system VMs are also allocated private IP addresses in the CIDR of the pod that they are created in.
	</div><div class="para">
		Make sure computing servers and Management Servers use IP addresses outside of the System Reserved IP range. For example, suppose the System Reserved IP range starts at 192.168.154.2 and ends at 192.168.154.7. CloudStack can use .2 to .7 for System VMs. This leaves the rest of the pod CIDR, from .8 to .254, for the Management Server and hypervisor hosts.
	</div><div class="para">
		<span class="bold bold"><strong>In all zones:</strong></span>
	</div><div class="para">
		Provide private IPs for the system in each pod and provision them in CloudStack.
	</div><div class="para">
		For KVM and XenServer, the recommended number of private IPs per pod is one per host. If you expect a pod to grow, add enough private IPs now to accommodate the growth.
	</div><div class="para">
		<span class="bold bold"><strong>In a zone that uses advanced networking:</strong></span>
	</div><div class="para">
		For zones with advanced networking, we recommend provisioning enough private IPs for your total number of customers, plus enough for the required CloudStack System VMs. Typically, about 10 additional IPs are required for the System VMs. For more information about System VMs, see Working with System Virtual Machines in the Administrator's Guide.
	</div><div class="para">
		When advanced networking is being used, the number of private IP addresses available in each pod varies depending on which hypervisor is running on the nodes in that pod. Citrix XenServer and KVM use link-local addresses, which in theory provide more than 65,000 private IP addresses within the address block. As the pod grows over time, this should be more than enough for any reasonable number of hosts as well as IP addresses for guest virtual routers. VMWare ESXi, by contrast uses any administrator-specified subnetting scheme, and the typical administrator provides only 255 IPs per pod. Since these are shared by physical machines, the guest virtual router, and other entities, it is possible to run out of private IPs when scaling up a pod whose nodes are running ESXi.
	</div><div class="para">
		To ensure adequate headroom to scale private IP space in an ESXi pod that uses advanced networking, use one or both of the following techniques:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Specify a larger CIDR block for the subnet. A subnet mask with a /20 suffix will provide more than 4,000 IP addresses.
			</div></li><li class="listitem"><div class="para">
				Create multiple pods, each with its own subnet. For example, if you create 10 pods and each pod has 255 IPs, this will provide 2,550 IP addresses.
			</div></li></ul></div></div></div></div><div xml:lang="en-US" class="chapter" id="accounts" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 3. Accounts</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#accounts-users-domains">3.1. Accounts, Users, and Domains</a></span></dt><dt><span class="section"><a href="#LDAPserver-for-user-authentication">3.2. Using an LDAP Server for User Authentication</a></span></dt><dd><dl><dt><span class="section"><a href="#example-LDAP-configuration-commands">3.2.1. Example LDAP Configuration Commands</a></span></dt><dt><span class="section"><a href="#search-base">3.2.2. Search Base</a></span></dt><dt><span class="section"><a href="#query-filter">3.2.3. Query Filter</a></span></dt><dt><span class="section"><a href="#search-user-bind-dn">3.2.4. Search User Bind DN</a></span></dt><dt><span class="section"><a href="#SSL-keystore-path-and-password">3.2.5. SSL Keystore Path and Password</a></span></dt></dl></dd></dl></div><div xml:lang="en-US" class="section" id="accounts-users-domains" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="accounts-users-domains">3.1. Accounts, Users, and Domains</h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idp7537928">Accounts</h5>
			An account typically represents a customer of the service provider or a department in a large organization. Multiple users can exist in an account.
		</div><div class="formalpara"><h5 class="formalpara" id="idp11735304">Domains</h5>
			Accounts are grouped by domains. Domains usually contain multiple accounts that have some logical relationship to each other and a set of delegated administrators with some authority over the domain and its subdomains. For example, a service provider with several resellers could create a domain for each reseller.
		</div><div class="para">
		For each account created, the Cloud installation creates three different types of user accounts: root administrator, domain administrator, and user.
	</div><div class="formalpara"><h5 class="formalpara" id="idp10414544">Users</h5>
			Users are like aliases in the account. Users in the same account are not isolated from each other, but they are isolated from users in other accounts. Most installations need not surface the notion of users; they just have one user per account. The same user cannot belong to multiple accounts.
		</div><div class="para">
		Username is unique in a domain across accounts in that domain. The same username can exist in other domains, including sub-domains. Domain name can repeat only if the full pathname from root is unique. For example, you can create root/d1, as well as root/foo/d1, and root/sales/d1.
	</div><div class="para">
		Administrators are accounts with special privileges in the system. There may be multiple administrators in the system. Administrators can create or delete other administrators, and change the password for any user in the system.
	</div><div class="formalpara"><h5 class="formalpara" id="idm2556040">Domain Administrators</h5>
			Domain administrators can perform administrative operations for users who belong to that domain. Domain administrators do not have visibility into physical servers or other domains.
		</div><div class="formalpara"><h5 class="formalpara" id="idp11184280">Root Administrator</h5>
			Root administrators have complete access to the system, including managing templates, service offerings, customer care administrators, and domains
		</div><div class="para">
		The resources belong to the account, not individual users in that account. For example, billing, resource limits, and so on are maintained by the account, not the users. A user can operate on any resource in the account provided the user has privileges for that operation. The privileges are determined by the role.
	</div></div><div xml:lang="en-US" class="section" id="LDAPserver-for-user-authentication" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="LDAPserver-for-user-authentication">3.2. Using an LDAP Server for User Authentication</h2></div></div></div><div class="para">
		You can use an external LDAP server such as Microsoft Active Directory or ApacheDS to authenticate CloudStack end-users. Just map CloudStack accounts to the corresponding LDAP accounts using a query filter. The query filter is written using the query syntax of the particular LDAP server, and can include special wildcard characters provided by CloudStack for matching common values such as the user’s email address and name. CloudStack will search the external LDAP directory tree starting at a specified base directory and return the distinguished name (DN) and password of the matching user. This information along with the given password is used to authenticate the user..
	</div><div class="para">
		To set up LDAP authentication in CloudStack, call the CloudStack API command ldapConfig and provide the following:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Hostname or IP address and listening port of the LDAP server
			</div></li><li class="listitem"><div class="para">
				Base directory and query filter
			</div></li><li class="listitem"><div class="para">
				Search user DN credentials, which give CloudStack permission to search on the LDAP server
			</div></li><li class="listitem"><div class="para">
				SSL keystore and password, if SSL is used
			</div></li></ul></div><div xml:lang="en-US" class="section" id="example-LDAP-configuration-commands" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="example-LDAP-configuration-commands">3.2.1. Example LDAP Configuration Commands</h3></div></div></div><div class="para">
		To understand the examples in this section, you need to know the basic concepts behind calling the CloudStack API, which are explained in the Developer’s Guide.
	</div><div class="para">
		The following shows an example invocation of ldapConfig with an ApacheDS LDAP server
	</div><pre class="programlisting">http://127.0.0.1:8080/client/api?command=ldapConfig&amp;hostname=127.0.0.1&amp;searchbase=ou%3Dtesting%2Co%3Dproject&amp;queryfilter=%28%26%28uid%3D%25u%29%29&amp;binddn=cn%3DJohn+Singh%2Cou%3Dtesting%2Co%project&amp;bindpass=secret&amp;port=10389&amp;ssl=true&amp;truststore=C%3A%2Fcompany%2Finfo%2Ftrusted.ks&amp;truststorepass=secret&amp;response=json&amp;apiKey=YourAPIKey&amp;signature=YourSignatureHash</pre><div class="para">
		The command must be URL-encoded. Here is the same example without the URL encoding:
	</div><pre class="programlisting">http://127.0.0.1:8080/client/api?command=ldapConfig
&amp;hostname=127.0.0.1
&amp;searchbase=ou=testing,o=project
&amp;queryfilter=(&amp;(%uid=%u))
&amp;binddn=cn=John+Singh,ou=testing,o=project
&amp;bindpass=secret
&amp;port=10389
&amp;ssl=true
&amp;truststore=C:/company/info/trusted.ks
&amp;truststorepass=secret
&amp;response=json
&amp;apiKey=YourAPIKey&amp;signature=YourSignatureHash
</pre><div class="para">
		The following shows a similar command for Active Directory. Here, the search base is the testing group within a company, and the users are matched up based on email address.
	</div><pre class="programlisting">http://10.147.29.101:8080/client/api?command=ldapConfig&amp;hostname=10.147.28.250&amp;searchbase=OU%3Dtesting%2CDC%3Dcompany&amp;queryfilter=%28%26%28mail%3D%25e%29%29 &amp;binddn=CN%3DAdministrator%2COU%3Dtesting%2CDC%3Dcompany&amp;bindpass=1111_aaaa&amp;port=389&amp;response=json&amp;apiKey=YourAPIKey&amp;signature=YourSignatureHash</pre><div class="para">
		The next few sections explain some of the concepts you will need to know when filling out the ldapConfig parameters.
	</div></div><div xml:lang="en-US" class="section" id="search-base" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="search-base">3.2.2. Search Base</h3></div></div></div><div class="para">
		An LDAP query is relative to a given node of the LDAP directory tree, called the search base. The search base is the distinguished name (DN) of a level of the directory tree below which all users can be found. The users can be in the immediate base directory or in some subdirectory. The search base may be equivalent to the organization, group, or domain name. The syntax for writing a DN varies depending on which LDAP server you are using. A full discussion of distinguished names is outside the scope of our documentation. The following table shows some examples of search bases to find users in the testing department..
	</div><div class="informaltable"><table border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><thead><tr><th align="left">
						<div class="para">
							LDAP Server
						</div>
					</th><th align="left">
						<div class="para">
							Example Search Base DN
						</div>
					</th></tr></thead><tbody><tr><td align="left">
						<div class="para">
							ApacheDS
						</div>
					</td><td align="left">
						<div class="para">
							ou=testing,o=project
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Active Directory
						</div>
					</td><td align="left">
						<div class="para">
							OU=testing, DC=company
						</div>
					</td></tr></tbody></table></div></div><div xml:lang="en-US" class="section" id="query-filter" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="query-filter">3.2.3. Query Filter</h3></div></div></div><div class="para">
		The query filter is used to find a mapped user in the external LDAP server. The query filter should uniquely map the CloudPlatform user to LDAP user for a meaningful authentication. For more information about query filter syntax, consult the documentation for your LDAP server.
	</div><div class="para">
		The CloudPlatform query filter wildcards are:
	</div><div class="informaltable"><table border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><thead><tr><th align="left">
						<div class="para">
							Query Filter Wildcard
						</div>
					</th><th align="left">
						<div class="para">
							Description
						</div>
					</th></tr></thead><tbody><tr><td align="left">
						<div class="para">
							%u
						</div>
					</td><td align="left">
						<div class="para">
							User name
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							%e
						</div>
					</td><td align="left">
						<div class="para">
							Email address
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							%n
						</div>
					</td><td align="left">
						<div class="para">
							First and last name
						</div>
					</td></tr></tbody></table></div><div class="para">
		The following examples assume you are using Active Directory, and refer to user attributes from the Active Directory schema.
	</div><div class="para">
		If the CloudPlatform user name is the same as the LDAP user ID:
	</div><pre class="programlisting">(uid=%u)</pre><div class="para">
		If the CloudPlatform user name is the LDAP display name:
	</div><pre class="programlisting">(displayName=%u)</pre><div class="para">
		To find a user by email address:
	</div><pre class="programlisting">(mail=%e)</pre></div><div xml:lang="en-US" class="section" id="search-user-bind-dn" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="search-user-bind-dn">3.2.4. Search User Bind DN</h3></div></div></div><div class="para">
		The bind DN is the user on the external LDAP server permitted to search the LDAP directory within the defined search base. When the DN is returned, the DN and passed password are used to authenticate the CloudStack user with an LDAP bind. A full discussion of bind DNs is outside the scope of our documentation. The following table shows some examples of bind DNs.
	</div><div class="informaltable"><table border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><thead><tr><th align="left">
						<div class="para">
							LDAP Server
						</div>
					</th><th align="left">
						<div class="para">
							Example Bind DN
						</div>
					</th></tr></thead><tbody><tr><td align="left">
						<div class="para">
							ApacheDS
						</div>
					</td><td align="left">
						<div class="para">
							cn=Administrator,dc=testing,ou=project,ou=org
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Active Directory
						</div>
					</td><td align="left">
						<div class="para">
							CN=Administrator, OU=testing, DC=company, DC=com
						</div>
					</td></tr></tbody></table></div></div><div xml:lang="en-US" class="section" id="SSL-keystore-path-and-password" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="SSL-keystore-path-and-password">3.2.5. SSL Keystore Path and Password</h3></div></div></div><div class="para">
		If the LDAP server requires SSL, you need to enable it in the ldapConfig command by setting the parameters ssl, truststore, and truststorepass. Before enabling SSL for ldapConfig, you need to get the certificate which the LDAP server is using and add it to a trusted keystore. You will need to know the path to the keystore and the password.
	</div></div></div></div><div xml:lang="en-US" class="chapter" id="user-services-overview" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 4. User Services Overview</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#offerings-and-templates">4.1. Service Offerings, Disk Offerings, Network Offerings, and Templates</a></span></dt></dl></div><div class="para">
		In addition to the physical and logical infrastructure of your cloud, and the CloudStack software and servers, you also need a layer of user services so that people can actually make use of the cloud. This means not just a user UI, but a set of options and resources that users can choose from, such as templates for creating virtual machines, disk storage, and more. If you are running a commercial service, you will be keeping track of what services and resources users are consuming and charging them for that usage. Even if you do not charge anything for people to use your cloud – say, if the users are strictly internal to your organization, or just friends who are sharing your cloud – you can still keep track of what services they use and how much of them.
	</div><div class="section" id="offerings-and-templates"><div class="titlepage"><div><div><h2 class="title" id="offerings-and-templates">4.1. Service Offerings, Disk Offerings, Network Offerings, and Templates</h2></div></div></div><div class="para">
			A user creating a new instance can make a variety of choices about its characteristics and capabilities. CloudStack provides several ways to present users with choices when creating a new instance:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Service Offerings, defined by the CloudStack administrator, provide a choice of CPU speed, number of CPUs, RAM size, tags on the root disk, and other choices. See Creating a New Compute Offering.
				</div></li><li class="listitem"><div class="para">
					Disk Offerings, defined by the CloudStack administrator, provide a choice of disk size for primary data storage. See Creating a New Disk Offering.
				</div></li><li class="listitem"><div class="para">
					Network Offerings, defined by the CloudStack administrator, describe the feature set that is available to end users from the virtual router or external networking devices on a given guest network. See Network Offerings.
				</div></li><li class="listitem"><div class="para">
					Templates, defined by the CloudStack administrator or by any CloudStack user, are the base OS images that the user can choose from when creating a new instance. For example, CloudStack includes CentOS as a template. See Working with Templates.
				</div></li></ul></div><div class="para">
			In addition to these choices that are provided for users, there is another type of service offering which is available only to the CloudStack root administrator, and is used for configuring virtual infrastructure resources. For more information, see Upgrading a Virtual Router with System Service Offerings.
		</div></div></div><div xml:lang="en-US" class="chapter" id="ui" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 5. User Interface</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#log-in">5.1. Log In to the UI</a></span></dt><dd><dl><dt><span class="section"><a href="#end-user-ui-overview">5.1.1. End User's UI Overview</a></span></dt><dt><span class="section"><a href="#root-admin-ui-overview">5.1.2. Root Administrator's UI Overview</a></span></dt><dt><span class="section"><a href="#log-in-root-admin">5.1.3. Logging In as the Root Administrator</a></span></dt><dt><span class="section"><a href="#changing-root-password">5.1.4. Changing the Root Password</a></span></dt></dl></dd><dt><span class="section"><a href="#using-sshkeys">5.2. Using SSH Keys for Authentication</a></span></dt><dd><dl><dt><span class="section"><a href="#create-ssh-template">5.2.1.  Creating an Instance Template that Supports SSH Keys</a></span></dt><dt><span class="section"><a href="#create-ssh-keypair">5.2.2. Creating the SSH Keypair</a></span></dt><dt><span class="section"><a href="#creating-ssh-instance">5.2.3. Creating an Instance</a></span></dt><dt><span class="section"><a href="#logging-in-ssh">5.2.4. Logging In Using the SSH Keypair</a></span></dt></dl></dd></dl></div><div xml:lang="en-US" class="section" id="log-in" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="log-in">5.1. Log In to the UI</h2></div></div></div><div class="para">
		CloudStack provides a web-based UI that can be used by both administrators and end users. The appropriate version of the UI is displayed depending on the credentials used to log in. The UI is available in popular browsers including IE7, IE8, IE9, Firefox 3.5+, Firefox 4, Safari 4, and Safari 5. The URL is: (substitute your own management server IP address)
	</div><pre class="programlisting">http://&lt;management-server-ip-address&gt;:8080/client</pre><div class="para">
		On a fresh Management Server installation, a guided tour splash screen appears. On later visits, you’ll see a login screen where you specify the following to proceed to your Dashboard:
	</div><div class="formalpara"><h5 class="formalpara" id="idp5277688">Username</h5>
			The user ID of your account. The default username is admin.
		</div><div class="formalpara"><h5 class="formalpara" id="idp2873912">Password</h5>
			The password associated with the user ID. The password for the default username is password.
		</div><div class="formalpara"><h5 class="formalpara" id="idp131456">Domain</h5>
			If you are a root user, leave this field blank.
		</div><div class="para">
		If you are a user in the sub-domains, enter the full path to the domain, excluding the root domain.
	</div><div class="para">
		For example, suppose multiple levels are created under the root domain, such as Comp1/hr. The users in the Comp1 domain should enter Comp1 in the Domain field, whereas the users in the Comp1/sales domain should enter Comp1/sales.
	</div><div class="para">
		For more guidance about the choices that appear when you log in to this UI, see Logging In as the Root Administrator.
	</div><div xml:lang="en-US" class="section" id="end-user-ui-overview" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="end-user-ui-overview">5.1.1. End User's UI Overview</h3></div></div></div><div class="para">
		The CloudStack UI helps users of cloud infrastructure to view and use their cloud resources, including virtual machines, templates and ISOs, data volumes and snapshots, guest networks, and IP addresses. If the user is a member or administrator of one or more CloudStack projects, the UI can provide a project-oriented view.
	</div></div><div xml:lang="en-US" class="section" id="root-admin-ui-overview" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="root-admin-ui-overview">5.1.2. Root Administrator's UI Overview</h3></div></div></div><div class="para">
		The CloudStack UI helps the CloudStack administrator provision, view, and manage the cloud infrastructure, domains, user accounts, projects, and configuration settings. The first time you start the UI after a fresh Management Server installation, you can choose to follow a guided tour to provision your cloud infrastructure. On subsequent logins, the dashboard of the logged-in user appears. The various links in this screen and the navigation bar on the left provide access to a variety of administrative functions. The root administrator can also use the UI to perform all the same tasks that are present in the end-user’s UI.
	</div></div><div xml:lang="en-US" class="section" id="log-in-root-admin" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="log-in-root-admin">5.1.3. Logging In as the Root Administrator</h3></div></div></div><div class="para">
		After the Management Server software is installed and running, you can run the CloudStack user interface. This UI is there to help you provision, view, and manage your cloud infrastructure.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Open your favorite Web browser and go to this URL. Substitute the IP address of your own Management Server:
			</div><pre class="programlisting">http://&lt;management-server-ip-address&gt;:8080/client</pre><div class="para">
				On a fresh Management Server installation, a guided tour splash screen appears. On later visits, you’ll see a login screen where you can enter a user ID and password and proceed to your Dashboard.
			</div></li><li class="listitem"><div class="para">
				If you see the first-time splash screen, choose one of the following.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Continue with basic setup.</strong></span> Choose this if you're just trying CloudStack, and you want a guided walkthrough of the simplest possible configuration so that you can get started right away. We'll help you set up a cloud with the following features: a single machine that runs CloudStack software and uses NFS to provide storage; a single machine running VMs under the XenServer or KVM hypervisor; and a shared public network.
					</div><div class="para">
						The prompts in this guided tour should give you all the information you need, but if you want just a bit more detail, you can follow along in the Trial Installation Guide.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>I have used CloudStack before.</strong></span> Choose this if you have already gone through a design phase and planned a more sophisticated deployment, or you are ready to start scaling up a trial cloud that you set up earlier with the basic setup screens. In the Administrator UI, you can start using the more powerful features of CloudPlatform, such as advanced VLAN networking, high availability, additional network elements such as load balancers and firewalls, and support for multiple hypervisors including Citrix XenServer, KVM, and VMware vSphere.
					</div><div class="para">
						The root administrator Dashboard appears.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				You should set a new root administrator password. If you chose basic setup, you’ll be prompted to create a new password right away. If you chose experienced user, use the steps in <a class="xref" href="#changing-root-password">Section 5.1.4, “Changing the Root Password”</a>.
			</div></li></ol></div><div class="warning"><div class="admonition_header"><h2>Warning</h2></div><div class="admonition"><div class="para">
			You are logging in as the root administrator. This account manages the CloudStack deployment, including physical infrastructure. The root administrator can modify configuration settings to change basic functionality, create or delete user accounts, and take many actions that should be performed only by an authorized person. Please change the default password to a new, unique password.
		</div></div></div></div><div xml:lang="en-US" class="section" id="changing-root-password" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="changing-root-password">5.1.4. Changing the Root Password</h3></div></div></div><div class="para">
		During installation and ongoing cloud administration, you will need to log in to the UI as the root administrator. The root administrator account manages the CloudStack deployment, including physical infrastructure. The root administrator can modify configuration settings to change basic functionality, create or delete user accounts, and take many actions that should be performed only by an authorized person. When first installing CloudStack, be sure to change the default password to a new, unique value.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Open your favorite Web browser and go to this URL. Substitute the IP address of your own Management Server:
			</div><pre class="programlisting">http://&lt;management-server-ip-address&gt;:8080/client</pre></li><li class="listitem"><div class="para">
				Log in to the UI using the current root user ID and password. The default is admin, password.
			</div></li><li class="listitem"><div class="para">
				Click Accounts.
			</div></li><li class="listitem"><div class="para">
				Click the admin account name.
			</div></li><li class="listitem"><div class="para">
				Click View Users.
			</div></li><li class="listitem"><div class="para">
				Click the admin user name.
			</div></li><li class="listitem"><div class="para">
				Click the Change Password button. 
				<span class="inlinemediaobject"><img src="./images/change-password.png" alt="change-password.png: button to change a user's password" /></span>
			</div></li><li class="listitem"><div class="para">
				Type the new password, and click OK.
			</div></li></ol></div></div></div><div xml:lang="en-US" class="section" id="using-sshkeys" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="using-sshkeys">5.2. Using SSH Keys for Authentication</h2></div></div></div><div class="para">
		In addition to the username and password authentication, CloudStack supports using SSH keys to log in to the cloud infrastructure for additional security. You can use the createSSHKeyPair API to generate the SSH keys.
	</div><div class="para">
		Because each cloud user has their own SSH key, one cloud user cannot log in to another cloud user's instances unless they share their SSH key files. Using a single SSH key pair, you can manage multiple instances.
	</div><div class="section" id="create-ssh-template"><div class="titlepage"><div><div><h3 class="title" id="create-ssh-template">5.2.1.  Creating an Instance Template that Supports SSH Keys</h3></div></div></div><div class="para">
			Create a instance template that supports SSH Keys.
		</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					Create a new instance by using the template provided by cloudstack.
				</div><div class="para">
					For more information on creating a new instance, see
				</div></li><li class="listitem"><div class="para">
					Download the cloudstack script from <a href="http://sourceforge.net/projects/cloudstack/files/SSH%20Key%20Gen%20Script/">The SSH Key Gen Script</a>to the instance you have created.
				</div><pre class="programlisting">wget http://downloads.sourceforge.net/project/cloudstack/SSH%20Key%20Gen%20Script/cloud-set-guest-sshkey.in?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fcloudstack%2Ffiles%2FSSH%2520Key%2520Gen%2520Script%2F&amp;ts=1331225219&amp;use_mirror=iweb</pre></li><li class="listitem"><div class="para">
					Copy the file to /etc/init.d.
				</div><pre class="programlisting">cp cloud-set-guest-sshkey.in /etc/init.d/</pre></li><li class="listitem"><div class="para">
					Give the necessary permissions on the script:
				</div><pre class="programlisting">chmod +x /etc/init.d/cloud-set-guest-sshkey.in</pre></li><li class="listitem"><div class="para">
					Run the script while starting up the operating system:
				</div><pre class="programlisting">chkconfig --add cloud-set-guest-sshkey.in</pre></li><li class="listitem"><div class="para">
					Stop the instance.
				</div></li></ol></div></div><div class="section" id="create-ssh-keypair"><div class="titlepage"><div><div><h3 class="title" id="create-ssh-keypair">5.2.2. Creating the SSH Keypair</h3></div></div></div><div class="para">
			You must make a call to the createSSHKeyPair api method. You can either use the CloudStack Python API library or the curl commands to make the call to the cloudstack api.
		</div><div class="para">
			For example, make a call from the cloudstack server to create a SSH keypair called "keypair-doc" for the admin account in the root domain:
		</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
				Ensure that you adjust these values to meet your needs. If you are making the API call from a different server, your URL/PORT will be different, and you will need to use the API keys.
			</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					Run the following curl command:
				</div><pre class="programlisting">curl --globoff "http://localhost:8096/?command=createSSHKeyPair&amp;name=keypair-doc&amp;account=admin&amp;domainid=5163440e-c44b-42b5-9109-ad75cae8e8a2"</pre><div class="para">
					The output is something similar to what is given below:
				</div><pre class="programlisting">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;&lt;createsshkeypairresponse cloud-stack-version="3.0.0.20120228045507"&gt;&lt;keypair&gt;&lt;name&gt;keypair-doc&lt;/name&gt;&lt;fingerprint&gt;f6:77:39:d5:5e:77:02:22:6a:d8:7f:ce:ab:cd:b3:56&lt;/fingerprint&gt;&lt;privatekey&gt;-----BEGIN RSA PRIVATE KEY-----
MIICXQIBAAKBgQCSydmnQ67jP6lNoXdX3noZjQdrMAWNQZ7y5SrEu4wDxplvhYci
dXYBeZVwakDVsU2MLGl/K+wefwefwefwefwefJyKJaogMKn7BperPD6n1wIDAQAB
AoGAdXaJ7uyZKeRDoy6wA0UmF0kSPbMZCR+UTIHNkS/E0/4U+6lhMokmFSHtu
mfDZ1kGGDYhMsdytjDBztljawfawfeawefawfawfawQQDCjEsoRdgkduTy
QpbSGDIa11Jsc+XNDx2fgRinDsxXI/zJYXTKRhSl/LIPHBw/brW8vzxhOlSOrwm7
VvemkkgpAkEAwSeEw394LYZiEVv395ar9MLRVTVLwpo54jC4tsOxQCBlloocK
lYaocpk0yBqqOUSBawfIiDCuLXSdvBo1Xz5ICTM19vgvEp/+kMuECQBzm
nVo8b2Gvyagqt/KEQo8wzH2THghZ1qQ1QRhIeJG2aissEacF6bGB2oZ7Igim5L14
4KR7OeEToyCLC2k+02UCQQCrniSnWKtDVoVqeK/zbB32JhW3Wullv5p5zUEcd
KfEEuzcCUIxtJYTahJ1pvlFkQ8anpuxjSEDp8x/18bq3
-----END RSA PRIVATE KEY-----
&lt;/privatekey&gt;&lt;/keypair&gt;&lt;/createsshkeypairresponse&gt;</pre></li><li class="listitem"><div class="para">
					Copy the key data into a file. The file looks like this:
				</div><pre class="programlisting">-----BEGIN RSA PRIVATE KEY-----
MIICXQIBAAKBgQCSydmnQ67jP6lNoXdX3noZjQdrMAWNQZ7y5SrEu4wDxplvhYci
dXYBeZVwakDVsU2MLGl/K+wefwefwefwefwefJyKJaogMKn7BperPD6n1wIDAQAB
AoGAdXaJ7uyZKeRDoy6wA0UmF0kSPbMZCR+UTIHNkS/E0/4U+6lhMokmFSHtu
mfDZ1kGGDYhMsdytjDBztljawfawfeawefawfawfawQQDCjEsoRdgkduTy
QpbSGDIa11Jsc+XNDx2fgRinDsxXI/zJYXTKRhSl/LIPHBw/brW8vzxhOlSOrwm7
VvemkkgpAkEAwSeEw394LYZiEVv395ar9MLRVTVLwpo54jC4tsOxQCBlloocK
lYaocpk0yBqqOUSBawfIiDCuLXSdvBo1Xz5ICTM19vgvEp/+kMuECQBzm
nVo8b2Gvyagqt/KEQo8wzH2THghZ1qQ1QRhIeJG2aissEacF6bGB2oZ7Igim5L14
4KR7OeEToyCLC2k+02UCQQCrniSnWKtDVoVqeK/zbB32JhW3Wullv5p5zUEcd
KfEEuzcCUIxtJYTahJ1pvlFkQ8anpuxjSEDp8x/18bq3
-----END RSA PRIVATE KEY-----</pre></li><li class="listitem"><div class="para">
					Save the file.
				</div></li></ol></div></div><div class="section" id="creating-ssh-instance"><div class="titlepage"><div><div><h3 class="title" id="creating-ssh-instance">5.2.3. Creating an Instance</h3></div></div></div><div class="para">
			After you save the SSH keypair file, you must create an instance by using the template that you created at <a class="xref" href="#create-ssh-template">Section 5.2.1, “ Creating an Instance Template that Supports SSH Keys”</a>. Ensure that you use the same SSH key name that you created at <a class="xref" href="#create-ssh-keypair">Section 5.2.2, “Creating the SSH Keypair”</a>.
		</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
				You cannot create the instance by using the GUI at this time and associate the instance with the newly created SSH keypair.
			</div></div></div><div class="para">
			A sample curl command to create a new instance is:
		</div><pre class="programlisting">curl --globoff http://localhost:&lt;port numbet&gt;/?command=deployVirtualMachine\&amp;zoneId=1\&amp;serviceOfferingId=18727021-7556-4110-9322-d625b52e0813\&amp;templateId=e899c18a-ce13-4bbf-98a9-625c5026e0b5\&amp;securitygroupids=ff03f02f-9e3b-48f8-834d-91b822da40c5\&amp;account=admin\&amp;domainid=1\&amp;keypair=keypair-doc</pre><div class="para">
			Substitute the template, service offering and security group IDs (if you are using the security group feature) that are in your cloud environment.
		</div></div><div class="section" id="logging-in-ssh"><div class="titlepage"><div><div><h3 class="title" id="logging-in-ssh">5.2.4. Logging In Using the SSH Keypair</h3></div></div></div><div class="para">
			To test your SSH key generation is successful, check whether you can log in to the cloud setup.
		</div><div class="para">
			For exaple, from a Linux OS, run:
		</div><pre class="programlisting">ssh -i ~/.ssh/keypair-doc &lt;ip address&gt;</pre><div class="para">
			The -i parameter tells the ssh client to use a ssh key found at ~/.ssh/keypair-doc.
		</div></div></div></div><div xml:lang="en-US" class="chapter" id="projects" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 6. Using Projects to Organize Users and Resources</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#projects-overview">6.1. Overview of Projects</a></span></dt><dt><span class="section"><a href="#configuring-projects">6.2. Configuring Projects</a></span></dt><dd><dl><dt><span class="section"><a href="#set-up-invitations">6.2.1. Setting Up Invitations</a></span></dt><dt><span class="section"><a href="#set-resource-limits-for-projects">6.2.2. Setting Resource Limits for Projects</a></span></dt><dt><span class="section"><a href="#set-projects-creator-permissions">6.2.3. Setting Project Creator Permissions</a></span></dt></dl></dd><dt><span class="section"><a href="#create-new-projects">6.3. Creating a New Project</a></span></dt><dt><span class="section"><a href="#add-members-to-projects">6.4. Adding Members to a Project</a></span></dt><dd><dl><dt><span class="section"><a href="#send-projects-membership-invitation">6.4.1. Sending Project Membership Invitations</a></span></dt><dt><span class="section"><a href="#add-projects-members-from-ui">6.4.2. Adding Project Members From the UI</a></span></dt></dl></dd><dt><span class="section"><a href="#accept-membership-invite">6.5. Accepting a Membership Invitation</a></span></dt><dt><span class="section"><a href="#suspend-project">6.6. Suspending or Deleting a Project</a></span></dt><dt><span class="section"><a href="#use-project-view">6.7. Using the Project View</a></span></dt></dl></div><div xml:lang="en-US" class="section" id="projects-overview" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="projects-overview">6.1. Overview of Projects</h2></div></div></div><div class="para">
		Projects are used to organize people and resources. CloudStack users within a single domain can group themselves into project teams so they can collaborate and share virtual resources such as VMs, snapshots, templates, data disks, and IP addresses. CloudStack tracks resource usage per project as well as per user, so the usage can be billed to either a user account or a project. For example, a private cloud within a software company might have all members of the QA department assigned to one project, so the company can track the resources used in testing while the project members can more easily isolate their efforts from other users of the same cloud
	</div><div class="para">
		You can configure CloudStack to allow any user to create a new project, or you can restrict that ability to just CloudStack administrators. Once you have created a project, you become that project’s administrator, and you can add others within your domain to the project. CloudStack can be set up either so that you can add people directly to a project, or so that you have to send an invitation which the recipient must accept. Project members can view and manage all virtual resources created by anyone in the project (for example, share VMs). A user can be a member of any number of projects and can switch views in the CloudStack UI to show only project-related information, such as project VMs, fellow project members, project-related alerts, and so on.
	</div><div class="para">
		The project administrator can pass on the role to another project member. The project administrator can also add more members, remove members from the project, set new resource limits (as long as they are below the global defaults set by the CloudStack administrator), and delete the project. When the administrator removes a member from the project, resources created by that user, such as VM instances, remain with the project. This brings us to the subject of resource ownership and which resources can be used by a project.
	</div><div class="para">
		Resources created within a project are owned by the project, not by any particular CloudStack account, and they can be used only within the project. A user who belongs to one or more projects can still create resources outside of those projects, and those resources belong to the user’s account; they will not be counted against the project’s usage or resource limits. You can create project-level networks to isolate traffic within the project and provide network services such as port forwarding, load balancing, VPN, and static NAT. A project can also make use of certain types of resources from outside the project, if those resources are shared. For example, a shared network or public template is available to any project in the domain. A project can get access to a private template if the template’s owner will grant permission. A project can use any service offering or disk offering available in its domain; however, you can not create private service and disk offerings at the project level..
	</div></div><div xml:lang="en-US" class="section" id="configuring-projects" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="configuring-projects">6.2. Configuring Projects</h2></div></div></div><div class="para">
		Before CloudPlatform users start using projects, the CloudPlatform administrator must set up various systems to support them, including membership invitations, limits on project resources, and controls on who can create projects.
	</div><div xml:lang="en-US" class="section" id="set-up-invitations" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="set-up-invitations">6.2.1. Setting Up Invitations</h3></div></div></div><div class="para">
		CloudStack can be set up either so that project administrators can add people directly to a project, or so that it is necessary to send an invitation which the recipient must accept. The invitation can be sent by email or through the user’s CloudStack account. If you want administrators to use invitations to add members to projects, turn on and set up the invitations feature in CloudStack.
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Log in as administrator to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Global Settings.
			</div></li><li class="listitem"><div class="para">
				In the search box, type project and click the search button.
			</div></li><li class="listitem"><div class="para">
				In the search box, type project and click the search button.
				<span class="inlinemediaobject"><img src="./images/search-button.png" alt="searchbutton.png: Searches projects" /></span>
			</div></li><li class="listitem"><div class="para">
				In the search results, you will see a few other parameters you need to set to control how invitations behave. The table below shows global configuration parameters related to project invitations. Click the edit button to set each parameter
			</div><div class="informaltable"><table border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><thead><tr><th align="left">
								<div class="para">
									Configuration Parameters
								</div>
							</th><th align="left">
								<div class="para">
									Description
								</div>
							</th></tr></thead><tbody><tr><td align="left">
								<div class="para">
									project.invite.required
								</div>
							</td><td align="left">
								<div class="para">
									Set to true to turn on the invitations feature.
								</div>
							</td></tr><tr><td align="left">
								<div class="para">
									project.email.sender
								</div>
							</td><td align="left">
								<div class="para">
									The email address to show in the From field of invitation emails.
								</div>
							</td></tr><tr><td align="left">
								<div class="para">
									project.invite.timeout
								</div>
							</td><td align="left">
								<div class="para">
									Amount of time to allow for a new member to respond to the invitation.
								</div>
							</td></tr><tr><td align="left">
								<div class="para">
									project.smtp.host
								</div>
							</td><td align="left">
								<div class="para">
									Name of the host that acts as an email server to handle invitations.
								</div>
							</td></tr><tr><td align="left">
								<div class="para">
									project.smtp.password
								</div>
							</td><td align="left">
								<div class="para">
									(Optional) Password required by the SMTP server. You must also set project.smtp.username and set project.smtp.useAuth to true.
								</div>
							</td></tr><tr><td align="left">
								<div class="para">
									project.smtp.port
								</div>
							</td><td align="left">
								<div class="para">
									SMTP server’s listening port.
								</div>
							</td></tr><tr><td align="left">
								<div class="para">
									project.smtp.useAuth
								</div>
							</td><td align="left">
								<div class="para">
									Set to true if the SMTP server requires a username and password.
								</div>
							</td></tr><tr><td align="left">
								<div class="para">
									project.smtp.username
								</div>
							</td><td align="left">
								<div class="para">
									(Optional) User name required by the SMTP server for authentication. You must also set project.smtp.password and set project.smtp.useAuth to true..
								</div>
							</td></tr></tbody></table></div></li><li class="listitem"><div class="para">
				Restart the Management Server
			</div><pre class="programlisting">service cloud-management restart</pre></li></ul></div></div><div xml:lang="en-US" class="section" id="set-resource-limits-for-projects" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="set-resource-limits-for-projects">6.2.2. Setting Resource Limits for Projects</h3></div></div></div><div class="para">
		The CloudStack administrator can set global default limits to control the amount of resources that can be owned by each project in the cloud. This serves to prevent uncontrolled usage of resources such as snapshots, IP addresses, and virtual machine instances. Domain administrators can override these resource limits for individual projects with their domains, as long as the new limits are below the global defaults set by the CloudStack root administrator. The root administrator can also set lower resource limits for any project in the cloud
	</div><div xml:lang="en-US" class="section" id="set-per-project-resource-limits" lang="en-US"><div class="titlepage"><div><div><h4 class="title" id="set-per-project-resource-limits">6.2.2.1. Setting Per-Project Resource Limits</h4></div></div></div><div class="para">
		The CloudStack root administrator or the domain administrator of the domain where the project resides can set new resource limits for an individual project. The project owner can set resource limits only if the owner is also a domain or root administrator.
	</div><div class="para">
		The new limits must be below the global default limits set by the CloudStack administrator (as described in <a class="xref" href="#set-resource-limits-for-projects">Section 6.2.2, “Setting Resource Limits for Projects”</a>). If the project already owns more of a given type of resource than the new maximum, the resources are not affected; however, the project can not add any new resources of that type until the total drops below the new limit.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in as administrator to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Projects.
			</div></li><li class="listitem"><div class="para">
				In Select View, choose Projects.
			</div></li><li class="listitem"><div class="para">
				Click the name of the project you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click the Resources tab. This tab lists the current maximum amount that the project is allowed to own for each type of resource.
			</div></li><li class="listitem"><div class="para">
				Type new values for one or more resources.
			</div></li><li class="listitem"><div class="para">
				Click Apply.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="set-global-project-resource-limits" lang="en-US"><div class="titlepage"><div><div><h4 class="title" id="set-global-project-resource-limits">6.2.2.2. Setting the Global Project Resource Limits</h4></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in as administrator to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Global Settings.
			</div></li><li class="listitem"><div class="para">
				In the search box, type max.projects and click the search button.
			</div></li><li class="listitem"><div class="para">
				In the search results, you will see the parameters you can use to set per-project maximum resource amounts that apply to all projects in the cloud. No project can have more resources, but an individual project can have lower limits. Click the edit button to set each parameter. 
				<span class="inlinemediaobject"><img src="./images/edit-icon.png" alt="editbutton.png: Edits parameters" /></span>
			</div><div class="informaltable"><table border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><tbody><tr><td align="left">
								<div class="para">
									max.project.public.ips
								</div>
							</td><td align="left">
								<div class="para">
									Maximum number of public IP addresses that can be owned by any project in the cloud. See About Public IP Addresses.
								</div>
							</td></tr><tr><td align="left">
								<div class="para">
									max.project.snapshots
								</div>
							</td><td align="left">
								<div class="para">
									Maximum number of snapshots that can be owned by any project in the cloud. See Working with Snapshots.
								</div>
							</td></tr><tr><td align="left">
								<div class="para">
									max.project.templates
								</div>
							</td><td align="left">
								<div class="para">
									Maximum number of templates that can be owned by any project in the cloud. See Working with Templates.
								</div>
							</td></tr><tr><td align="left">
								<div class="para">
									max.project.uservms
								</div>
							</td><td align="left">
								<div class="para">
									Maximum number of guest virtual machines that can be owned by any project in the cloud. See Working With Virtual Machines.
								</div>
							</td></tr><tr><td align="left">
								<div class="para">
									max.project.volumes
								</div>
							</td><td align="left">
								<div class="para">
									Maximum number of data volumes that can be owned by any project in the cloud. See Working with Volumes.
								</div>
							</td></tr></tbody></table></div></li><li class="listitem"><div class="para">
				Restart the Management Server.
			</div><pre class="programlisting"># service cloud-management restart</pre></li></ol></div></div></div><div xml:lang="en-US" class="section" id="set-projects-creator-permissions" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="set-projects-creator-permissions">6.2.3. Setting Project Creator Permissions</h3></div></div></div><div class="para">
		You can configure CloudStack to allow any user to create a new project, or you can restrict that ability to just CloudStack administrators.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in as administrator to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Global Settings.
			</div></li><li class="listitem"><div class="para">
				In the search box, type allow.user.create.projects.
			</div></li><li class="listitem"><div class="para">
				Click the edit button to set the parameter.
				<span class="inlinemediaobject"><img src="./images/edit-icon.png" alt="editbutton.png: Edits parameters" /></span>
			</div><div class="informaltable"><table border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><tbody><tr><td align="left">
								<div class="para">
									allow.user.create.projects
								</div>
							</td><td align="left">
								<div class="para">
									Set to true to allow end users to create projects. Set to false if you want only the CloudStack root administrator and domain administrators to create projects.
								</div>
							</td></tr></tbody></table></div></li><li class="listitem"><div class="para">
				Restart the Management Server.
			</div><pre class="programlisting"># service cloud-management restart</pre></li></ol></div></div></div><div xml:lang="en-US" class="section" id="create-new-projects" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="create-new-projects">6.3. Creating a New Project</h2></div></div></div><div class="para">
		CloudStack administrators and domain administrators can create projects. If the global configuration parameter allow.user.create.projects is set to true, end users can also create projects.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in as administrator to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Projects.
			</div></li><li class="listitem"><div class="para">
				In Select view, click Projects.
			</div></li><li class="listitem"><div class="para">
				Click New Project.
			</div></li><li class="listitem"><div class="para">
				Give the project a name and description for display to users, then click Create Project.
			</div></li><li class="listitem"><div class="para">
				A screen appears where you can immediately add more members to the project. This is optional. Click Next when you are ready to move on.
			</div></li><li class="listitem"><div class="para">
				Click Save.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="add-members-to-projects" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="add-members-to-projects">6.4. Adding Members to a Project</h2></div></div></div><div class="para">
		New members can be added to a project by the project’s administrator, the domain administrator of the domain where the project resides or any parent domain, or the CloudStack root administrator. There are two ways to add members in CloudStack, but only one way is enabled at a time:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				If invitations have been enabled, you can send invitations to new members.
			</div></li><li class="listitem"><div class="para">
				If invitations are not enabled, you can add members directly through the UI.
			</div></li></ul></div><div xml:lang="en-US" class="section" id="send-projects-membership-invitation" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="send-projects-membership-invitation">6.4.1. Sending Project Membership Invitations</h3></div></div></div><div class="para">
		Use these steps to add a new member to a project if the invitations feature is enabled in the cloud as described in <a class="xref" href="#set-up-invitations">Section 6.2.1, “Setting Up Invitations”</a>. If the invitations feature is not turned on, use the procedure in Adding Project Members From the UI.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Projects.
			</div></li><li class="listitem"><div class="para">
				In Select View, choose Projects.
			</div></li><li class="listitem"><div class="para">
				Click the name of the project you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click the Invitations tab.
			</div></li><li class="listitem"><div class="para">
				In Add by, select one of the following:
			</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
						Account – The invitation will appear in the user’s Invitations tab in the Project View. See Using the Project View.
					</div></li><li class="listitem"><div class="para">
						Email – The invitation will be sent to the user’s email address. Each emailed invitation includes a unique code called a token which the recipient will provide back to CloudStack when accepting the invitation. Email invitations will work only if the global parameters related to the SMTP server have been set. See <a class="xref" href="#set-up-invitations">Section 6.2.1, “Setting Up Invitations”</a>.
					</div></li></ol></div></li><li class="listitem"><div class="para">
				Type the user name or email address of the new member you want to add, and click Invite. Type the CloudStack user name if you chose Account in the previous step. If you chose Email, type the email address. You can invite only people who have an account in this cloud within the same domain as the project. However, you can send the invitation to any email address.
			</div></li><li class="listitem"><div class="para">
				To view and manage the invitations you have sent, return to this tab. When an invitation is accepted, the new member will appear in the project’s Accounts tab.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="add-projects-members-from-ui" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-projects-members-from-ui">6.4.2. Adding Project Members From the UI</h3></div></div></div><div class="para">
		The steps below tell how to add a new member to a project if the invitations feature is not enabled in the cloud. If the invitations feature is enabled cloud,as described in <a class="xref" href="#set-up-invitations">Section 6.2.1, “Setting Up Invitations”</a>, use the procedure in <a class="xref" href="#send-projects-membership-invitation">Section 6.4.1, “Sending Project Membership Invitations”</a>.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Projects.
			</div></li><li class="listitem"><div class="para">
				In Select View, choose Projects.
			</div></li><li class="listitem"><div class="para">
				Click the name of the project you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click the Accounts tab. The current members of the project are listed.
			</div></li><li class="listitem"><div class="para">
				Type the account name of the new member you want to add, and click Add Account. You can add only people who have an account in this cloud and within the same domain as the project.
			</div></li></ol></div></div></div><div xml:lang="en-US" class="section" id="accept-membership-invite" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="accept-membership-invite">6.5. Accepting a Membership Invitation</h2></div></div></div><div class="para">
		If you have received an invitation to join a CloudStack project, and you want to accept the invitation, follow these steps:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Projects.
			</div></li><li class="listitem"><div class="para">
				In Select View, choose Invitations.
			</div></li><li class="listitem"><div class="para">
				If you see the invitation listed onscreen, click the Accept button.
			</div><div class="para">
				Invitations listed on screen were sent to you using your CloudStack account name.
			</div></li><li class="listitem"><div class="para">
				If you received an email invitation, click the Enter Token button, and provide the project ID and unique ID code (token) from the email.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="suspend-project" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="suspend-project">6.6. Suspending or Deleting a Project</h2></div></div></div><div class="para">
		When a project is suspended, it retains the resources it owns, but they can no longer be used. No new resources or members can be added to a suspended project.
	</div><div class="para">
		When a project is deleted, its resources are destroyed, and member accounts are removed from the project. The project’s status is shown as Disabled pending final deletion.
	</div><div class="para">
		A project can be suspended or deleted by the project administrator, the domain administrator of the domain the project belongs to or of its parent domain, or the CloudStack root administrator.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Projects.
			</div></li><li class="listitem"><div class="para">
				In Select View, choose Projects.
			</div></li><li class="listitem"><div class="para">
				Click the name of the project.
			</div></li><li class="listitem"><div class="para">
				Click one of the buttons:
			</div><div class="para">
				To delete, use 
				<span class="inlinemediaobject"><img src="./images/delete-button.png" alt="deletebutton.png: Removes a project" /></span>
			</div><div class="para">
				To suspend, use
				<span class="inlinemediaobject"><img src="./images/suspend-icon.png" alt="deletebutton.png: suspends a project" /></span>
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="use-project-view" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="use-project-view">6.7. Using the Project View</h2></div></div></div><div class="para">
		If you are a member of a project, you can use CloudStack’s project view to see project members, resources consumed, and more. The project view shows only information related to one project. It is a useful way to filter out other information so you can concentrate on a project status and resources.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				Click Project View.
			</div></li><li class="listitem"><div class="para">
				The project dashboard appears, showing the project’s VMs, volumes, users, events, network settings, and more. From the dashboard, you can:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Click the Accounts tab to view and manage project members. If you are the project administrator, you can add new members, remove members, or change the role of a member from user to admin. Only one member at a time can have the admin role, so if you set another user’s role to admin, your role will change to regular user.
					</div></li><li class="listitem"><div class="para">
						(If invitations are enabled) Click the Invitations tab to view and manage invitations that have been sent to new project members but not yet accepted. Pending invitations will remain in this list until the new member accepts, the invitation timeout is reached, or you cancel the invitation.
					</div></li></ul></div></li></ol></div></div></div><div xml:lang="en-US" class="chapter" id="provisioning-steps" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 7. Steps to Provisioning Your Cloud Infrastructure</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#provisioning-steps-overview">7.1. Overview of Provisioning Steps</a></span></dt><dt><span class="section"><a href="#zone-add">7.2. Adding a Zone</a></span></dt><dd><dl><dt><span class="section"><a href="#basic-zone-configuration">7.2.1. Basic Zone Configuration</a></span></dt><dt><span class="section"><a href="#advanced-zone-configuration">7.2.2. Advanced Zone Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#pod-add">7.3. Adding a Pod</a></span></dt><dt><span class="section"><a href="#cluster-add">7.4. Adding a Cluster</a></span></dt><dd><dl><dt><span class="section"><a href="#add-clusters-kvm-xenserver">7.4.1. Add Cluster: KVM or XenServer</a></span></dt><dt><span class="section"><a href="#add-clusters-vsphere">7.4.2. Add Cluster: vSphere</a></span></dt></dl></dd><dt><span class="section"><a href="#host-add">7.5. Adding a Host</a></span></dt><dd><dl><dt><span class="section"><a href="#host-add-xenserver-kvm-ovm">7.5.1. Adding a Host (XenServer or KVM)</a></span></dt><dt><span class="section"><a href="#host-add-vsphere">7.5.2. Adding a Host (vSphere)</a></span></dt></dl></dd><dt><span class="section"><a href="#primary-storage-add">7.6. Add Primary Storage</a></span></dt><dd><dl><dt><span class="section"><a href="#sys-require-primary-storage">7.6.1. System Requirements for Primary Storage</a></span></dt><dt><span class="section"><a href="#adding-primary-storage">7.6.2. Adding Primary Stroage</a></span></dt></dl></dd><dt><span class="section"><a href="#secondary-storage-add">7.7. Add Secondary Storage</a></span></dt><dd><dl><dt><span class="section"><a href="#sys-require-secondary-storage">7.7.1. System Requirements for Secondary Storage</a></span></dt><dt><span class="section"><a href="#adding-secondary-storage">7.7.2. Adding Secondary Storage</a></span></dt></dl></dd><dt><span class="section"><a href="#initialize-and-test">7.8. Initialize and Test</a></span></dt></dl></div><div class="para">
		This section tells how to add zones, pods, clusters, hosts, storage, and networks to your cloud. If you are unfamiliar with these entities, please begin by looking through <a class="xref" href="#cloud-infrastructure-concepts">Chapter 2, <em>Cloud Infrastructure Concepts</em></a>.
	</div><div xml:lang="en-US" class="section" id="provisioning-steps-overview" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="provisioning-steps-overview">7.1. Overview of Provisioning Steps</h2></div></div></div><div class="para">
		After the Management Server is installed and running, you can add the compute resources for it to manage. For an overview of how a CloudStack cloud infrastructure is organized, see <a class="xref" href="#cloud-infrastructure-overview">Section 1.3.2, “Cloud Infrastructure Overview”</a>.
	</div><div class="para">
		To provision the cloud infrastructure, or to scale it up at any time, follow these procedures:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Change the root password. See <a class="xref" href="#changing-root-password">Section 5.1.4, “Changing the Root Password”</a>.
			</div></li><li class="listitem"><div class="para">
				Add a zone. See <a class="xref" href="#zone-add">Section 7.2, “Adding a Zone”</a>.
			</div></li><li class="listitem"><div class="para">
				Add more pods (optional). See <a class="xref" href="#pod-add">Section 7.3, “Adding a Pod”</a>.
			</div></li><li class="listitem"><div class="para">
				Add more clusters (optional). See <a class="xref" href="#cluster-add">Section 7.4, “Adding a Cluster”</a>.
			</div></li><li class="listitem"><div class="para">
				Add more hosts (optional). See <a class="xref" href="#host-add">Section 7.5, “Adding a Host”</a>.
			</div></li><li class="listitem"><div class="para">
				Add primary storage. See <a class="xref" href="#primary-storage-add">Section 7.6, “Add Primary Storage”</a>.
			</div></li><li class="listitem"><div class="para">
				Add secondary storage. See <a class="xref" href="#secondary-storage-add">Section 7.7, “Add Secondary Storage”</a>.
			</div></li><li class="listitem"><div class="para">
				Initialize and test the new cloud. See <a class="xref" href="#initialize-and-test">Section 7.8, “Initialize and Test”</a>.
			</div></li></ol></div><div class="para">
		When you have finished these steps, you will have a deployment with the following basic structure:
	</div><div class="mediaobject"><img src="./images/provisioning-overview.png" width="444" alt="provisioning-overview.png: Conceptual overview of a basic deployment" /></div></div><div xml:lang="en-US" class="section" id="zone-add" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="zone-add">7.2. Adding a Zone</h2></div></div></div><div class="para">
		These steps assume you have already logged in to the CloudStack UI. See <a class="xref" href="#log-in">Section 5.1, “Log In to the UI”</a>.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				(Optional) If you are going to use Swift for cloud-wide secondary storage, you need to add it before you add zones.
			</div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
						Log in to the CloudStack UI as administrator.
					</div></li><li class="listitem"><div class="para">
						If this is your first time visiting the UI, you will see the guided tour splash screen. Choose “Experienced user.” The Dashboard appears.
					</div></li><li class="listitem"><div class="para">
						In the left navigation bar, click Global Settings.
					</div></li><li class="listitem"><div class="para">
						In the search box, type swift.enable and click the search button.
					</div></li><li class="listitem"><div class="para">
						Click the edit button and set swift.enable to true. 
						<span class="inlinemediaobject"><img src="./images/edit-icon.png" alt="edit-icon.png: button to modify data" /></span>

					</div></li><li class="listitem"><div class="para">
						Restart the Management Server.
					</div><pre class="programlisting"># service cloud-management restart</pre></li><li class="listitem"><div class="para">
						Refresh the CloudStack UI browser tab and log back in.
					</div></li></ol></div></li><li class="listitem"><div class="para">
				In the left navigation, choose Infrastructure.
			</div></li><li class="listitem"><div class="para">
				On Zones, click View More.
			</div></li><li class="listitem"><div class="para">
				(Optional) If you are using Swift storage, click Enable Swift. Provide the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>URL.</strong></span> The Swift URL.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Account.</strong></span> The Swift account.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Username.</strong></span> The Swift account’s username.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Key.</strong></span> The Swift key.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click Add Zone. The zone creation wizard will appear.
			</div></li><li class="listitem"><div class="para">
				Choose one of the following network types:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Basic.</strong></span> For AWS-style networking. Provides a single network where each VM instance is assigned an IP directly from the network. Guest isolation can be provided through layer-3 means such as security groups (IP address source filtering).
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Advanced.</strong></span> For more sophisticated network topologies. This network model provides the most flexibility in defining guest networks and providing custom network offerings such as firewall, VPN, or load balancer support.
					</div></li></ul></div><div class="para">
				For more information about the network types, see Network Setup.
			</div></li><li class="listitem"><div class="para">
				The rest of the steps differ depending on whether you chose Basic or Advanced. Continue with the steps that apply to you:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<a class="xref" href="#basic-zone-configuration">Section 7.2.1, “Basic Zone Configuration”</a>
					</div></li><li class="listitem"><div class="para">
						<a class="xref" href="#advanced-zone-configuration">Section 7.2.2, “Advanced Zone Configuration”</a>
					</div></li></ul></div></li></ol></div><div xml:lang="en-US" class="section" id="basic-zone-configuration" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="basic-zone-configuration">7.2.1. Basic Zone Configuration</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				After you select Basic in the Add Zone wizard and click Next, you will be asked to enter the following details. Then click Next.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name.</strong></span> A name for the zone.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>DNS 1 and 2.</strong></span> These are DNS servers for use by guest VMs in the zone. These DNS servers will be accessed via the public network you will add later. The public IP addresses for the zone must have a route to the DNS server named here.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Internal DNS 1 and Internal DNS 2.</strong></span> These are DNS servers for use by system VMs in the zone (these are VMs used by CloudStack itself, such as virtual routers, console proxies, and Secondary Storage VMs.) These DNS servers will be accessed via the management traffic network interface of the System VMs. The private IP address you provide for the pods must have a route to the internal DNS server named here.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Hypervisor.</strong></span> (Introduced in version 3.0.1) Choose the hypervisor for the first cluster in the zone. You can add clusters with different hypervisors later, after you finish adding the zone.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Network Offering.</strong></span> Your choice here determines what network services will be available on the network for guest VMs.
					</div><div class="informaltable"><table border="1"><colgroup><col align="left" class="c1" width="50%" /><col align="left" class="c2" width="50%" /></colgroup><thead><tr><th align="left">
										<div class="para">
											Network Offering
										</div>
									</th><th align="left">
										<div class="para">
											Description
										</div>
									</th></tr></thead><tbody><tr><td align="left">
										<div class="para">
											DefaultSharedNetworkOfferingWithSGService
										</div>
									</td><td align="left">
										<div class="para">
											If you want to enable security groups for guest traffic isolation, choose this. (See Using Security Groups to Control Traffic to VMs.)
										</div>
									</td></tr><tr><td align="left">
										<div class="para">
											DefaultSharedNetworkOffering
										</div>
									</td><td align="left">
										<div class="para">
											If you do not need security groups, choose this.
										</div>
									</td></tr><tr><td align="left">
										<div class="para">
											DefaultSharedNetscalerEIPandELBNetworkOffering
										</div>
									</td><td align="left">
										<div class="para">
											If you have installed a Citrix NetScaler appliance as part of your zone network, and you will be using its Elastic IP and Elastic Load Balancing features, choose this. With the EIP and ELB features, a basic zone with security groups enabled can offer 1:1 static NAT and load balancing.
										</div>
									</td></tr></tbody></table></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Network Domain.</strong></span> (Optional) If you want to assign a special domain name to the guest VM network, specify the DNS suffix.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public.</strong></span> A public zone is available to all users. A zone that is not public will be assigned to a particular domain. Only users in that domain will be allowed to create guest VMs in this zone.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Choose which traffic types will be carried by the physical network.
			</div><div class="para">
				The traffic types are management, public, guest, and storage traffic. For more information about the types, roll over the icons to display their tool tips, or see Basic Zone Network Traffic Types. This screen starts out with some traffic types already assigned. To add more, drag and drop traffic types onto the network. You can also change the network name if desired.
			</div></li><li class="listitem"><div class="para">
				(Introduced in version 3.0.1) Assign a network traffic label to each traffic type on the physical network. These labels must match the labels you have already defined on the hypervisor host. To assign each label, click the Edit button under the traffic type icon. A popup dialog appears where you can type the label, then click OK.
			</div><div class="para">
				These traffic labels will be defined only for the hypervisor selected for the first cluster. For all other hypervisors, the labels can be configured after the zone is created.
			</div></li><li class="listitem"><div class="para">
				Click Next.
			</div></li><li class="listitem"><div class="para">
				(NetScaler only) If you chose the network offering for NetScaler, you have an additional screen to fill out. Provide the requested details to set up the NetScaler, then click Next.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IP address.</strong></span> The NSIP (NetScaler IP) address of the NetScaler device.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Username/Password.</strong></span> The authentication credentials to access the device. CloudStack uses these credentials to access the device.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Type.</strong></span> NetScaler device type that is being added. It could be NetScaler VPX, NetScaler MPX, or NetScaler SDX. For a comparison of the types, see About Using a NetScaler Load Balancer.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public interface.</strong></span> Interface of NetScaler that is configured to be part of the public network.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Private interface.</strong></span> Interface of NetScaler that is configured to be part of the private network.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Number of retries.</strong></span> Number of times to attempt a command on the device before considering the operation failed. Default is 2.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Capacity.</strong></span> Number of guest networks/accounts that will share this NetScaler device.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Dedicated.</strong></span> When marked as dedicated, this device will be dedicated to a single account. When Dedicated is checked, the value in the Capacity field has no significance – implicitly, its value is 1.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				(NetScaler only) Configure the IP range for public traffic. The IPs in this range will be used for the static NAT capability which you enabled by selecting the network offering for NetScaler with EIP and ELB. Enter the following details, then click Add. If desired, you can repeat this step to add more IP ranges. When done, click Next.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Gateway.</strong></span> The gateway in use for these IP addresses.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Netmask.</strong></span> The netmask associated with this IP range.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VLAN.</strong></span> The VLAN that will be used for public traffic.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start IP/End IP.</strong></span> A range of IP addresses that are assumed to be accessible from the Internet and will be allocated for access to guest VMs.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				In a new zone, CloudStack adds the first pod for you. You can always add more pods later. For an overview of what a pod is, see <a class="xref" href="#about-pods">Section 2.2, “About Pods”</a>.
			</div><div class="para">
				To configure the first pod, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Pod Name.</strong></span> A name for the pod.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Reserved system gateway.</strong></span> The gateway for the hosts in that pod.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Reserved system netmask.</strong></span> The network prefix that defines the pod's subnet. Use CIDR notation.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start/End Reserved System IP.</strong></span> The IP range in the management network that CloudStack uses to manage various system VMs, such as Secondary Storage VMs, Console Proxy VMs, and DHCP. For more information, see System Reserved IP Addresses.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Configure the network for guest traffic. Provide the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Guest gateway.</strong></span> The gateway that the guests should use.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Guest netmask.</strong></span> The netmask in use on the subnet the guests will use.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Guest start IP/End IP.</strong></span> Enter the first and last IP addresses that define a range that CloudStack can assign to guests.
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								We strongly recommend the use of multiple NICs. If multiple NICs are used, they may be in a different subnet.
							</div></li><li class="listitem"><div class="para">
								If one NIC is used, these IPs should be in the same CIDR as the pod CIDR.
							</div></li></ul></div></li></ul></div></li><li class="listitem"><div class="para">
				In a new pod, CloudStack adds the first cluster for you. You can always add more clusters later. For an overview of what a cluster is, see About Clusters.
			</div><div class="para">
				To configure the first cluster, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Hypervisor.</strong></span> (Version 3.0.0 only; in 3.0.1, this field is read only) Choose the type of hypervisor software that all hosts in this cluster will run. If you choose VMware, additional fields appear so you can give information about a vSphere cluster. For vSphere servers, we recommend creating the cluster of hosts in vCenter and then adding the entire cluster to CloudStack. See Add Cluster: vSphere.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Cluster name.</strong></span> Enter a name for the cluster. This can be text of your choosing and is not used by CloudStack.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				In a new cluster, CloudStack adds the first host for you. You can always add more hosts later. For an overview of what a host is, see About Hosts.
			</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					When you add a hypervisor host to CloudStack, the host must not have any VMs already running.
				</div></div></div><div class="para">
				Before you can configure the host, you need to install the hypervisor software on the host. You will need to know which version of the hypervisor software version is supported by CloudStack and what additional configuration is required to ensure the host will work with CloudStack. To find these installation details, see:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Citrix XenServer Installation and Configuration
					</div></li><li class="listitem"><div class="para">
						VMware vSphere Installation and Configuration
					</div></li><li class="listitem"><div class="para">
						KVM vSphere Installation and Configuration
					</div></li></ul></div><div class="para">
				To configure the first host, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Host Name.</strong></span> The DNS name or IP address of the host.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Username.</strong></span> The username is root.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Password.</strong></span> This is the password for the user named above (from your XenServer or KVM install).
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Host Tags.</strong></span> (Optional) Any labels that you use to categorize hosts for ease of maintenance. For example, you can set this to the cloud's HA tag (set in the ha.tag global configuration parameter) if you want this host to be used only for VMs with the "high availability" feature enabled. For more information, see HA-Enabled Virtual Machines as well as HA for Hosts.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				In a new cluster, CloudPlatform adds the first primary storage server for you. You can always add more servers later. For an overview of what primary storage is, see About Primary Storage.
			</div><div class="para">
				To configure the first primary storage server, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name.</strong></span> The name of the storage device.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol.</strong></span> For XenServer, choose either NFS, iSCSI, or PreSetup. For KVM, choose NFS, SharedMountPoint,CLVM, or RBD. For vSphere choose either VMFS (iSCSI or FiberChannel) or NFS. The remaining fields in the screen vary depending on what you choose here.
					</div></li></ul></div></li></ol></div></div><div xml:lang="en-US" class="section" id="advanced-zone-configuration" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="advanced-zone-configuration">7.2.2. Advanced Zone Configuration</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				After you select Advanced in the Add Zone wizard and click Next, you will be asked to enter the following details. Then click Next.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name.</strong></span> A name for the zone.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>DNS 1 and 2.</strong></span> These are DNS servers for use by guest VMs in the zone. These DNS servers will be accessed via the public network you will add later. The public IP addresses for the zone must have a route to the DNS server named here.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Internal DNS 1 and Internal DNS 2.</strong></span> These are DNS servers for use by system VMs in the zone(these are VMs used by CloudStack itself, such as virtual routers, console proxies,and Secondary Storage VMs.) These DNS servers will be accessed via the management traffic network interface of the System VMs. The private IP address you provide for the pods must have a route to the internal DNS server named here.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Network Domain.</strong></span> (Optional) If you want to assign a special domain name to the guest VM network, specify the DNS suffix.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Guest CIDR.</strong></span> This is the CIDR that describes the IP addresses in use in the guest virtual networks in this zone. For example, 10.1.1.0/24. As a matter of good practice you should set different CIDRs for different zones. This will make it easier to set up VPNs between networks in different zones.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Hypervisor.</strong></span> (Introduced in version 3.0.1) Choose the hypervisor for the first cluster in the zone. You can add clusters with different hypervisors later, after you finish adding the zone.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public.</strong></span> A public zone is available to all users. A zone that is not public will be assigned to a particular domain. Only users in that domain will be allowed to create guest VMs in this zone.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Choose which traffic types will be carried by the physical network.
			</div><div class="para">
				The traffic types are management, public, guest, and storage traffic. For more information about the types, roll over the icons to display their tool tips, or see <a class="xref" href="#advanced-zone-network-traffic-types">Section 2.7.4, “Advanced Zone Network Traffic Types”</a>. This screen starts out with one network already configured. If you have multiple physical networks, you need to add more. Drag and drop traffic types onto a greyed-out network and it will become active. You can move the traffic icons from one network to another; for example, if the default traffic types shown for Network 1 do not match your actual setup, you can move them down. You can also change the network names if desired.
			</div></li><li class="listitem"><div class="para">
				(Introduced in version 3.0.1) Assign a network traffic label to each traffic type on each physical network. These labels must match the labels you have already defined on the hypervisor host. To assign each label, click the Edit button under the traffic type icon within each physical network. A popup dialog appears where you can type the label, then click OK.
			</div><div class="para">
				These traffic labels will be defined only for the hypervisor selected for the first cluster. For all other hypervisors, the labels can be configured after the zone is created.
			</div></li><li class="listitem"><div class="para">
				Click Next.
			</div></li><li class="listitem"><div class="para">
				Configure the IP range for public Internet traffic. Enter the following details, then click Add. If desired, you can repeat this step to add more public Internet IP ranges. When done, click Next.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Gateway.</strong></span> The gateway in use for these IP addresses.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Netmask.</strong></span> The netmask associated with this IP range.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VLAN.</strong></span> The VLAN that will be used for public traffic.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start IP/End IP.</strong></span> A range of IP addresses that are assumed to be accessible from the Internet and will be allocated for access to guest networks.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				In a new zone, CloudStack adds the first pod for you. You can always add more pods later. For an overview of what a pod is, see <a class="xref" href="#about-pods">Section 2.2, “About Pods”</a>.
			</div><div class="para">
				To configure the first pod, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Pod Name.</strong></span> A name for the pod.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Reserved system gateway.</strong></span> The gateway for the hosts in that pod.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Reserved system netmask.</strong></span> The network prefix that defines the pod's subnet. Use CIDR notation.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start/End Reserved System IP.</strong></span> The IP range in the management network that CloudStack uses to manage various system VMs, such as Secondary Storage VMs, Console Proxy VMs, and DHCP. For more information, see <a class="xref" href="#system-reserved-ip-addresses">Section 2.7.7, “System Reserved IP Addresses”</a>.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Specify a range of VLAN IDs to carry guest traffic for each physical network (see VLAN Allocation Example ), then click Next.
			</div></li><li class="listitem"><div class="para">
				In a new pod, CloudStack adds the first cluster for you. You can always add more clusters later. For an overview of what a cluster is, see <a class="xref" href="#about-clusters">Section 2.3, “About Clusters”</a>.
			</div><div class="para">
				To configure the first cluster, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Hypervisor.</strong></span> (Version 3.0.0 only; in 3.0.1, this field is read only) Choose the type of hypervisor software that all hosts in this cluster will run. If you choose VMware, additional fields appear so you can give information about a vSphere cluster. For vSphere servers, we recommend creating the cluster of hosts in vCenter and then adding the entire cluster to CloudStack. See Add Cluster: vSphere .
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Cluster name.</strong></span> Enter a name for the cluster. This can be text of your choosing and is not used by CloudStack.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				In a new cluster, CloudStack adds the first host for you. You can always add more hosts later. For an overview of what a host is, see <a class="xref" href="#about-hosts">Section 2.4, “About Hosts”</a>.
			</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					When you deploy CloudStack, the hypervisor host must not have any VMs already running.
				</div></div></div><div class="para">
				Before you can configure the host, you need to install the hypervisor software on the host. You will need to know which version of the hypervisor software version is supported by CloudStack and what additional configuration is required to ensure the host will work with CloudStack. To find these installation details, see:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Citrix XenServer Installation for CloudStack
					</div></li><li class="listitem"><div class="para">
						VMware vSphere Installation and Configuration
					</div></li><li class="listitem"><div class="para">
						KVM Installation and Configuration
					</div></li></ul></div><div class="para">
				To configure the first host, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Host Name.</strong></span> The DNS name or IP address of the host.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Username.</strong></span> Usually root.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Password.</strong></span> This is the password for the user named above (from your XenServer or KVM install).
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Host Tags.</strong></span> (Optional) Any labels that you use to categorize hosts for ease of maintenance. For example, you can set to the cloud's HA tag (set in the ha.tag global configuration parameter) if you want this host to be used only for VMs with the "high availability" feature enabled. For more information, see HA-Enabled Virtual Machines as well as HA for Hosts, both in the Administration Guide.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				In a new cluster, CloudStack adds the first primary storage server for you. You can always add more servers later. For an overview of what primary storage is, see <a class="xref" href="#about-primary-storage">Section 2.5, “About Primary Storage”</a>.
			</div><div class="para">
				To configure the first primary storage server, enter the following, then click Next:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name.</strong></span> The name of the storage device.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol.</strong></span> For XenServer, choose either NFS, iSCSI, or PreSetup. For KVM, choose NFS, SharedMountPoint, CLVM, and RBD. For vSphere choose either VMFS (iSCSI or FiberChannel) or NFS. The remaining fields in the screen vary depending on what you choose here.
					</div><div class="informaltable"><table border="1"><colgroup><col align="left" class="c1" width="50%" /><col align="left" class="c2" width="50%" /></colgroup><tbody><tr><td align="left">
										<div class="para">
											NFS
										</div>
									</td><td align="left">
										<div class="itemizedlist"><ul><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Server.</strong></span> The IP address or DNS name of the storage device.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Path.</strong></span> The exported path from the server.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Tags (optional).</strong></span> The comma-separated list of tags for this storage device. It should be an equivalent set or superset of the tags on your disk offerings.
												</div></li></ul></div>
										 <div class="para">
											The tag sets on primary storage across clusters in a Zone must be identical. For example, if cluster A provides primary storage that has tags T1 and T2, all other clusters in the Zone must also provide primary storage that has tags T1 and T2.
										</div>

									</td></tr><tr><td align="left">
										<div class="para">
											iSCSI
										</div>
									</td><td align="left">
										<div class="itemizedlist"><ul><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Server.</strong></span> The IP address or DNS name of the storage device.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Target IQN.</strong></span> The IQN of the target. For example, iqn.1986-03.com.sun:02:01ec9bb549-1271378984.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Lun.</strong></span> The LUN number. For example, 3.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Tags (optional).</strong></span> The comma-separated list of tags for this storage device. It should be an equivalent set or superset of the tags on your disk offerings.
												</div></li></ul></div>
										 <div class="para">
											The tag sets on primary storage across clusters in a Zone must be identical. For example, if cluster A provides primary storage that has tags T1 and T2, all other clusters in the Zone must also provide primary storage that has tags T1 and T2.
										</div>

									</td></tr><tr><td align="left">
										<div class="para">
											preSetup
										</div>
									</td><td align="left">
										<div class="itemizedlist"><ul><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Server.</strong></span> The IP address or DNS name of the storage device.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>SR Name-Label.</strong></span> Enter the name-label of the SR that has been set up outside CloudStack.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Tags (optional).</strong></span> The comma-separated list of tags for this storage device. It should be an equivalent set or superset of the tags on your disk offerings.
												</div></li></ul></div>
										 <div class="para">
											The tag sets on primary storage across clusters in a Zone must be identical. For example, if cluster A provides primary storage that has tags T1 and T2, all other clusters in the Zone must also provide primary storage that has tags T1 and T2.
										</div>

									</td></tr><tr><td align="left">
										<div class="para">
											SharedMountPoint
										</div>
									</td><td align="left">
										<div class="itemizedlist"><ul><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Path.</strong></span> The path on each host that is where this primary storage is mounted. For example, "/mnt/primary".
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Tags (optional).</strong></span> The comma-separated list of tags for this storage device. It should be an equivalent set or superset of the tags on your disk offerings.
												</div></li></ul></div>
										 <div class="para">
											The tag sets on primary storage across clusters in a Zone must be identical. For example, if cluster A provides primary storage that has tags T1 and T2, all other clusters in the Zone must also provide primary storage that has tags T1 and T2.
										</div>

									</td></tr><tr><td align="left">
										<div class="para">
											VMFS
										</div>
									</td><td align="left">
										<div class="itemizedlist"><ul><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Server.</strong></span> The IP address or DNS name of the vCenter server.
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Path.</strong></span> A combination of the datacenter name and the datastore name. The format is "/" datacenter name "/" datastore name. For example, "/cloud.dc.VM/cluster1datastore".
												</div></li><li class="listitem"><div class="para">
													<span class="bold bold"><strong>Tags (optional).</strong></span> The comma-separated list of tags for this storage device. It should be an equivalent set or superset of the tags on your disk offerings.
												</div></li></ul></div>
										 <div class="para">
											The tag sets on primary storage across clusters in a Zone must be identical. For example, if cluster A provides primary storage that has tags T1 and T2, all other clusters in the Zone must also provide primary storage that has tags T1 and T2.
										</div>

									</td></tr></tbody></table></div></li></ul></div></li><li class="listitem"><div class="para">
				In a new zone, CloudStack adds the first secondary storage server for you. For an overview of what secondary storage is, see <a class="xref" href="#about-secondary-storage">Section 2.6, “About Secondary Storage”</a>.
			</div><div class="para">
				Before you can fill out this screen, you need to prepare the secondary storage by setting up NFS shares and installing the latest CloudStack System VM template. See Adding Secondary Storage :
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>NFS Server.</strong></span> The IP address of the server.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Path.</strong></span> The exported path from the server.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click Launch.
			</div></li></ol></div></div></div><div xml:lang="en-US" class="section" id="pod-add" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="pod-add">7.3. Adding a Pod</h2></div></div></div><div class="para">
		When you created a new zone, CloudStack adds the first pod for you. You can add more pods at any time using the procedure in this section.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI. See <a class="xref" href="#log-in">Section 5.1, “Log In to the UI”</a>.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Infrastructure. In Zones, click View More, then click the zone to which you want to add a pod.
			</div></li><li class="listitem"><div class="para">
				Click the Compute and Storage tab. In the Pods node of the diagram, click View All.
			</div></li><li class="listitem"><div class="para">
				Click Add Pod.
			</div></li><li class="listitem"><div class="para">
				Enter the following details in the dialog.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name.</strong></span> The name of the pod.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Gateway.</strong></span> The gateway for the hosts in that pod.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Netmask.</strong></span> The network prefix that defines the pod's subnet. Use CIDR notation.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start/End Reserved System IP.</strong></span> The IP range in the management network that CloudStack uses to manage various system VMs, such as Secondary Storage VMs, Console Proxy VMs, and DHCP. For more information, see System Reserved IP Addresses.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click OK.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="cluster-add" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="cluster-add">7.4. Adding a Cluster</h2></div></div></div><div class="para">
		You need to tell CloudStack about the hosts that it will manage. Hosts exist inside clusters, so before you begin adding hosts to the cloud, you must add at least one cluster.
	</div><div xml:lang="en-US" class="section" id="add-clusters-kvm-xenserver" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-clusters-kvm-xenserver">7.4.1. Add Cluster: KVM or XenServer</h3></div></div></div><div class="para">
		These steps assume you have already installed the hypervisor on the hosts and logged in to the CloudStack UI.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				In the left navigation, choose Infrastructure. In Zones, click View More, then click the zone in which you want to add the cluster.
			</div></li><li class="listitem"><div class="para">
				Click the Compute tab.
			</div></li><li class="listitem"><div class="para">
				In the Clusters node of the diagram, click View All.
			</div></li><li class="listitem"><div class="para">
				Click Add Cluster.
			</div></li><li class="listitem"><div class="para">
				Choose the hypervisor type for this cluster.
			</div></li><li class="listitem"><div class="para">
				Choose the pod in which you want to create the cluster.
			</div></li><li class="listitem"><div class="para">
				Enter a name for the cluster. This can be text of your choosing and is not used by CloudStack.
			</div></li><li class="listitem"><div class="para">
				Click OK.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="add-clusters-vsphere" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-clusters-vsphere">7.4.2. Add Cluster: vSphere</h3></div></div></div><div class="para">
		Host management for vSphere is done through a combination of vCenter and the CloudStack admin UI. CloudStack requires that all hosts be in a CloudStack cluster, but the cluster may consist of a single host. As an administrator you must decide if you would like to use clusters of one host or of multiple hosts. Clusters of multiple hosts allow for features like live migration. Clusters also require shared storage such as NFS or iSCSI.
	</div><div class="para">
		For vSphere servers, we recommend creating the cluster of hosts in vCenter and then adding the entire cluster to CloudStack. Follow these requirements:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Do not put more than 8 hosts in a vSphere cluster
			</div></li><li class="listitem"><div class="para">
				Make sure the hypervisor hosts do not have any VMs already running before you add them to CloudStack.
			</div></li></ul></div><div class="para">
		To add a vSphere cluster to CloudStack:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Create the cluster of hosts in vCenter. Follow the vCenter instructions to do this. You will create a cluster that looks something like this in vCenter.
			</div><div class="mediaobject"><img src="./images/vsphere-client.png" width="444" alt="vsphereclient.png: vSphere client" /></div></li><li class="listitem"><div class="para">
				Log in to the UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Infrastructure. In Zones, click View More, then click the zone in which you want to add the cluster.
			</div></li><li class="listitem"><div class="para">
				Click the Compute tab, and click View All on Pods. Choose the pod to which you want to add the cluster.
			</div></li><li class="listitem"><div class="para">
				Click View Clusters.
			</div></li><li class="listitem"><div class="para">
				Click Add Cluster.
			</div></li><li class="listitem"><div class="para">
				In Hypervisor, choose VMware.
			</div></li><li class="listitem"><div class="para">
				Provide the following information in the dialog. The fields below make reference to values from vCenter.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Cluster Name. Enter the name of the cluster you created in vCenter. For example, "cloud.cluster.2.2.1"
					</div></li><li class="listitem"><div class="para">
						vCenter Host. Enter the hostname or IP address of the vCenter server.
					</div></li><li class="listitem"><div class="para">
						vCenter Username. Enter the username that CloudStack should use to connect to vCenter. This user must have all administrative privileges.
					</div></li><li class="listitem"><div class="para">
						vCenter Password. Enter the password for the user named above
					</div></li><li class="listitem"><div class="para">
						vCenter Datacenter. Enter the vCenter datacenter that the cluster is in. For example, "cloud.dc.VM".
					</div></li><li class="listitem"><div class="mediaobject"><img src="./images/add-cluster.png" alt="addcluster.png: add cluster" /></div><div class="para">
						There might be a slight delay while the cluster is provisioned. It will automatically display in the UI
					</div></li></ul></div></li></ol></div></div></div><div xml:lang="en-US" class="section" id="host-add" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="host-add">7.5. Adding a Host</h2></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Before adding a host to the CloudStack configuration, you must first install your chosen hypervisor on the host. CloudStack can manage hosts running VMs under a variety of hypervisors.
			</div><div class="para">
				The CloudStack Installation Guide provides instructions on how to install each supported hypervisor and configure it for use with CloudStack. See the appropriate section in the Installation Guide for information about which version of your chosen hypervisor is supported, as well as crucial additional steps to configure the hypervisor hosts for use with CloudStack.
			</div><div class="warning"><div class="admonition_header"><h2>Warning</h2></div><div class="admonition"><div class="para">
					Be sure you have performed the additional CloudStack-specific configuration steps described in the hypervisor installation section for your particular hypervisor.
				</div></div></div></li><li class="listitem"><div class="para">
				Now add the hypervisor host to CloudStack. The technique to use varies depending on the hypervisor.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<a class="xref" href="#host-add-xenserver-kvm-ovm">Section 7.5.1, “Adding a Host (XenServer or KVM)”</a>
					</div></li><li class="listitem"><div class="para">
						<a class="xref" href="#host-add-vsphere">Section 7.5.2, “Adding a Host (vSphere)”</a>
					</div></li></ul></div></li></ol></div><div xml:lang="en-US" class="section" id="host-add-xenserver-kvm-ovm" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="host-add-xenserver-kvm-ovm">7.5.1. Adding a Host (XenServer or KVM)</h3></div></div></div><div class="para">
		XenServer and KVM hosts can be added to a cluster at any time.
	</div><div class="section"><div class="titlepage"><div><div><h4 class="title" id="idm3410912">7.5.1.1. Requirements for XenServer and KVM Hosts</h4></div></div></div><div class="warning"><div class="admonition_header"><h2>Warning</h2></div><div class="admonition"><div class="para">
				Make sure the hypervisor host does not have any VMs already running before you add it to CloudStack.
			</div></div></div><div class="para">
			Configuration requirements:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Each cluster must contain only hosts with the identical hypervisor.
				</div></li><li class="listitem"><div class="para">
					For XenServer, do not put more than 8 hosts in a cluster.
				</div></li><li class="listitem"><div class="para">
					For KVM, do not put more than 16 hosts in a cluster.
				</div></li></ul></div><div class="para">
			For hardware requirements, see the installation section for your hypervisor in the CloudStack Installation Guide.
		</div><div class="section"><div class="titlepage"><div><div><h5 class="title" id="idm2666856">7.5.1.1.1. XenServer Host Additional Requirements</h5></div></div></div><div class="para">
				If network bonding is in use, the administrator must cable the new host identically to other hosts in the cluster.
			</div><div class="para">
				For all additional hosts to be added to the cluster, run the following command. This will cause the host to join the master in a XenServer pool.
			</div><pre class="programlisting"># xe pool-join master-address=[master IP] master-username=root master-password=[your password]</pre><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					When copying and pasting a command, be sure the command has pasted as a single line before executing. Some document viewers may introduce unwanted line breaks in copied text.
				</div></div></div><div class="para">
				With all hosts added to the XenServer pool, run the cloud-setup-bond script. This script will complete the configuration and setup of the bonds on the new hosts in the cluster.
			</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
						Copy the script from the Management Server in /usr/lib64/cloud/common/scripts/vm/hypervisor/xenserver/cloud-setup-bonding.sh to the master host and ensure it is executable.
					</div></li><li class="listitem"><div class="para">
						Run the script:
					</div><pre class="programlisting"># ./cloud-setup-bonding.sh</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title" id="idp11312632">7.5.1.1.2. KVM Host Additional Requirements</h5></div></div></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						If shared mountpoint storage is in use, the administrator should ensure that the new host has all the same mountpoints (with storage mounted) as the other hosts in the cluster.
					</div></li><li class="listitem"><div class="para">
						Make sure the new host has the same network configuration (guest, private, and public network) as other hosts in the cluster.
					</div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title" id="idp5433448">7.5.1.2. Adding a XenServer or KVM Host</h4></div></div></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					If you have not already done so, install the hypervisor software on the host. You will need to know which version of the hypervisor software version is supported by CloudStack and what additional configuration is required to ensure the host will work with CloudStack. To find these installation details, see the appropriate section for your hypervisor in the CloudStack Installation Guide.
				</div></li><li class="listitem"><div class="para">
					Log in to the CloudStack UI as administrator.
				</div></li><li class="listitem"><div class="para">
					In the left navigation, choose Infrastructure. In Zones, click View More, then click the zone in which you want to add the host.
				</div></li><li class="listitem"><div class="para">
					Click the Compute tab. In the Clusters node, click View All.
				</div></li><li class="listitem"><div class="para">
					Click the cluster where you want to add the host.
				</div></li><li class="listitem"><div class="para">
					Click View Hosts.
				</div></li><li class="listitem"><div class="para">
					Click Add Host.
				</div></li><li class="listitem"><div class="para">
					Provide the following information.
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							Host Name. The DNS name or IP address of the host.
						</div></li><li class="listitem"><div class="para">
							Username. Usually root.
						</div></li><li class="listitem"><div class="para">
							Password. This is the password for the user from your XenServer or KVM install).
						</div></li><li class="listitem"><div class="para">
							Host Tags (Optional). Any labels that you use to categorize hosts for ease of maintenance. For example, you can set to the cloud's HA tag (set in the ha.tag global configuration parameter) if you want this host to be used only for VMs with the "high availability" feature enabled. For more information, see HA-Enabled Virtual Machines as well as HA for Hosts.
						</div></li></ul></div><div class="para">
					There may be a slight delay while the host is provisioned. It should automatically display in the UI.
				</div></li><li class="listitem"><div class="para">
					Repeat for additional hosts.
				</div></li></ul></div></div></div><div xml:lang="en-US" class="section" id="host-add-vsphere" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="host-add-vsphere">7.5.2. Adding a Host (vSphere)</h3></div></div></div><div class="para">
		For vSphere servers, we recommend creating the cluster of hosts in vCenter and then adding the entire cluster to CloudStack. See Add Cluster: vSphere.
	</div></div></div><div xml:lang="en-US" class="section" id="primary-storage-add" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="primary-storage-add">7.6. Add Primary Storage</h2></div></div></div><div class="section" id="sys-require-primary-storage"><div class="titlepage"><div><div><h3 class="title" id="sys-require-primary-storage">7.6.1. System Requirements for Primary Storage</h3></div></div></div><div class="para">
			Hardware requirements:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Any standards-compliant iSCSI or NFS server that is supported by the underlying hypervisor.
				</div></li><li class="listitem"><div class="para">
					The storage server should be a machine with a large number of disks. The disks should ideally be managed by a hardware RAID controller.
				</div></li><li class="listitem"><div class="para">
					Minimum required capacity depends on your needs.
				</div></li></ul></div><div class="para">
			When setting up primary storage, follow these restrictions:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Primary storage cannot be added until a host has been added to the cluster.
				</div></li><li class="listitem"><div class="para">
					If you do not provision shared primary storage, you must set the global configuration parameter system.vm.local.storage.required to true, or else you will not be able to start VMs.
				</div></li></ul></div></div><div class="section" id="adding-primary-storage"><div class="titlepage"><div><div><h3 class="title" id="adding-primary-storage">7.6.2. Adding Primary Stroage</h3></div></div></div><div class="para">
			When you create a new zone, the first primary storage is added as part of that procedure. You can add primary storage servers at any time, such as when adding a new cluster or adding more servers to an existing cluster.
		</div><div class="warning"><div class="admonition_header"><h2>Warning</h2></div><div class="admonition"><div class="para">
				Be sure there is nothing stored on the server. Adding the server to CloudStack will destroy any existing data.
			</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					Log in to the CloudStack UI (see <a class="xref" href="#log-in">Section 5.1, “Log In to the UI”</a>).
				</div></li><li class="listitem"><div class="para">
					In the left navigation, choose Infrastructure. In Zones, click View More, then click the zone in which you want to add the primary storage.
				</div></li><li class="listitem"><div class="para">
					Click the Compute tab.
				</div></li><li class="listitem"><div class="para">
					In the Primary Storage node of the diagram, click View All.
				</div></li><li class="listitem"><div class="para">
					Click Add Primary Storage.
				</div></li><li class="listitem"><div class="para">
					Provide the following information in the dialog. The information required varies depending on your choice in Protocol.
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Pod.</strong></span> The pod for the storage device.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Cluster.</strong></span> The cluster for the storage device.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Name.</strong></span> The name of the storage device.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Protocol.</strong></span> For XenServer, choose either NFS, iSCSI, or PreSetup. For KVM, choose NFS or SharedMountPoint. For vSphere choose either VMFS (iSCSI or FiberChannel) or NFS.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Server (for NFS, iSCSI, or PreSetup).</strong></span> The IP address or DNS name of the storage device.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Server (for VMFS).</strong></span> The IP address or DNS name of the vCenter server.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Path (for NFS).</strong></span> In NFS this is the exported path from the server.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Path (for VMFS).</strong></span> In vSphere this is a combination of the datacenter name and the datastore name. The format is "/" datacenter name "/" datastore name. For example, "/cloud.dc.VM/cluster1datastore".
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Path (for SharedMountPoint).</strong></span> With KVM this is the path on each host that is where this primary storage is mounted. For example, "/mnt/primary".
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>SR Name-Label (for PreSetup).</strong></span> Enter the name-label of the SR that has been set up outside CloudStack.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Target IQN (for iSCSI).</strong></span> In iSCSI this is the IQN of the target. For example, iqn.1986-03.com.sun:02:01ec9bb549-1271378984.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Lun # (for iSCSI).</strong></span> In iSCSI this is the LUN number. For example, 3.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Tags (optional).</strong></span> The comma-separated list of tags for this storage device. It should be an equivalent set or superset of the tags on your disk offerings..
						</div></li></ul></div><div class="para">
					The tag sets on primary storage across clusters in a Zone must be identical. For example, if cluster A provides primary storage that has tags T1 and T2, all other clusters in the Zone must also provide primary storage that has tags T1 and T2.
				</div></li><li class="listitem"><div class="para">
					Click OK.
				</div></li></ol></div></div></div><div xml:lang="en-US" class="section" id="secondary-storage-add" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="secondary-storage-add">7.7. Add Secondary Storage</h2></div></div></div><div class="section" id="sys-require-secondary-storage"><div class="titlepage"><div><div><h3 class="title" id="sys-require-secondary-storage">7.7.1. System Requirements for Secondary Storage</h3></div></div></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					NFS storage appliance or Linux NFS server
				</div></li><li class="listitem"><div class="para">
					(Optional) OpenStack Object Storage (Swift) (see http://swift.openstack.org)
				</div></li><li class="listitem"><div class="para">
					100GB minimum capacity
				</div></li><li class="listitem"><div class="para">
					A secondary storage device must be located in the same zone as the guest VMs it serves.
				</div></li><li class="listitem"><div class="para">
					Each Secondary Storage server must be available to all hosts in the zone.
				</div></li></ul></div></div><div class="section" id="adding-secondary-storage"><div class="titlepage"><div><div><h3 class="title" id="adding-secondary-storage">7.7.2. Adding Secondary Storage</h3></div></div></div><div class="para">
			When you create a new zone, the first secondary storage is added as part of that procedure. You can add secondary storage servers at any time to add more servers to an existing zone.
		</div><div class="warning"><div class="admonition_header"><h2>Warning</h2></div><div class="admonition"><div class="para">
				Be sure there is nothing stored on the server. Adding the server to CloudStack will destroy any existing data.
			</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
					If you are going to use Swift for cloud-wide secondary storage, you must add the Swift storage to CloudStack before you add the local zone secondary storage servers. See <a class="xref" href="#zone-add">Section 7.2, “Adding a Zone”</a>.
				</div></li><li class="listitem"><div class="para">
					To prepare for local zone secondary storage, you should have created and mounted an NFS share during Management Server installation. <span>See Preparing NFS Shares in the Installation Guide.</span>
				</div></li><li class="listitem"><div class="para">
					Make sure you prepared the system VM template during Management Server installation. <span>See Prepare the System VM Template in the Installation Guide.</span>
				</div></li><li class="listitem"><div class="para">
					Now that the secondary storage server for per-zone storage is prepared, add it to CloudStack. Secondary storage is added as part of the procedure for adding a new zone. See <a class="xref" href="#zone-add">Section 7.2, “Adding a Zone”</a>.
				</div></li></ol></div></div></div><div xml:lang="en-US" class="section" id="initialize-and-test" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="initialize-and-test">7.8. Initialize and Test</h2></div></div></div><div class="para">
		After everything is configured, CloudStack will perform its initialization. This can take 30 minutes or more, depending on the speed of your network. When the initialization has completed successfully, the administrator's Dashboard should be displayed in the CloudStack UI.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Verify that the system is ready. In the left navigation bar, select Templates. Click on the CentOS 5.5 (64bit) no Gui (KVM) template. Check to be sure that the status is "Download Complete." Do not proceed to the next step until this status is displayed.
			</div></li><li class="listitem"><div class="para">
				Go to the Instances tab, and filter by My Instances.
			</div></li><li class="listitem"><div class="para">
				Click Add Instance and follow the steps in the wizard.
			</div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
						Choose the zone you just added.
					</div></li><li class="listitem"><div class="para">
						In the template selection, choose the template to use in the VM. If this is a fresh installation, likely only the provided CentOS template is available.
					</div></li><li class="listitem"><div class="para">
						Select a service offering. Be sure that the hardware you have allows starting the selected service offering.
					</div></li><li class="listitem"><div class="para">
						In data disk offering, if desired, add another data disk. This is a second volume that will be available to but not mounted in the guest. For example, in Linux on XenServer you will see /dev/xvdb in the guest after rebooting the VM. A reboot is not required if you have a PV-enabled OS kernel in use.
					</div></li><li class="listitem"><div class="para">
						In default network, choose the primary network for the guest. In a trial installation, you would have only one option here.
					</div></li><li class="listitem"><div class="para">
						Optionally give your VM a name and a group. Use any descriptive text you would like.
					</div></li><li class="listitem"><div class="para">
						Click Launch VM. Your VM will be created and started. It might take some time to download the template and complete the VM startup. You can watch the VM’s progress in the Instances screen.
					</div></li></ol></div></li><li class="listitem"><div class="para">
				To use the VM, click the View Console button. 
				<span class="inlinemediaobject"><img src="./images/console-icon.png" alt="ConsoleButton.png: button to launch a console" /></span>

			</div></li></ol></div><div class="para">
		Congratulations! You have successfully completed a CloudStack Installation.
	</div><div class="para">
		If you decide to grow your deployment, you can add more hosts, primary storage, zones, pods, and clusters.
	</div></div></div><div xml:lang="en-US" class="chapter" id="offerings" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 8. Service Offerings</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#compute-disk-service-offerings">8.1. Compute and Disk Service Offerings</a></span></dt><dd><dl><dt><span class="section"><a href="#creating-compute-offerings">8.1.1. Creating a New Compute Offering</a></span></dt><dt><span class="section"><a href="#creating-disk-offerings">8.1.2. Creating a New Disk Offering</a></span></dt><dt><span class="section"><a href="#modify-delete-service-offerings">8.1.3. Modifying or Deleting a Service Offering</a></span></dt></dl></dd><dt><span class="section"><a href="#system-service-offerings">8.2. System Service Offerings</a></span></dt></dl></div><div class="para">
		In this chapter we discuss compute, disk, and system service offerings. Network offerings are discussed in the section on setting up networking for users.
	</div><div xml:lang="en-US" class="section" id="compute-disk-service-offerings" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="compute-disk-service-offerings">8.1. Compute and Disk Service Offerings</h2></div></div></div><div class="para">
		A service offering is a set of virtual hardware features such as CPU core count and speed, memory, and disk size. The CloudStack administrator can set up various offerings, and then end users choose from the available offerings when they create a new VM. A service offering includes the following elements:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				CPU, memory, and network resource guarantees
			</div></li><li class="listitem"><div class="para">
				How resources are metered
			</div></li><li class="listitem"><div class="para">
				How the resource usage is charged
			</div></li><li class="listitem"><div class="para">
				How often the charges are generated
			</div></li></ul></div><div class="para">
		For example, one service offering might allow users to create a virtual machine instance that is equivalent to a 1 GHz Intel® Core™ 2 CPU, with 1 GB memory at $0.20/hour, with network traffic metered at $0.10/GB. Based on the user’s selected offering, CloudStack emits usage records that can be integrated with billing systems. CloudStack separates service offerings into compute offerings and disk offerings. The computing service offering specifies:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Guest CPU
			</div></li><li class="listitem"><div class="para">
				Guest RAM
			</div></li><li class="listitem"><div class="para">
				Guest Networking type (virtual or direct)
			</div></li><li class="listitem"><div class="para">
				Tags on the root disk
			</div></li></ul></div><div class="para">
		The disk offering specifies:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Disk size (optional). An offering without a disk size will allow users to pick their own
			</div></li><li class="listitem"><div class="para">
				Tags on the data disk
			</div></li></ul></div><div xml:lang="en-US" class="section" id="creating-compute-offerings" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="creating-compute-offerings">8.1.1. Creating a New Compute Offering</h3></div></div></div><div class="para">
		To create a new compute offering:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in with admin privileges to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation bar, click Service Offerings.
			</div></li><li class="listitem"><div class="para">
				In Select Offering, choose Compute Offering.
			</div></li><li class="listitem"><div class="para">
				Click Add Compute Offering.
			</div></li><li class="listitem"><div class="para">
				In the dialog, make the following choices:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: Any desired name for the service offering.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Description</strong></span>: A short description of the offering that can be displayed to users
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Storage type</strong></span>: The type of disk that should be allocated. Local allocates from storage attached directly to the host where the system VM is running. Shared allocates from storage accessible via NFS.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong># of CPU cores</strong></span>: The number of cores which should be allocated to a system VM with this offering
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CPU (in MHz)</strong></span>: The CPU speed of the cores that the system VM is allocated. For example, “2000” would provide for a 2 GHz clock.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Memory (in MB)</strong></span>: The amount of memory in megabytes that the system VM should be allocated. For example, “2048” would provide for a 2 GB RAM allocation.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Network Rate</strong></span>: Allowed data transfer rate in MB per second.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Offer HA</strong></span>: If yes, the administrator can choose to have the system VM be monitored and as highly available as possible.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Storage Tags</strong></span>: The tags that should be associated with the primary storage used by the system VM.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Host Tags</strong></span>: (Optional) Any tags that you use to organize your hosts
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CPU cap</strong></span>: Whether to limit the level of CPU usage even if spare capacity is available.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public</strong></span>: Indicate whether the service offering should be available all domains or only some domains. Choose Yes to make it available to all domains. Choose No to limit the scope to a subdomain; CloudStack will then prompt for the subdomain's name.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click Add.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="creating-disk-offerings" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="creating-disk-offerings">8.1.2. Creating a New Disk Offering</h3></div></div></div><div class="para">
		To create a system service offering:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in with admin privileges to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation bar, click Service Offerings.
			</div></li><li class="listitem"><div class="para">
				In Select Offering, choose Disk Offering.
			</div></li><li class="listitem"><div class="para">
				Click Add Disk Offering.
			</div></li><li class="listitem"><div class="para">
				In the dialog, make the following choices:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Name. Any desired name for the system offering.
					</div></li><li class="listitem"><div class="para">
						Description. A short description of the offering that can be displayed to users
					</div></li><li class="listitem"><div class="para">
						Custom Disk Size. If checked, the user can set their own disk size. If not checked, the root administrator must define a value in Disk Size.
					</div></li><li class="listitem"><div class="para">
						Disk Size. Appears only if Custom Disk Size is not selected. Define the volume size in GB.
					</div></li><li class="listitem"><div class="para">
						(Optional)Storage Tags. The tags that should be associated with the primary storage for this disk. Tags are a comma separated list of attributes of the storage. For example "ssd,blue". Tags are also added on Primary Storage. CloudStack matches tags on a disk offering to tags on the storage. If a tag is present on a disk offering that tag (or tags) must also be present on Primary Storage for the volume to be provisioned. If no such primary storage exists, allocation from the disk offering will fail..
					</div></li><li class="listitem"><div class="para">
						Public. Indicate whether the service offering should be available all domains or only some domains. Choose Yes to make it available to all domains. Choose No to limit the scope to a subdomain; CloudStack will then prompt for the subdomain's name.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click Add.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="modify-delete-service-offerings" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="modify-delete-service-offerings">8.1.3. Modifying or Deleting a Service Offering</h3></div></div></div><div class="para">
		Service offerings cannot be changed once created. This applies to both compute offerings and disk offerings.
	</div><div class="para">
		A service offering can be deleted. If it is no longer in use, it is deleted immediately and permanently. If the service offering is still in use, it will remain in the database until all the virtual machines referencing it have been deleted. After deletion by the administrator, a service offering will not be available to end users that are creating new instances.
	</div></div></div><div xml:lang="en-US" class="section" id="system-service-offerings" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="system-service-offerings">8.2. System Service Offerings</h2></div></div></div><div class="para">
		System service offerings provide a choice of CPU speed, number of CPUs, tags, and RAM size, just as other service offerings do. But rather than being used for virtual machine instances and exposed to users, system service offerings are used to change the default properties of virtual routers, console proxies, and other system VMs. System service offerings are visible only to the CloudStack root administrator. CloudStack provides default system service offerings. The CloudStack root administrator can create additional custom system service offerings.
	</div><div class="para">
		When CloudStack creates a virtual router for a guest network, it uses default settings which are defined in the system service offering associated with the network offering. You can upgrade the capabilities of the virtual router by applying a new network offering that contains a different system service offering. All virtual routers in that network will begin using the settings from the new service offering.
	</div></div></div><div xml:lang="en-US" class="chapter" id="set-up-network-for-users" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 9. Setting Up Networking for Users</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#networks-for-users-overview">9.1. Overview of Setting Up Networking for Users</a></span></dt><dt><span class="section"><a href="#about-virtual-networks">9.2. About Virtual Networks</a></span></dt><dd><dl><dt><span class="section"><a href="#isolated-networks">9.2.1. Isolated Networks</a></span></dt><dt><span class="section"><a href="#shared-networks">9.2.2. Shared Networks</a></span></dt><dt><span class="section"><a href="#runtime-allocation-virtual-network-resources">9.2.3. Runtime Allocation of Virtual Network Resources</a></span></dt></dl></dd><dt><span class="section"><a href="#network-service-providers">9.3. Network Service Providers</a></span></dt><dt><span class="section"><a href="#network-offerings">9.4. Network Offerings</a></span></dt></dl></div><div xml:lang="en-US" class="section" id="networks-for-users-overview" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="networks-for-users-overview">9.1. Overview of Setting Up Networking for Users</h2></div></div></div><div class="para">
		People using cloud infrastructure have a variety of needs and preferences when it comes to the networking services provided by the cloud. As a CloudStack administrator, you can do the following things to set up networking for your users:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Set up physical networks in zones
			</div></li><li class="listitem"><div class="para">
				Set up several different providers for the same service on a single physical network (for example, both Cisco and Juniper firewalls)
			</div></li><li class="listitem"><div class="para">
				Bundle different types of network services into network offerings, so users can choose the desired network services for any given virtual machine
			</div></li><li class="listitem"><div class="para">
				Add new network offerings as time goes on so end users can upgrade to a better class of service on their network
			</div></li><li class="listitem"><div class="para">
				Provide more ways for a network to be accessed by a user, such as through a project of which the user is a member
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="about-virtual-networks" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="about-virtual-networks">9.2. About Virtual Networks</h2></div></div></div><div class="para">
		A virtual network is a logical construct that enables multi-tenancy on a single physical network. In CloudStack a virtual network can be shared or isolated.
	</div><div xml:lang="en-US" class="section" id="isolated-networks" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="isolated-networks">9.2.1. Isolated Networks</h3></div></div></div><div class="para">
		An isolated network can be accessed only by virtual machines of a single account. Isolated networks have the following properties.
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Resources such as VLAN are allocated and garbage collected dynamically
			</div></li><li class="listitem"><div class="para">
				There is one network offering for the entire network
			</div></li><li class="listitem"><div class="para">
				The network offering can be upgraded or downgraded but it is for the entire network
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="shared-networks" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="shared-networks">9.2.2. Shared Networks</h3></div></div></div><div class="para">
		A shared network can be accessed by virtual machines that belong to many different accounts. Network Isolation on shared networks is accomplished using techniques such as security groups (supported only in basic zones in CloudStack 3.0.3).
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Shared Networks are created by the administrator
			</div></li><li class="listitem"><div class="para">
				Shared Networks can be designated to a certain domain
			</div></li><li class="listitem"><div class="para">
				Shared Network resources such as VLAN and physical network that it maps to are designated by the administrator
			</div></li><li class="listitem"><div class="para">
				Shared Networks are isolated by security groups
			</div></li><li class="listitem"><div class="para">
				Public Network is a shared network that is not shown to the end users
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="runtime-allocation-virtual-network-resources" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="runtime-allocation-virtual-network-resources">9.2.3. Runtime Allocation of Virtual Network Resources</h3></div></div></div><div class="para">
		When you define a new virtual network, all your settings for that network are stored in CloudStack. The actual network resources are activated only when the first virtual machine starts in the network. When all virtual machines have left the virtual network, the network resources are garbage collected so they can be allocated again. This helps to conserve network resources..
	</div></div></div><div xml:lang="en-US" class="section" id="network-service-providers" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="network-service-providers">9.3. Network Service Providers</h2></div></div></div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			For the most up-to-date list of supported network service providers, see the CloudPlatform UI or call listNetworkServiceProviders.
		</div></div></div><div class="para">
		A service provider (also called a network element) is hardware or virtual appliance that makes a network service possible; for example, a firewall appliance can be installed in the cloud to provide firewall service. On a single network, multiple providers can provide the same network service. For example, a firewall service may be provided by Cisco or Juniper devices in the same physical network.
	</div><div class="para">
		You can have multiple instances of the same service provider in a network (say, more than one Juniper SRX device).
	</div><div class="para">
		If different providers are set up to provide the same service on the network, the administrator can create network offerings so users can specify which network service provider they prefer (along with the other choices offered in network offerings). Otherwise, CloudPlatform will choose which provider to use whenever the service is called for.
	</div><div class="formalpara"><h5 class="formalpara" id="idp18939312">Supported Network Service Providers</h5>
			CloudPlatform ships with an internal list of the supported service providers, and you can choose from this list when creating a network offering.
		</div></div><div xml:lang="en-US" class="section" id="network-offerings" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="network-offerings">9.4. Network Offerings</h2></div></div></div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			For the most up-to-date list of supported network services, see the CloudPlatform UI or call listNetworkServices.
		</div></div></div><div class="para">
		A network offering is a named set of network services, such as:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				DHCP
			</div></li><li class="listitem"><div class="para">
				DNS
			</div></li><li class="listitem"><div class="para">
				Source NAT
			</div></li><li class="listitem"><div class="para">
				Static NAT
			</div></li><li class="listitem"><div class="para">
				Port Forwarding
			</div></li><li class="listitem"><div class="para">
				Load Balancing
			</div></li><li class="listitem"><div class="para">
				Firewall
			</div></li><li class="listitem"><div class="para">
				VPN
			</div></li><li class="listitem"><div class="para">
				Optional) Name one of several available providers to use for a given service, such as Juniper for the firewall
			</div></li><li class="listitem"><div class="para">
				(Optional) Network tag to specify which physical network to use
			</div></li></ul></div><div class="para">
		When creating a new VM, the user chooses one of the available network offerings, and that determines which network services the VM can use.
	</div><div class="para">
		The CloudPlatform administrator can create any number of custom network offerings, in addition to the default network offerings provided by CloudPlatform. By creating multiple custom network offerings, you can set up your cloud to offer different classes of service on a single multi-tenant physical network. For example, while the underlying physical wiring may be the same for two tenants, tenant A may only need simple firewall protection for their website, while tenant B may be running a web server farm and require a scalable firewall solution, load balancing solution, and alternate networks for accessing the database backend.
	</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			If you create load balancing rules while using a network service offering that includes an external load balancer device such as NetScaler, and later change the network service offering to one that uses the CloudPlatform virtual router, you must create a firewall rule on the virtual router for each of your existing load balancing rules so that they continue to function.
		</div></div></div><div class="para">
		When creating a new virtual network, the CloudPlatform administrator chooses which network offering to enable for that network. Each virtual network is associated with one network offering. A virtual network can be upgraded or downgraded by changing its associated network offering. If you do this, be sure to reprogram the physical network to match.
	</div><div class="para">
		CloudPlatform also has internal network offerings for use by CloudPlatform system VMs. These network offerings are not visible to users but can be modified by administrators.
	</div></div></div><div xml:lang="en-US" class="chapter" id="virtual-machines" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 10. Working With Virtual Machines</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#about-working-with-vms">10.1. About Working with Virtual Machines</a></span></dt><dt><span class="section"><a href="#best-practices-vm">10.2. Best Practices for Virtual Machines</a></span></dt><dt><span class="section"><a href="#vm-lifecycle">10.3. VM Lifecycle</a></span></dt><dt><span class="section"><a href="#creating-vms">10.4. Creating VMs</a></span></dt><dt><span class="section"><a href="#accessing-vms">10.5. Accessing VMs</a></span></dt><dt><span class="section"><a href="#stopping-and-starting-vms">10.6. Stopping and Starting VMs</a></span></dt><dt><span class="section"><a href="#changing-vm-name-os-group">10.7. Changing the VM Name, OS, or Group</a></span></dt><dt><span class="section"><a href="#changing-service-offering-for-vm">10.8. Changing the Service Offering for a VM</a></span></dt><dt><span class="section"><a href="#manual-live-migration">10.9. Moving VMs Between Hosts (Manual Live Migration)</a></span></dt><dt><span class="section"><a href="#deleting-vms">10.10. Deleting VMs</a></span></dt><dt><span class="section"><a href="#working-with-iso">10.11. Working with ISOs</a></span></dt><dd><dl><dt><span class="section"><a href="#add-iso">10.11.1. Adding an ISO</a></span></dt><dt><span class="section"><a href="#attach-iso-to-vm">10.11.2. Attaching an ISO to a VM</a></span></dt></dl></dd></dl></div><div xml:lang="en-US" class="section" id="about-working-with-vms" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="about-working-with-vms">10.1. About Working with Virtual Machines</h2></div></div></div><div class="para">
		CloudStack provides administrators with complete control over the lifecycle of all guest VMs executing in the cloud. CloudStack provides several guest management operations for end users and administrators. VMs may be stopped, started, rebooted, and destroyed.
	</div><div class="para">
		Guest VMs have a name and group. VM names and groups are opaque to CloudStack and are available for end users to organize their VMs. Each VM can have three names for use in different contexts. Only two of these names can be controlled by the user:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Instance name – a unique, immutable ID that is generated by CloudStack and can not be modified by the user. This name conforms to the requirements in IETF RFC 1123.
			</div></li><li class="listitem"><div class="para">
				Display name – the name displayed in the CloudStack web UI. Can be set by the user. Defaults to instance name.
			</div></li><li class="listitem"><div class="para">
				Name – host name that the DHCP server assigns to the VM. Can be set by the user. Defaults to instance name
			</div></li></ul></div><div class="para">
		Guest VMs can be configured to be Highly Available (HA). An HA-enabled VM is monitored by the system. If the system detects that the VM is down, it will attempt to restart the VM, possibly on a different host. For more information, see HA-Enabled Virtual Machines on
	</div><div class="para">
		Each new VM is allocated one public IP address. When the VM is started, CloudStack automatically creates a static NAT between this public IP address and the private IP address of the VM.
	</div><div class="para">
		If elastic IP is in use (with the NetScaler load balancer), the IP address initially allocated to the new VM is not marked as elastic. The user must replace the automatically configured IP with a specifically acquired elastic IP, and set up the static NAT mapping between this new IP and the guest VM’s private IP. The VM’s original IP address is then released and returned to the pool of available public IPs.
	</div><div class="para">
		CloudStack cannot distinguish a guest VM that was shut down by the user (such as with the “shutdown” command in Linux) from a VM that shut down unexpectedly. If an HA-enabled VM is shut down from inside the VM, CloudStack will restart it. To shut down an HA-enabled VM, you must go through the CloudStack UI or API.
	</div></div><div xml:lang="en-US" class="section" id="best-practices-vm" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="best-practices-vm">10.2. Best Practices for Virtual Machines</h2></div></div></div><div class="para">
		The CloudStack administrator should monitor the total number of VM instances in each cluster, and disable allocation to the cluster if the total is approaching the maximum that the hypervisor can handle. Be sure to leave a safety margin to allow for the possibility of one or more hosts failing, which would increase the VM load on the other hosts as the VMs are automatically redeployed. Consult the documentation for your chosen hypervisor to find the maximum permitted number of VMs per host, then use CloudStack global configuration settings to set this as the default limit. Monitor the VM activity in each cluster at all times. Keep the total number of VMs below a safe level that allows for the occasional host failure. For example, if there are N hosts in the cluster, and you want to allow for one host in the cluster to be down at any given time, the total number of VM instances you can permit in the cluster is at most (N-1) * (per-host-limit). Once a cluster reaches this number of VMs, use the CloudStack UI to disable allocation of more VMs to the cluster.
	</div></div><div xml:lang="en-US" class="section" id="vm-lifecycle" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="vm-lifecycle">10.3. VM Lifecycle</h2></div></div></div><div class="para">
		Virtual machines can be in the following states:
	</div><div class="mediaobject"><img src="./images/basic-deployment.png" alt="basic-deployment.png: Basic two-machine CloudStack deployment" /></div><div class="para">
		Once a virtual machine is destroyed, it cannot be recovered. All the resources used by the virtual machine will be reclaimed by the system. This includes the virtual machine’s IP address.
	</div><div class="para">
		A stop will attempt to gracefully shut down the operating system, which typically involves terminating all the running applications. If the operation system cannot be stopped, it will be forcefully terminated. This has the same effect as pulling the power cord to a physical machine.
	</div><div class="para">
		A reboot is a stop followed by a start.
	</div><div class="para">
		CloudPlatform preserves the state of the virtual machine hard disk until the machine is destroyed.
	</div><div class="para">
		A running virtual machine may fail because of hardware or network issues. A failed virtual machine is in the down state.
	</div><div class="para">
		The system places the virtual machine into the down state if it does not receive the heartbeat from the hypervisor for three minutes.
	</div><div class="para">
		The user can manually restart the virtual machine from the down state.
	</div><div class="para">
		The system will start the virtual machine from the down state automatically if the virtual machine is marked as HA-enabled.
	</div></div><div xml:lang="en-US" class="section" id="creating-vms" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="creating-vms">10.4. Creating VMs</h2></div></div></div><div class="para">
		Virtual machines are usually created from a template. Users can also create blank virtual machines. A blank virtual machine is a virtual machine without an OS template. Users can attach an ISO file and install the OS from the CD/DVD-ROM.
	</div><div class="para">
		To create a VM from a template:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation bar, click Instances.
			</div></li><li class="listitem"><div class="para">
				Click Add Instance.
			</div></li><li class="listitem"><div class="para">
				Select a template, then follow the steps in the wizard. (For more information about how the templates came to be in this list, see Working with Templates.
			</div></li><li class="listitem"><div class="para">
				Be sure that the hardware you have allows starting the selected service offering.
			</div></li><li class="listitem"><div class="para">
				Click Submit and your VM will be created and started.
			</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					For security reason, the internal name of the VM is visible only to the root admin.
				</div></div></div></li></ol></div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			Starting with v3.0.3, you can create a VM without starting it. You can determine whether the VM needs to be started as part of the VM deployment. A new request parameter, startVM, is introduced in the deployVm API to support this feature. For more information, see the Developer's Guide
		</div></div></div><div class="para">
		To create a VM from an ISO:
	</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			(XenServer) Windows VMs running on XenServer require PV drivers, which may be provided in the template or added after the VM is created. The PV drivers are necessary for essential management functions such as mounting additional volumes and ISO images, live migration, and graceful shutdown.
		</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation bar, click Instances.
			</div></li><li class="listitem"><div class="para">
				Click Add Instance.
			</div></li><li class="listitem"><div class="para">
				Select ISO Boot, and follow the steps in the wizard.
			</div></li><li class="listitem"><div class="para">
				Click Submit and your VM will be created and started.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="accessing-vms" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="accessing-vms">10.5. Accessing VMs</h2></div></div></div><div class="para">
		Any user can access their own virtual machines. The administrator can access all VMs running in the cloud.
	</div><div class="para">
		To access a VM through the CloudStack UI:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as a user or admin.
			</div></li><li class="listitem"><div class="para">
				Click Instances, then click the name of a running VM.
			</div></li><li class="listitem"><div class="para">
				Click the View Console button <img src="images/icon.png" />.
			</div></li></ol></div><div class="para">
		To access a VM directly over the network:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				The VM must have some port open to incoming traffic. For example, in a basic zone, a new VM might be assigned to a security group which allows incoming traffic. This depends on what security group you picked when creating the VM. In other cases, you can open a port by setting up a port forwarding policy. See IP Forwarding and Firewalling.
			</div></li><li class="listitem"><div class="para">
				If a port is open but you can not access the VM using ssh, it’s possible that ssh is not already enabled on the VM. This will depend on whether ssh is enabled in the template you picked when creating the VM. Access the VM through the CloudStack UI and enable ssh on the machine using the commands for the VM’s operating system.
			</div></li><li class="listitem"><div class="para">
				If the network has an external firewall device, you will need to create a firewall rule to allow access. See IP Forwarding and Firewalling.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="stopping-and-starting-vms" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="stopping-and-starting-vms">10.6. Stopping and Starting VMs</h2></div></div></div><div class="para">
		Any user can access their own virtual machines. The administrator can access all VMs running in the cloud.
	</div></div><div xml:lang="en-US" class="section" id="changing-vm-name-os-group" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="changing-vm-name-os-group">10.7. Changing the VM Name, OS, or Group</h2></div></div></div><div class="para">
		After a VM is created, you can modify the display name, operating system, and the group it belongs to.
	</div><div class="para">
		To access a VM through the CloudStack UI:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as a user or admin.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Instances.
			</div></li><li class="listitem"><div class="para">
				Select the VM that you want to modify.
			</div></li><li class="listitem"><div class="para">
				Click the Stop button to stop the VM 
				<span class="inlinemediaobject"><img src="./images/stop-instance-icon.png" alt="StopButton.png: button to stop a VM" /></span>

			</div></li><li class="listitem"><div class="para">
				Click Edit 
				<span class="inlinemediaobject"><img src="./images/edit-icon.png" alt="StopButton.png: button to edit the properties of a VM" /></span>
				.
			</div></li><li class="listitem"><div class="para">
				Make the desired changes to the following:
			</div></li><li class="listitem"><div class="para">
				Display name: Enter a new display name if you want to change the name of the VM.
			</div></li><li class="listitem"><div class="para">
				OS Type: Select the desired operating system.
			</div></li><li class="listitem"><div class="para">
				Group: Enter the group name for the VM.
			</div></li><li class="listitem"><div class="para">
				Click Apply.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="changing-service-offering-for-vm" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="changing-service-offering-for-vm">10.8. Changing the Service Offering for a VM</h2></div></div></div><div class="para">
		To upgrade or downgrade the level of compute resources available to a virtual machine, you can change the VM's compute offering.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as a user or admin.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Instances.
			</div></li><li class="listitem"><div class="para">
				Choose the VM that you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click the Stop button to stop the VM 
				<span class="inlinemediaobject"><img src="./images/stop-instance-icon.png" alt="StopButton.png: button to stop a VM" /></span>

			</div></li><li class="listitem"><div class="para">
				Click the Change Service button 
				<span class="inlinemediaobject"><img src="./images/change-service-icon.png" alt="ChangeServiceButton.png: button to change the service of a VM" /></span>
				. The Change service dialog box is displayed.
			</div></li><li class="listitem"><div class="para">
				Select the offering you want.
			</div></li><li class="listitem"><div class="para">
				Click OK.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="manual-live-migration" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="manual-live-migration">10.9. Moving VMs Between Hosts (Manual Live Migration)</h2></div></div></div><div class="para">
		The CloudPlatform administrator can move a running VM from one host to another without interrupting service to users or going into maintenance mode. This is called manual live migration, and can be done under the following conditions:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				The root administrator is logged in. Domain admins and users can not perform manual live migration of VMs.
			</div></li><li class="listitem"><div class="para">
				The VM is running. Stopped VMs can not be live migrated.
			</div></li><li class="listitem"><div class="para">
				The destination host must be in the same cluster as the original host.
			</div></li><li class="listitem"><div class="para">
				The VM must not be using local disk storage.
			</div></li><li class="listitem"><div class="para">
				The destination host must have enough available capacity. If not, the VM will remain in the "migrating" state until memory becomes available.
			</div></li></ul></div><div class="para">
		To manually live migrate a virtual machine
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudPlatform UI as a user or admin.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Instances.
			</div></li><li class="listitem"><div class="para">
				Choose the VM that you want to migrate.
			</div></li><li class="listitem"><div class="para">
				Click the Migrate Instance button 
				<span class="inlinemediaobject"><img src="./images/migrate-instance.png" alt="Migrateinstance.png: button to migrate an instance" /></span>

			</div></li><li class="listitem"><div class="para">
				From the list of hosts, choose the one to which you want to move the VM.
			</div></li><li class="listitem"><div class="para">
				Click OK.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="deleting-vms" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="deleting-vms">10.10. Deleting VMs</h2></div></div></div><div class="para">
		Users can delete their own virtual machines. A running virtual machine will be abruptly stopped before it is deleted. Administrators can delete any virtual machines.
	</div><div class="para">
		To delete a virtual machine:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as a user or admin.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Instances.
			</div></li><li class="listitem"><div class="para">
				Choose the VM that you want to delete.
			</div></li><li class="listitem"><div class="para">
				Click the Destroy Instance button 
				<span class="inlinemediaobject"><img src="./images/destroy-instance.png" alt="Destroyinstance.png: button to destroy an instance" /></span>

			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="working-with-iso" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="working-with-iso">10.11. Working with ISOs</h2></div></div></div><div class="para">
		CloudStack supports ISOs and their attachment to guest VMs. An ISO is a read-only file that has an ISO/CD-ROM style file system. Users can upload their own ISOs and mount them on their guest VMs.
	</div><div class="para">
		ISOs are uploaded based on a URL. HTTP is the supported protocol. Once the ISO is available via HTTP specify an upload URL such as http://my.web.server/filename.iso.
	</div><div class="para">
		ISOs may be public or private, like templates.ISOs are not hypervisor-specific. That is, a guest on vSphere can mount the exact same image that a guest on KVM can mount.
	</div><div class="para">
		ISO images may be stored in the system and made available with a privacy level similar to templates. ISO images are classified as either bootable or not bootable. A bootable ISO image is one that contains an OS image. CloudStack allows a user to boot a guest VM off of an ISO image. Users can also attach ISO images to guest VMs. For example, this enables installing PV drivers into Windows. ISO images are not hypervisor-specific.
	</div><div xml:lang="en-US" class="section" id="add-iso" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-iso">10.11.1. Adding an ISO</h3></div></div></div><div class="para">
		To make additional operating system or other software available for use with guest VMs, you can add an ISO. The ISO is typically thought of as an operating system image, but you can also add ISOs for other types of software, such as desktop applications that you want to be installed as part of a template.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation bar, click Templates.
			</div></li><li class="listitem"><div class="para">
				In Select View, choose ISOs.
			</div></li><li class="listitem"><div class="para">
				Click Add ISO.
			</div></li><li class="listitem"><div class="para">
				In the Add ISO screen, provide the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: Short name for the ISO image. For example, CentOS 6.2 64-bit.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Description</strong></span>: Display test for the ISO image. For example, CentOS 6.2 64-bit.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>URL</strong></span>: The URL that hosts the ISO image. The Management Server must be able to access this location via HTTP. If needed you can place the ISO image directly on the Management Server
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Zone</strong></span>: Choose the zone where you want the ISO to be available, or All Zones to make it available throughout CloudStack.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Bootable</strong></span>: Whether or not a guest could boot off this ISO image. For example, a CentOS ISO is bootable, a Microsoft Office ISO is not bootable.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>OS Type</strong></span>: This helps CloudStack and the hypervisor perform certain operations and make assumptions that improve the performance of the guest. Select one of the following.
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								If the operating system of your desired ISO image is listed, choose it.
							</div></li><li class="listitem"><div class="para">
								If the OS Type of the ISO is not listed or if the ISO is not bootable, choose Other.
							</div></li><li class="listitem"><div class="para">
								(XenServer only) If you want to boot from this ISO in PV mode, choose Other PV (32-bit) or Other PV (64-bit)
							</div></li><li class="listitem"><div class="para">
								(KVM only) If you choose an OS that is PV-enabled, the VMs created from this ISO will have a SCSI (virtio) root disk. If the OS is not PV-enabled, the VMs will have an IDE root disk. The PV-enabled types are:
							</div><div class="informaltable"><table border="1"><colgroup><col width="33%" /><col width="33%" /><col width="33%" /></colgroup><tbody><tr><td align="left">
												<div class="para">
													Fedora 13
												</div>
											</td><td align="left">
												<div class="para">
													Fedora 12
												</div>
											</td><td align="left">
												<div class="para">
													Fedora 11
												</div>
											</td></tr><tr><td align="left">
												<div class="para">
													Fedora 10
												</div>
											</td><td align="left">
												<div class="para">
													Fedora 9
												</div>
											</td><td align="left">
												<div class="para">
													Other PV
												</div>
											</td></tr><tr><td align="left">
												<div class="para">
													Debian GNU/Linux
												</div>
											</td><td align="left">
												<div class="para">
													CentOS 5.3
												</div>
											</td><td align="left">
												<div class="para">
													CentOS 5.4
												</div>
											</td></tr><tr><td align="left">
												<div class="para">
													CentOS 5.5
												</div>
											</td><td align="left">
												<div class="para">
													Red Hat Enterprise Linux 5.3
												</div>
											</td><td align="left">
												<div class="para">
													Red Hat Enterprise Linux 5.4
												</div>
											</td></tr><tr><td align="left">
												<div class="para">
													Red Hat Enterprise Linux 5.5
												</div>
											</td><td align="left">
												<div class="para">
													Red Hat Enterprise Linux 6
												</div>
											</td><td align="left">
											</td></tr></tbody></table></div></li></ul></div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
							It is not recommended to choose an older version of the OS than the version in the image. For example, choosing CentOS 5.4 to support a CentOS 6.2 image will usually not work. In these cases, choose Other.
						</div></div></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Extractable</strong></span>: Choose Yes if the ISO should be available for extraction.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public</strong></span>: Choose Yes if this ISO should be available to other users.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Featured</strong></span>: Choose Yes if you would like this ISO to be more prominent for users to select. The ISO will appear in the Featured ISOs list. Only an administrator can make an ISO Featured.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click OK.
			</div><div class="para">
				The Management Server will download the ISO. Depending on the size of the ISO, this may take a long time. The ISO status column will display Ready once it has been successfully downloaded into secondary storage. Clicking Refresh updates the download percentage.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Important</strong></span>: Wait for the ISO to finish downloading. If you move on to the next task and try to use the ISO right away, it will appear to fail. The entire ISO must be available before CloudStack can work with it.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="attach-iso-to-vm" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="attach-iso-to-vm">10.11.2. Attaching an ISO to a VM</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				In the left navigation, click Instances.
			</div></li><li class="listitem"><div class="para">
				Choose the virtual machine you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click the Attach ISO button 
				<span class="inlinemediaobject"><img src="./images/iso-icon.png" alt="iso.png: Depicts adding an iso image" /></span>
			</div></li><li class="listitem"><div class="para">
				In the Attach ISO dialog box, select the desired ISO.
			</div></li><li class="listitem"><div class="para">
				Click OK
			</div></li></ol></div></div></div></div><div xml:lang="en-US" class="chapter" id="working-with-hosts" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 11. Working With Hosts</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#adding-hosts">11.1. Adding Hosts</a></span></dt><dt><span class="section"><a href="#scheduled-maintenance-maintenance-mode-hosts">11.2. Scheduled Maintenance and Maintenance Mode for Hosts</a></span></dt><dt><span class="section"><a href="#disable-enable-zones-pods-clusters">11.3. Disabling and Enabling Zones, Pods, and Clusters</a></span></dt><dt><span class="section"><a href="#removing-hosts">11.4. Removing Hosts</a></span></dt><dd><dl><dt><span class="section"><a href="#removing-xenserver-kvm-hosts">11.4.1. Removing XenServer and KVM Hosts</a></span></dt><dt><span class="section"><a href="#removing-vsphere-hosts">11.4.2. Removing vSphere Hosts</a></span></dt></dl></dd><dt><span class="section"><a href="#re-install-hosts">11.5. Re-Installing Hosts</a></span></dt><dt><span class="section"><a href="#maintain-hypervisors-on-hosts">11.6. Maintaining Hypervisors on Hosts</a></span></dt><dt><span class="section"><a href="#change-host-password">11.7. Changing Host Password</a></span></dt><dt><span class="section"><a href="#host-allocation">11.8. Host Allocation</a></span></dt><dt><span class="section"><a href="#vlan-provisioning">11.9. VLAN Provisioning</a></span></dt></dl></div><div class="section" id="adding-hosts"><div class="titlepage"><div><div><h2 class="title" id="adding-hosts">11.1. Adding Hosts</h2></div></div></div><div class="para">
			Additional hosts can be added at any time to provide more capacity for guest VMs. For requirements and instructions, see <a class="xref" href="#host-add">Section 7.5, “Adding a Host”</a>.
		</div></div><div xml:lang="en-US" class="section" id="scheduled-maintenance-maintenance-mode-hosts" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="scheduled-maintenance-maintenance-mode-hosts">11.2. Scheduled Maintenance and Maintenance Mode for Hosts</h2></div></div></div><div class="para">
		You can place a host into maintenance mode. When maintenance mode is activated, the host becomes unavailable to receive new guest VMs, and the guest VMs already running on the host are seamlessly migrated to another host not in maintenance mode. This migration uses live migration technology and does not interrupt the execution of the guest.
	</div></div><div xml:lang="en-US" class="section" id="disable-enable-zones-pods-clusters" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="disable-enable-zones-pods-clusters">11.3. Disabling and Enabling Zones, Pods, and Clusters</h2></div></div></div><div class="para">
		You can enable or disable a zone, pod, or cluster without permanently removing it from the cloud. This is useful for maintenance or when there are problems that make a portion of the cloud infrastructure unreliable. No new allocations will be made to a disabled zone, pod, or cluster until its state is returned to Enabled. When a zone, pod, or cluster is first added to the cloud, it is Disabled by default.
	</div><div class="para">
		To disable and enable a zone, pod, or cluster:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as administrator
			</div></li><li class="listitem"><div class="para">
				In the left navigation bar, click Infrastructure.
			</div></li><li class="listitem"><div class="para">
				In Zones, click View More.
			</div></li><li class="listitem"><div class="para">
				If you are disabling or enabling a zone, find the name of the zone in the list, and click the Enable/Disable button.
				<span class="inlinemediaobject"><img src="./images/enable-disable.png" alt="enable-disable.png: button to enable or disable zone, pod, or cluster." /></span>

			</div></li><li class="listitem"><div class="para">
				If you are disabling or enabling a pod or cluster, click the name of the zone that contains the pod or cluster.
			</div></li><li class="listitem"><div class="para">
				Click the Compute tab.
			</div></li><li class="listitem"><div class="para">
				In the Pods or Clusters node of the diagram, click View All.
			</div></li><li class="listitem"><div class="para">
				Click the pod or cluster name in the list.
			</div></li><li class="listitem"><div class="para">
				Click the Enable/Disable button. 
				<span class="inlinemediaobject"><img src="./images/enable-disable.png" /></span>
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="removing-hosts" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="removing-hosts">11.4. Removing Hosts</h2></div></div></div><div class="para">
		Hosts can be removed from the cloud as needed. The procedure to remove a host depends on the hypervisor type.
	</div><div xml:lang="en-US" class="section" id="removing-xenserver-kvm-hosts" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="removing-xenserver-kvm-hosts">11.4.1. Removing XenServer and KVM Hosts</h3></div></div></div><div class="para">
		A node cannot be removed from a cluster until it has been placed in maintenance mode. This will ensure that all of the VMs on it have been migrated to other Hosts. To remove a Host from the cloud:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Place the node in maintenance mode.
			</div><div class="para">
				See <a class="xref" href="#scheduled-maintenance-maintenance-mode-hosts">Section 11.2, “Scheduled Maintenance and Maintenance Mode for Hosts”</a>.
			</div></li><li class="listitem"><div class="para">
				For KVM, stop the cloud-agent service.
			</div></li><li class="listitem"><div class="para">
				Use the UI option to remove the node.
			</div><div class="para">
				Then you may power down the Host, re-use its IP address, re-install it, etc
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="removing-vsphere-hosts" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="removing-vsphere-hosts">11.4.2. Removing vSphere Hosts</h3></div></div></div><div class="para">
		To remove this type of host, first place it in maintenance mode, as described in <a class="xref" href="#scheduled-maintenance-maintenance-mode-hosts">Section 11.2, “Scheduled Maintenance and Maintenance Mode for Hosts”</a>. Then use CloudStack to remove the host. CloudStack will not direct commands to a host that has been removed using CloudStack. However, the host may still exist in the vCenter cluster.
	</div></div></div><div xml:lang="en-US" class="section" id="re-install-hosts" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="re-install-hosts">11.5. Re-Installing Hosts</h2></div></div></div><div class="para">
		You can re-install a host after placing it in maintenance mode and then removing it. If a host is down and cannot be placed in maintenance mode, it should still be removed before the re-install.
	</div></div><div xml:lang="en-US" class="section" id="maintain-hypervisors-on-hosts" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="maintain-hypervisors-on-hosts">11.6. Maintaining Hypervisors on Hosts</h2></div></div></div><div class="para">
		When running hypervisor software on hosts, be sure all the hotfixes provided by the hypervisor vendor are applied. Track the release of hypervisor patches through your hypervisor vendor’s support channel, and apply patches as soon as possible after they are released. CloudStack will not track or notify you of required hypervisor patches. It is essential that your hosts are completely up to date with the provided hypervisor patches. The hypervisor vendor is likely to refuse to support any system that is not up to date with patches.
	</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			The lack of up-do-date hotfixes can lead to data corruption and lost VMs.
		</div></div></div><div class="para">
		(XenServer) For more information, see <a href="http://docs.cloudstack.org/Knowledge_Base/Possible_VM_corruption_if_XenServer_Hotfix_is_not_Applied/Highly_Recommended_Hotfixes_for_XenServer_5.6_SP2">Highly Recommended Hotfixes for XenServer in the CloudStack Knowledge Base</a>
	</div></div><div xml:lang="en-US" class="section" id="change-host-password" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="change-host-password">11.7. Changing Host Password</h2></div></div></div><div class="para">
		The password for a XenServer Node, KVM Node, or vSphere Node may be changed in the database. Note that all Nodes in a Cluster must have the same password.
	</div><div class="para">
		To change a Node's password:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Identify all hosts in the cluster.
			</div></li><li class="listitem"><div class="para">
				Change the password on all hosts in the cluster. Now the password for the host and the password known to CloudStack will not match. Operations on the cluster will fail until the two passwords match.
			</div></li><li class="listitem"><div class="para">
				Get the list of host IDs for the host in the cluster where you are changing the password. You will need to access the database to determine these host IDs. For each hostname "h" (or vSphere cluster) that you are changing the password for, execute:
			</div><pre class="programlisting">mysql&gt; select id from cloud.host where name like '%h%';</pre></li><li class="listitem"><div class="para">
				This should return a single ID. Record the set of such IDs for these hosts.
			</div></li><li class="listitem"><div class="para">
				Update the passwords for the host in the database. In this example, we change the passwords for hosts with IDs 5, 10, and 12 to "password".
			</div><pre class="programlisting">mysql&gt; update cloud.host set password='password' where id=5 or id=10 or id=12;</pre></li></ol></div></div><div xml:lang="en-US" class="section" id="host-allocation" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="host-allocation">11.8. Host Allocation</h2></div></div></div><div class="para">
		The system automatically picks the most appropriate host to run each virtual machine. End users may specify the zone in which the virtual machine will be created. End users do not have control over which host will run the virtual machine instance.
	</div><div class="para">
		CloudStack administrators can specify that certain hosts should have a preference for particular types of guest instances. For example, an administrator could state that a host should have a preference to run Windows guests. The default host allocator will attempt to place guests of that OS type on such hosts first. If no such host is available, the allocator will place the instance wherever there is sufficient physical capacity.
	</div><div class="para">
		Both vertical and horizontal allocation is allowed. Vertical allocation consumes all the resources of a given host before allocating any guests on a second host. This reduces power consumption in the cloud. Horizontal allocation places a guest on each host in a round-robin fashion. This may yield better performance to the guests in some cases. CloudStack also allows an element of CPU over-provisioning as configured by the administrator. Over-provisioning allows the administrator to commit more CPU cycles to the allocated guests than are actually available from the hardware.
	</div><div class="para">
		CloudStack also provides a pluggable interface for adding new allocators. These custom allocators can provide any policy the administrator desires.
	</div></div><div xml:lang="en-US" class="section" id="vlan-provisioning" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="vlan-provisioning">11.9. VLAN Provisioning</h2></div></div></div><div class="para">
		CloudStack automatically creates and destroys interfaces bridged to VLANs on the hosts. In general the administrator does not need to manage this process.
	</div><div class="para">
		CloudStack manages VLANs differently based on hypervisor type. For XenServer or KVM, the VLANs are created on only the hosts where they will be used and then they are destroyed when all guests that require them have been terminated or moved to another host.
	</div><div class="para">
		For vSphere the VLANs are provisioned on all hosts in the cluster even if there is no guest running on a particular Host that requires the VLAN. This allows the administrator to perform live migration and other functions in vCenter without having to create the VLAN on the destination Host. Additionally, the VLANs are not removed from the Hosts when they are no longer needed.
	</div></div></div><div xml:lang="en-US" class="chapter" id="working-with-templates" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 12. Working with Templates</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#create-templates-overview">12.1. Creating Templates: Overview</a></span></dt><dt><span class="section"><a href="#requirements-templates">12.2. Requirements for Templates</a></span></dt><dt><span class="section"><a href="#best-practices-templates">12.3. Best Practices for Templates</a></span></dt><dt><span class="section"><a href="#default-template">12.4. The Default Template</a></span></dt><dt><span class="section"><a href="#private-public-template">12.5. Private and Public Templates</a></span></dt><dt><span class="section"><a href="#create-template-from-existing-vm">12.6. Creating a Template from an Existing Virtual Machine</a></span></dt><dt><span class="section"><a href="#create-template-from-snapshot">12.7. Creating a Template from a Snapshot</a></span></dt><dt><span class="section"><a href="#upload-template">12.8. Uploading Templates</a></span></dt><dt><span class="section"><a href="#export-template">12.9. Exporting Templates</a></span></dt><dt><span class="section"><a href="#create-windows-template">12.10. Creating a Windows Template</a></span></dt><dd><dl><dt><span class="section"><a href="#sysprep-windows-server-2008R2">12.10.1. System Preparation for Windows Server 2008 R2</a></span></dt><dt><span class="section"><a href="#sysprep-for-windows-server-2003R2">12.10.2. Sysprep for Windows Server 2003 R2</a></span></dt></dl></dd><dt><span class="section"><a href="#import-ami">12.11. Importing Amazon Machine Images</a></span></dt><dt><span class="section"><a href="#convert-hyperv-vm-to-template">12.12. Converting a Hyper-V VM to a Template</a></span></dt><dt><span class="section"><a href="#add-password-management-to-templates">12.13. Adding Password Management to Your Templates</a></span></dt><dd><dl><dt><span class="section"><a href="#linux-installation">12.13.1. Linux OS Installation</a></span></dt><dt><span class="section"><a href="#windows-installation">12.13.2. Windows OS Installation</a></span></dt></dl></dd><dt><span class="section"><a href="#delete-templates">12.14. Deleting Templates</a></span></dt></dl></div><div class="para">
		A template is a reusable configuration for virtual machines. When users launch VMs, they can choose from a list of templates in CloudStack.
	</div><div class="para">
		Specifically, a template is a virtual disk image that includes one of a variety of operating systems, optional additional software such as office applications, and settings such as access control to determine who can use the template. Each template is associated with a particular type of hypervisor, which is specified when the template is added to CloudStack.
	</div><div class="para">
		CloudStack ships with a default template. In order to present more choices to users, CloudStack administrators and users can create templates and add them to CloudStack.
	</div><div xml:lang="en-US" class="section" id="create-templates-overview" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="create-templates-overview">12.1. Creating Templates: Overview</h2></div></div></div><div class="para">
		CloudStack ships with a default template for the CentOS operating system. There are a variety of ways to add more templates. Administrators and end users can add templates. The typical sequence of events is:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Launch a VM instance that has the operating system you want. Make any other desired configuration changes to the VM.
			</div></li><li class="listitem"><div class="para">
				Stop the VM.
			</div></li><li class="listitem"><div class="para">
				Convert the volume into a template.
			</div></li></ol></div><div class="para">
		There are other ways to add templates to CloudStack. For example, you can take a snapshot of the VM's volume and create a template from the snapshot, or import a VHD from another system into CloudStack
	</div><div class="para">
		The various techniques for creating templates are described in the next few sections.
	</div></div><div xml:lang="en-US" class="section" id="requirements-templates" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="requirements-templates">12.2. Requirements for Templates</h2></div></div></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				For XenServer, install PV drivers / Xen tools on each template that you create. This will enable live migration and clean guest shutdown.
			</div></li><li class="listitem"><div class="para">
				For vSphere, install VMware Tools on each template that you create. This will enable console view to work properly.
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="best-practices-templates" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="best-practices-templates">12.3. Best Practices for Templates</h2></div></div></div><div class="para">
		If you plan to use large templates (100 GB or larger), be sure you have a 10-gigabit network to support the large templates. A slower network can lead to timeouts and other errors when large templates are used.
	</div></div><div xml:lang="en-US" class="section" id="default-template" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="default-template">12.4. The Default Template</h2></div></div></div><div class="para">
		CloudStack includes a CentOS template. This template is downloaded by the Secondary Storage VM after the primary and secondary storage are configured. You can use this template in your production deployment or you can delete it and use custom templates.
	</div><div class="para">
		The root password for the default template is "password".
	</div><div class="para">
		A default template is provided for each of XenServer, KVM, and vSphere. The templates that are downloaded depend on the hypervisor type that is available in your cloud. Each template is approximately 2.5 GB physical size.
	</div><div class="para">
		The default template includes the standard iptables rules, which will block most access to the template excluding ssh.
	</div><pre class="programlisting"># iptables --list
Chain INPUT (policy ACCEPT)
target     prot opt source               destination
RH-Firewall-1-INPUT  all  --  anywhere             anywhere

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
RH-Firewall-1-INPUT  all  --  anywhere             anywhere

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination

Chain RH-Firewall-1-INPUT (2 references)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
ACCEPT     icmp --  anywhere        anywhere       icmp any
ACCEPT     esp  --  anywhere        anywhere
ACCEPT     ah   --  anywhere        anywhere
ACCEPT     udp  --  anywhere        224.0.0.251    udp dpt:mdns
ACCEPT     udp  --  anywhere        anywhere       udp dpt:ipp
ACCEPT     tcp  --  anywhere        anywhere       tcp dpt:ipp
ACCEPT     all  --  anywhere        anywhere       state RELATED,ESTABLISHED
ACCEPT     tcp  --  anywhere        anywhere       state NEW tcp dpt:ssh
REJECT     all  --  anywhere        anywhere       reject-with icmp-host-
</pre></div><div xml:lang="en-US" class="section" id="private-public-template" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="private-public-template">12.5. Private and Public Templates</h2></div></div></div><div class="para">
		When a user creates a template, it can be designated private or public.
	</div><div class="para">
		Private templates are only available to the user who created them. By default, an uploaded template is private.
	</div><div class="para">
		When a user marks a template as “public,” the template becomes available to all users in all accounts in the user's domain, as well as users in any other domains that have access to the Zone where the template is stored. This depends on whether the Zone, in turn, was defined as private or public. A private Zone is assigned to a single domain, and a public Zone is accessible to any domain. If a public template is created in a private Zone, it is available only to users in the domain assigned to that Zone. If a public template is created in a public Zone, it is available to all users in all domains.
	</div></div><div xml:lang="en-US" class="section" id="create-template-from-existing-vm" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="create-template-from-existing-vm">12.6. Creating a Template from an Existing Virtual Machine</h2></div></div></div><div class="para">
		Once you have at least one VM set up in the way you want, you can use it as the prototype for other VMs.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Create and start a virtual machine using any of the techniques given in <a class="xref" href="#creating-vms">Section 10.4, “Creating VMs”</a>.
			</div></li><li class="listitem"><div class="para">
				Make any desired configuration changes on the running VM, then click Stop.
			</div></li><li class="listitem"><div class="para">
				Wait for the VM to stop. When the status shows Stopped, go to the next step.
			</div></li><li class="listitem"><div class="para">
				Click Create Template and provide the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name and Display Text</strong></span>. These will be shown in the UI, so choose something descriptive.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>OS Type</strong></span>. This helps CloudStack and the hypervisor perform certain operations and make assumptions that improve the performance of the guest. Select one of the following.
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								If the operating system of the stopped VM is listed, choose it.
							</div></li><li class="listitem"><div class="para">
								If the OS type of the stopped VM is not listed, choose Other.
							</div></li><li class="listitem"><div class="para">
								If you want to boot from this template in PV mode, choose Other PV (32-bit) or Other PV (64-bit). This choice is available only for XenServere:
							</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
									Note: Generally you should not choose an older version of the OS than the version in the image. For example, choosing CentOS 5.4 to support a CentOS 6.2 image will in general not work. In those cases you should choose Other.
								</div></div></div></li></ul></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public</strong></span>. Choose Yes to make this template accessible to all users of this CloudStack installation. The template will appear in the Community Templates list. See <a class="xref" href="#private-public-template">Section 12.5, “Private and Public Templates”</a>.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Password Enabled</strong></span>. Choose Yes if your template has the CloudStack password change script installed. See Adding Password Management to Your Templates.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click Add.
			</div></li></ol></div><div class="para">
		The new template will be visible in the Templates section when the template creation process has been completed. The template is then available when creating a new VM
	</div></div><div xml:lang="en-US" class="section" id="create-template-from-snapshot" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="create-template-from-snapshot">12.7. Creating a Template from a Snapshot</h2></div></div></div><div class="para">
		If you do not want to stop the VM in order to use the Create Template menu item (as described in <a class="xref" href="#create-template-from-existing-vm">Section 12.6, “Creating a Template from an Existing Virtual Machine”</a>), you can create a template directly from any snapshot through the CloudStack UI.
	</div></div><div xml:lang="en-US" class="section" id="upload-template" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="upload-template">12.8. Uploading Templates</h2></div></div></div><div class="warning"><div class="admonition_header"><h2>vSphere Templates and ISOs</h2></div><div class="admonition"><div class="para">
			If you are uploading a template that was created using vSphere Client, be sure the OVA file does not contain an ISO. If it does, the deployment of VMs from the template will fail.
		</div></div></div><div class="para">
		Templates are uploaded based on a URL. HTTP is the supported access protocol. Templates are frequently large files. You can optionally gzip them to decrease upload times.
	</div><div class="para">
		To upload a template:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				In the left navigation bar, click Templates.
			</div></li><li class="listitem"><div class="para">
				Click Create Template.
			</div></li><li class="listitem"><div class="para">
				Provide the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name and Display Text</strong></span>. These will be shown in the UI, so choose something descriptive.
					</div></li><li class="listitem"><div class="para">
						URL. The Management Server will download the file from the specified URL, such as http://my.web.server/filename.vhd.gz.
					</div></li><li class="listitem"><div class="para">
						Zone. Choose the zone where you want the template to be available, or All Zones to make it available throughout CloudStack.
					</div></li><li class="listitem"><div class="para">
						OS Type: This helps CloudStack and the hypervisor perform certain operations and make assumptions that improve the performance of the guest. Select one of the following:
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								If the operating system of the stopped VM is listed, choose it.
							</div></li><li class="listitem"><div class="para">
								If the OS type of the stopped VM is not listed, choose Other.
							</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
									You should not choose an older version of the OS than the version in the image. For example, choosing CentOS 5.4 to support a CentOS 6.2 image will in general not work. In those cases you should choose Other.
								</div></div></div></li></ul></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Hypervisor</strong></span>
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Format</strong></span>. The format of the template upload file, such as VHD or OVA.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Password Enabled</strong></span>. Choose Yes if your template has the CloudStack password change script installed. See Adding Password Management to Your Templates
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Extractable</strong></span>. Choose Yes if the template is available for extraction. If this option is selected, end users can download a full image of a template.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public</strong></span>. Choose Yes to make this template accessible to all users of this CloudStack installation. The template will appear in the Community Templates list. See <a class="xref" href="#private-public-template">Section 12.5, “Private and Public Templates”</a>
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Featured</strong></span>. Choose Yes if you would like this template to be more prominent for users to select. The template will appear in the Featured Templates list. Only an administrator can make a template Featured.
					</div></li></ul></div></li></ol></div></div><div xml:lang="en-US" class="section" id="export-template" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="export-template">12.9. Exporting Templates</h2></div></div></div><div class="para">
		End users and Administrators may export templates from the CloudStack. Navigate to the template in the UI and choose the Download function from the Actions menu.
	</div></div><div xml:lang="en-US" class="section" id="create-windows-template" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="create-windows-template">12.10. Creating a Windows Template</h2></div></div></div><div class="para">
		Windows templates must be prepared with Sysprep before they can be provisioned on multiple machines. Sysprep allows you to create a generic Windows template and avoid any possible SID conflicts.
	</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			(XenServer) Windows VMs running on XenServer require PV drivers, which may be provided in the template or added after the VM is created. The PV drivers are necessary for essential management functions such as mounting additional volumes and ISO images, live migration, and graceful shutdown.
		</div></div></div><div class="para">
		An overview of the procedure is as follows:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Upload your Windows ISO.
			</div><div class="para">
				For more information, see <a class="xref" href="#add-iso">Section 10.11.1, “Adding an ISO”</a>
			</div></li><li class="listitem"><div class="para">
				Create a VM Instance with this ISO.
			</div><div class="para">
				For more information, see <a class="xref" href="#creating-vms">Section 10.4, “Creating VMs”</a>
			</div></li><li class="listitem"><div class="para">
				Follow the steps in Sysprep for Windows Server 2008 R2 (below) or Sysprep for Windows Server 2003 R2, depending on your version of Windows Server
			</div></li><li class="listitem"><div class="para">
				The preparation steps are complete. Now you can actually create the template as described in Creating the Windows Template.
			</div></li></ol></div><div xml:lang="en-US" class="section" id="sysprep-windows-server-2008R2" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="sysprep-windows-server-2008R2">12.10.1. System Preparation for Windows Server 2008 R2</h3></div></div></div><div class="para">
		For Windows 2008 R2, you run Windows System Image Manager to create a custom sysprep response XML file. Windows System Image Manager is installed as part of the Windows Automated Installation Kit (AIK). Windows AIK can be downloaded from the Microsoft Download Center at the following location:
	</div><div class="para">
		<a href="http://www.microsoft.com/en-us/download/details.aspx?id=9085">http://www.microsoft.com/en-us/download/details.aspx?id=9085</a>Microsoft Download Center.
	</div><div class="para">
		Use the following steps to run sysprep for Windows 2008 R2:
	</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			The steps outlined here are derived from the excellent guide by Charity Shelbourne, originally published at <a href="http://blogs.technet.com/askcore/archive/2008/10/31/automating-the-oobe-process-during-windows-server-2008-sysprep-mini-setup.aspx">http://blogs.technet.com/askcore/archive/2008/10/31/automating-the-oobe-process-during-windows-server-2008-sysprep-mini-setup.aspx</a>Windows Server 2008 Sysprep Mini-Setup
		</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Download and install the Windows AIK
			</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					Windows AIK should not be installed on the Windows 2008 R2 VM you just created. Windows AIK should not be part of the template you create. It is only used to create the sysprep answer file.
				</div></div></div></li><li class="listitem"><div class="para">
				Copy the install.wim file in the \sources directory of the Windows 2008 R2 installation DVD to the hard disk. This is a very large file and may take a long time to copy. Windows AIK requires the WIM file to be writable.
			</div></li><li class="listitem"><div class="para">
				Start the Windows System Image Manager, which is part of the Windows AIK.
			</div></li><li class="listitem"><div class="para">
				In the Windows Image pane, right click “Select a Windows image or catalog file” to load the install.wim file you just copied.
			</div></li><li class="listitem"><div class="para">
				Select the Windows 2008 R2 Edition
			</div><div class="para">
				You may be prompted with a warning that the catalog file cannot be opened. Click Yes to create a new catalog file.
			</div></li><li class="listitem"><div class="para">
				In the Answer File pane, right click to create a new answer file.
			</div></li><li class="listitem"><div class="para">
				Generate the answer file from the Windows System Image Manager using the following steps:
			</div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
						The first page you need to automate is the Language and Country or Region Selection page. To automate this, expand Components in your Windows Image pane, right-click and add the Microsoft-Windows-International-Core setting to Pass 7 oobeSystem. In your Answer File pane, configure the InputLocale, SystemLocale, UILanguage, and UserLocale with the appropriate settings for your language and country or region. Should you have a question about any of these settings, you can right-click on the specific setting and select Help. This will open the appropriate CHM help file with more information, including examples on the setting you are attempting to configure.
					</div><div class="mediaobject"><img src="./images/sysmanager.png" width="444" alt="sysmanager.png: System Image Manager" /></div></li><li class="listitem"><div class="para">
						You need to automate the Software License Terms Selection page, otherwise known as the End-User License Agreement (EULA). To do this, expand the Microsoft-Windows-Shell-Setup component. High-light the OOBE setting, and add the setting to the Pass 7 oobeSystem. In Settings, set HideEULAPage true.
					</div><div class="mediaobject"><img src="./images/software-license.png" width="444" alt="software-license.png: Depicts hiding the EULA page." /></div></li><li class="listitem"><div class="para">
						Make sure the license key is properly set. If you use MAK key, you can just enter the MAK key on the Windows 2008 R2 VM. You need not input the MAK into the Windows System Image Manager. If you use KMS host for activation you need not enter the Product Key. Details of Windows Volume Activation can be found at <a href="http://technet.microsoft.com/en-us/library/bb892849.aspx">http://technet.microsoft.com/en-us/library/bb892849.aspx</a>
					</div></li><li class="listitem"><div class="para">
						You need to automate is the Change Administrator Password page. Expand the Microsoft-Windows-Shell-Setup component (if it is not still expanded), expand UserAccounts, right-click on AdministratorPassword, and add the setting to the Pass 7 oobeSystem configuration pass of your answer file. Under Settings, specify a password next to Value.
					</div><div class="mediaobject"><img src="./images/change-admin-password.png" width="444" alt="change-admin-password.png: Depicts changing the administrator password" /></div><div class="para">
						You may read the AIK documentation and set many more options that suit your deployment. The steps above are the minimum needed to make Windows unattended setup work.
					</div></li></ol></div></li><li class="listitem"><div class="para">
				Save the answer file as unattend.xml. You can ignore the warning messages that appear in the validation window.
			</div></li><li class="listitem"><div class="para">
				Copy the unattend.xml file into the c:\windows\system32\sysprep directory of the Windows 2008 R2 Virtual Machine
			</div></li><li class="listitem"><div class="para">
				Once you place the unattend.xml file in c:\windows\system32\sysprep directory, you run the sysprep tool as follows:
			</div><pre class="programlisting">cd c:\Windows\System32\sysprep
sysprep.exe /oobe /generalize /shutdown
</pre><div class="para">
				The Windows 2008 R2 VM will automatically shut down after sysprep is complete.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="sysprep-for-windows-server-2003R2" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="sysprep-for-windows-server-2003R2">12.10.2. Sysprep for Windows Server 2003 R2</h3></div></div></div><div class="para">
		Earlier versions of Windows have a different sysprep tool. Follow these steps for Windows Server 2003 R2.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Extract the content of \support\tools\deploy.cab on the Windows installation CD into a directory called c:\sysprep on the Windows 2003 R2 VM.
			</div></li><li class="listitem"><div class="para">
				Run c:\sysprep\setupmgr.exe to create the sysprep.inf file.
			</div><div class="orderedlist"><ol class="loweralpha"><li class="listitem"><div class="para">
						Select Create New to create a new Answer File.
					</div></li><li class="listitem"><div class="para">
						Enter “Sysprep setup” for the Type of Setup.
					</div></li><li class="listitem"><div class="para">
						Select the appropriate OS version and edition.
					</div></li><li class="listitem"><div class="para">
						On the License Agreement screen, select “Yes fully automate the installation”.
					</div></li><li class="listitem"><div class="para">
						Provide your name and organization.
					</div></li><li class="listitem"><div class="para">
						Leave display settings at default.
					</div></li><li class="listitem"><div class="para">
						Set the appropriate time zone.
					</div></li><li class="listitem"><div class="para">
						Provide your product key.
					</div></li><li class="listitem"><div class="para">
						Select an appropriate license mode for your deployment
					</div></li><li class="listitem"><div class="para">
						Select “Automatically generate computer name”.
					</div></li><li class="listitem"><div class="para">
						Type a default administrator password. If you enable the password reset feature, the users will not actually use this password. This password will be reset by the instance manager after the guest boots up.
					</div></li><li class="listitem"><div class="para">
						Leave Network Components at “Typical Settings”.
					</div></li><li class="listitem"><div class="para">
						Select the “WORKGROUP” option.
					</div></li><li class="listitem"><div class="para">
						Leave Telephony options at default.
					</div></li><li class="listitem"><div class="para">
						Select appropriate Regional Settings.
					</div></li><li class="listitem"><div class="para">
						Select appropriate language settings.
					</div></li><li class="listitem"><div class="para">
						Do not install printers.
					</div></li><li class="listitem"><div class="para">
						Do not specify “Run Once commands”.
					</div></li><li class="listitem"><div class="para">
						You need not specify an identification string.
					</div></li><li class="listitem"><div class="para">
						Save the Answer File as c:\sysprep\sysprep.inf.
					</div></li></ol></div></li><li class="listitem"><div class="para">
				Run the following command to sysprep the image:
			</div><pre class="programlisting">c:\sysprep\sysprep.exe -reseal -mini -activated</pre><div class="para">
				After this step the machine will automatically shut down
			</div></li></ol></div></div></div><div xml:lang="en-US" class="section" id="import-ami" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="import-ami">12.11. Importing Amazon Machine Images</h2></div></div></div><div class="para">
		The following procedures describe how to import an Amazon Machine Image (AMI) into CloudStack when using the XenServer hypervisor.
	</div><div class="para">
		Assume you have an AMI file and this file is called CentOS_6.2_x64. Assume further that you are working on a CentOS host. If the AMI is a Fedora image, you need to be working on a Fedora host initially.
	</div><div class="para">
		You need to have a XenServer host with a file-based storage repository (either a local ext3 SR or an NFS SR) to convert to a VHD once the image file has been customized on the Centos/Fedora host.
	</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			When copying and pasting a command, be sure the command has pasted as a single line before executing. Some document viewers may introduce unwanted line breaks in copied text.
		</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Set up loopback on image file:
			</div><pre class="programlisting"># mkdir -p /mnt/loop/centos62
# mount -o loop  CentOS_6.2_x64 /mnt/loop/centos54
</pre></li><li class="listitem"><div class="para">
				Install the kernel-xen package into the image. This downloads the PV kernel and ramdisk to the image.
			</div><pre class="programlisting"># yum -c /mnt/loop/centos54/etc/yum.conf --installroot=/mnt/loop/centos62/ -y install kernel-xen</pre></li><li class="listitem"><div class="para">
				Create a grub entry in /boot/grub/grub.conf.
			</div><pre class="programlisting"># mkdir -p /mnt/loop/centos62/boot/grub
# touch /mnt/loop/centos62/boot/grub/grub.conf
# echo "" &gt; /mnt/loop/centos62/boot/grub/grub.conf
</pre></li><li class="listitem"><div class="para">
				Determine the name of the PV kernel that has been installed into the image.
			</div><pre class="programlisting"># cd /mnt/loop/centos62
# ls lib/modules/
2.6.16.33-xenU  2.6.16-xenU  2.6.18-164.15.1.el5xen  2.6.18-164.6.1.el5.centos.plus  2.6.18-xenU-ec2-v1.0  2.6.21.7-2.fc8xen  2.6.31-302-ec2
# ls boot/initrd*
boot/initrd-2.6.18-164.6.1.el5.centos.plus.img boot/initrd-2.6.18-164.15.1.el5xen.img
# ls boot/vmlinuz*
boot/vmlinuz-2.6.18-164.15.1.el5xen  boot/vmlinuz-2.6.18-164.6.1.el5.centos.plus  boot/vmlinuz-2.6.18-xenU-ec2-v1.0  boot/vmlinuz-2.6.21-2952.fc8xen
</pre><div class="para">
				Xen kernels/ramdisk always end with "xen". For the kernel version you choose, there has to be an entry for that version under lib/modules, there has to be an initrd and vmlinuz corresponding to that. Above, the only kernel that satisfies this condition is 2.6.18-164.15.1.el5xen.
			</div></li><li class="listitem"><div class="para">
				Based on your findings, create an entry in the grub.conf file. Below is an example entry.
			</div><pre class="programlisting">default=0
timeout=5
hiddenmenu
title CentOS (2.6.18-164.15.1.el5xen)
        root (hd0,0)
        kernel /boot/vmlinuz-2.6.18-164.15.1.el5xen ro root=/dev/xvda 
        initrd /boot/initrd-2.6.18-164.15.1.el5xen.img
</pre></li><li class="listitem"><div class="para">
				Edit etc/fstab, changing “sda1” to “xvda” and changing “sdb” to “xvdb”.
			</div><pre class="programlisting"># cat etc/fstab
/dev/xvda  /         ext3    defaults        1 1
/dev/xvdb  /mnt      ext3    defaults        0 0
none       /dev/pts  devpts  gid=5,mode=620  0 0
none       /proc     proc    defaults        0 0
none       /sys      sysfs   defaults        0 0
</pre></li><li class="listitem"><div class="para">
				Enable login via the console. The default console device in a XenServer system is xvc0. Ensure that etc/inittab and etc/securetty have the following lines respectively:
			</div><pre class="programlisting"># grep xvc0 etc/inittab 
co:2345:respawn:/sbin/agetty xvc0 9600 vt100-nav
# grep xvc0 etc/securetty 
xvc0
</pre></li><li class="listitem"><div class="para">
				Ensure the ramdisk supports PV disk and PV network. Customize this for the kernel version you have determined above.
			</div><pre class="programlisting"># chroot /mnt/loop/centos54
# cd /boot/
# mv initrd-2.6.18-164.15.1.el5xen.img initrd-2.6.18-164.15.1.el5xen.img.bak
# mkinitrd -f /boot/initrd-2.6.18-164.15.1.el5xen.img --with=xennet --preload=xenblk --omit-scsi-modules 2.6.18-164.15.1.el5xen
</pre></li><li class="listitem"><div class="para">
				Change the password.
			</div><pre class="programlisting"># passwd
Changing password for user root.
New UNIX password: 
Retype new UNIX password: 
passwd: all authentication tokens updated successfully.
</pre></li><li class="listitem"><div class="para">
				Exit out of chroot.
			</div><pre class="programlisting"># exit</pre></li><li class="listitem"><div class="para">
				Check etc/ssh/sshd_config for lines allowing ssh login using a password.
			</div><pre class="programlisting"># egrep "PermitRootLogin|PasswordAuthentication" /mnt/loop/centos54/etc/ssh/sshd_config  
PermitRootLogin yes
PasswordAuthentication yes
</pre></li><li class="listitem"><div class="para">
				If you need the template to be enabled to reset passwords from the CloudStack UI or API, install the password change script into the image at this point. See <a class="xref" href="#add-password-management-to-templates">Section 12.13, “Adding Password Management to Your Templates”</a>.
			</div></li><li class="listitem"><div class="para">
				Unmount and delete loopback mount.
			</div><pre class="programlisting"># umount /mnt/loop/centos54
# losetup -d /dev/loop0
</pre></li><li class="listitem"><div class="para">
				Copy the image file to your XenServer host's file-based storage repository. In the example below, the Xenserver is "xenhost". This XenServer has an NFS repository whose uuid is a9c5b8c8-536b-a193-a6dc-51af3e5ff799.
			</div><pre class="programlisting"># scp CentOS_6.2_x64 xenhost:/var/run/sr-mount/a9c5b8c8-536b-a193-a6dc-51af3e5ff799/</pre></li><li class="listitem"><div class="para">
				Log in to the Xenserver and create a VDI the same size as the image.
			</div><pre class="programlisting">[root@xenhost ~]# cd /var/run/sr-mount/a9c5b8c8-536b-a193-a6dc-51af3e5ff799
[root@xenhost a9c5b8c8-536b-a193-a6dc-51af3e5ff799]#  ls -lh CentOS_6.2_x64
-rw-r--r-- 1 root root 10G Mar 16 16:49 CentOS_6.2_x64
[root@xenhost a9c5b8c8-536b-a193-a6dc-51af3e5ff799]# xe vdi-create virtual-size=10GiB sr-uuid=a9c5b8c8-536b-a193-a6dc-51af3e5ff799 type=user name-label="Centos 6.2 x86_64"
cad7317c-258b-4ef7-b207-cdf0283a7923
</pre></li><li class="listitem"><div class="para">
				Import the image file into the VDI. This may take 10–20 minutes.
			</div><pre class="programlisting">[root@xenhost a9c5b8c8-536b-a193-a6dc-51af3e5ff799]# xe vdi-import filename=CentOS_6.2_x64 uuid=cad7317c-258b-4ef7-b207-cdf0283a7923</pre></li><li class="listitem"><div class="para">
				Locate a the VHD file. This is the file with the VDI’s UUID as its name. Compress it and upload it to your web server.
			</div><pre class="programlisting">[root@xenhost a9c5b8c8-536b-a193-a6dc-51af3e5ff799]# bzip2 -c cad7317c-258b-4ef7-b207-cdf0283a7923.vhd &gt; CentOS_6.2_x64.vhd.bz2
[root@xenhost a9c5b8c8-536b-a193-a6dc-51af3e5ff799]# scp CentOS_6.2_x64.vhd.bz2 webserver:/var/www/html/templates/
</pre></li></ol></div></div><div xml:lang="en-US" class="section" id="convert-hyperv-vm-to-template" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="convert-hyperv-vm-to-template">12.12. Converting a Hyper-V VM to a Template</h2></div></div></div><div class="para">
		To convert a Hyper-V VM to a XenServer-compatible CloudStack template, you will need a standalone XenServer host with an attached NFS VHD SR. Use whatever XenServer version you are using with CloudStack, but use XenCenter 5.6 FP1 or SP2 (it is backwards compatible to 5.6). Additionally, it may help to have an attached NFS ISO SR.
	</div><div class="para">
		For Linux VMs, you may need to do some preparation in Hyper-V before trying to get the VM to work in XenServer. Clone the VM and work on the clone if you still want to use the VM in Hyper-V. Uninstall Hyper-V Integration Components and check for any references to device names in /etc/fstab:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				From the linux_ic/drivers/dist directory, run make uninstall (where "linux_ic" is the path to the copied Hyper-V Integration Components files).
			</div></li><li class="listitem"><div class="para">
				Restore the original initrd from backup in /boot/ (the backup is named *.backup0).
			</div></li><li class="listitem"><div class="para">
				Remove the "hdX=noprobe" entries from /boot/grub/menu.lst.
			</div></li><li class="listitem"><div class="para">
				Check /etc/fstab for any partitions mounted by device name. Change those entries (if any) to mount by LABEL or UUID (get that information with the "blkid" command)..
			</div></li></ol></div><div class="para">
		The next step is make sure the VM is not running in Hyper-V, then get the VHD into XenServer. There are two options for doing this.
	</div><div class="para">
		Option one:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Import the VHD using XenCenter. In XenCenter, go to Tools&gt;Virtual Appliance Tools&gt;Disk Image Import.
			</div></li><li class="listitem"><div class="para">
				Choose the VHD, then click Next.
			</div></li><li class="listitem"><div class="para">
				Name the VM, choose the NFS VHD SR under Storage, enable "Run Operating System Fixups" and choose the NFS ISO SR.
			</div></li><li class="listitem"><div class="para">
				Click Next, then Finish. A VM should be created.
			</div></li></ol></div><div class="para">
		Option two
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Run XenConvert, under From choose VHD, under To choose XenServer. Click Next.
			</div></li><li class="listitem"><div class="para">
				Choose the VHD, then click Next.
			</div></li><li class="listitem"><div class="para">
				Input the XenServer host info, then click Next.
			</div></li><li class="listitem"><div class="para">
				Name the VM, then click Next, then Convert. A VM should be created
			</div></li></ol></div><div class="para">
		Once you have a VM created from the Hyper-V VHD, prepare it using the following steps:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Boot the VM, uninstall Hyper-V Integration Services, and reboot.
			</div></li><li class="listitem"><div class="para">
				Install XenServer Tools, then reboot.
			</div></li><li class="listitem"><div class="para">
				Prepare the VM as desired. For example, run sysprep on Windows VMs. See <a class="xref" href="#create-windows-template">Section 12.10, “Creating a Windows Template”</a>
			</div></li></ol></div><div class="para">
		Either option above will create a VM in HVM mode. This is fine for Windows VMs, but Linux VMs may not perform optimally. Converting a Linux VM to PV mode will require additional steps and will vary by distribution.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Shut down the VM and copy the VHD from the NFS storage to a web server; for example, mount the NFS share on the web server and copy it, or from the XenServer host use sftp or scp to upload it to the web server.
			</div></li><li class="listitem"><div class="para">
				In CloudStack, create a new template using the following values:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						URL. Give the URL for the VHD
					</div></li><li class="listitem"><div class="para">
						OS Type. Use the appropriate OS. For PV mode on CentOS, choose Other PV (32-bit) or Other PV (64-bit). This choice is available only for XenServer.
					</div></li><li class="listitem"><div class="para">
						Hypervisor. XenServer
					</div></li><li class="listitem"><div class="para">
						Format. VHD
					</div></li></ul></div></li></ol></div><div class="para">
		The template will be created, and you can create instances from it.
	</div></div><div xml:lang="en-US" class="section" id="add-password-management-to-templates" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="add-password-management-to-templates">12.13. Adding Password Management to Your Templates</h2></div></div></div><div class="para">
		CloudStack provides an optional password reset feature that allows users to set a temporary admin or root password as well as reset the existing admin or root password from the CloudStack UI.
	</div><div class="para">
		To enable the Reset Password feature, you will need to download an additional script to patch your template. When you later upload the template into CloudStack, you can specify whether reset admin/root password feature should be enabled for this template.
	</div><div class="para">
		The password management feature works always resets the account password on instance boot. The script does an HTTP call to the virtual router to retrieve the account password that should be set. As long as the virtual router is accessible the guest will have access to the account password that should be used. When the user requests a password reset the management server generates and sends a new password to the virtual router for the account. Thus an instance reboot is necessary to effect any password changes.
	</div><div class="para">
		If the script is unable to contact the virtual router during instance boot it will not set the password but boot will continue normally.
	</div><div xml:lang="en-US" class="section" id="linux-installation" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="linux-installation">12.13.1. Linux OS Installation</h3></div></div></div><div class="para">
		Use the following steps to begin the Linux OS installation:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Download the script file cloud-set-guest-password:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Linux: <a href="http://cloudstack.org/dl/cloud-set-guest-password">http://cloudstack.org/dl/cloud-set-guest-password</a>
					</div></li><li class="listitem"><div class="para">
						Windows: <a href="http://sourceforge.net/projects/cloudstack/files/Password%20Management%20Scripts/CloudInstanceManager.msi/download">http://sourceforge.net/projects/cloudstack/files/Password%20Management%20Scripts/CloudInstanceManager.msi/download</a>
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Copy this file to /etc/init.d.
			</div><div class="para">
				On some Linux distributions, copy the file to /etc/rc.d/init.d.
			</div></li><li class="listitem"><div class="para">
				Run the following command to make the script executable:
			</div><pre class="programlisting">chmod +x /etc/init.d/cloud-set-guest-password</pre></li><li class="listitem"><div class="para">
				Depending on the Linux distribution, continue with the appropriate step.
			</div><div class="para">
				On Fedora, CentOS/RHEL, and Debian, run:
			</div><pre class="programlisting">chkconfig --add cloud-set-guest-password</pre></li></ol></div></div><div xml:lang="en-US" class="section" id="windows-installation" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="windows-installation">12.13.2. Windows OS Installation</h3></div></div></div><div class="para">
		Download the installer, CloudInstanceManager.msi, from <a href="http://cloudstack.org/download.html">Download page</a> and run the installer in the newly created Windows VM.
	</div></div></div><div xml:lang="en-US" class="section" id="delete-templates" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="delete-templates">12.14. Deleting Templates</h2></div></div></div><div class="para">
		Templates may be deleted. In general, when a template spans multiple Zones, only the copy that is selected for deletion will be deleted; the same template in other Zones will not be deleted. The provided CentOS template is an exception to this. If the provided CentOS template is deleted, it will be deleted from all Zones.
	</div><div class="para">
		When templates are deleted, the VMs instantiated from them will continue to run. However, new VMs cannot be created based on the deleted template.
	</div></div></div><div xml:lang="en-US" class="chapter" id="storage" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 13. Working With Storage</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#storage-overview">13.1. Storage Overview</a></span></dt><dt><span class="section"><a href="#primary-storage">13.2. Primary Storage</a></span></dt><dt><span class="section"><a href="#secondary-storage">13.3. Secondary Storage</a></span></dt><dt><span class="section"><a href="#working-with-volumes">13.4. Using Swift for Secondary Storage</a></span></dt><dt><span class="section"><a href="#working-with-snapshots">13.5. Working with Snapshots</a></span></dt></dl></div><div xml:lang="en-US" class="section" id="storage-overview" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="storage-overview">13.1. Storage Overview</h2></div></div></div><div class="para">
		CloudStack defines two types of storage: primary and secondary. Primary storage can be accessed by either iSCSI or NFS. Additionally, direct attached storage may be used for primary storage. Secondary storage is always accessed using NFS.
	</div><div class="para">
		There is no ephemeral storage in CloudStack. All volumes on all nodes are persistent.
	</div></div><div xml:lang="en-US" class="section" id="primary-storage" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="primary-storage">13.2. Primary Storage</h2></div></div></div><div class="para">
		This section gives concepts and technical details about CloudPlatform primary storage. For information about how to install and configure primary storage through the CloudPlatform UI, see the Advanced Installation Guide.
	</div></div><div xml:lang="en-US" class="section" id="secondary-storage" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="secondary-storage">13.3. Secondary Storage</h2></div></div></div><div class="para">
		This section gives concepts and technical details about CloudStack secondary storage. For information about how to install and configure secondary storage through the CloudStack UI, see the Advanced Installation Guide.
	</div></div><div xml:lang="en-US" class="section" id="working-with-volumes" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="working-with-volumes">13.4. Using Swift for Secondary Storage</h2></div></div></div><div class="para">
		A volume provides storage to a guest VM. The volume can provide for a root disk or an additional data disk. CloudStack supports additional volumes for guest VMs.
	</div><div class="para">
		Volumes are created for a specific hypervisor type. A volume that has been attached to guest using one hypervisor type (e.g, XenServer) may not be attached to a guest that is using another hypervisor type (e.g. vSphere, KVM). This is because the different hypervisors use different disk image formats.
	</div><div class="para">
		CloudStack defines a volume as a unit of storage available to a guest VM. Volumes are either root disks or data disks. The root disk has "/" in the file system and is usually the boot device. Data disks provide for additional storage (e.g. As "/opt" or "D:"). Every guest VM has a root disk, and VMs can also optionally have a data disk. End users can mount multiple data disks to guest VMs. Users choose data disks from the disk offerings created by administrators. The user can create a template from a volume as well; this is the standard procedure for private template creation. Volumes are hypervisor-specific: a volume from one hypervisor type may not be used on a guest of another hypervisor type.
	</div></div><div xml:lang="en-US" class="section" id="working-with-snapshots" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="working-with-snapshots">13.5. Working with Snapshots</h2></div></div></div><div class="para">
		(Supported for the following hypervisors: <span class="bold bold"><strong>XenServer</strong></span>, <span class="bold bold"><strong>VMware vSphere</strong></span>, and <span class="bold bold"><strong>KVM</strong></span>)
	</div><div class="para">
		CloudStack supports snapshots of disk volumes. Snapshots are a point-in-time capture of virtual machine disks. Memory and CPU states are not captured. 
	</div><div class="para">
		Snapshots may be taken for volumes, including both root and data disks. The administrator places a limit on the number of stored snapshots per user. Users can create new volumes from the snapshot for recovery of particular files and they can create templates from snapshots to boot from a restored disk.
	</div><div class="para">
		Users can create snapshots manually or by setting up automatic recurring snapshot policies. Users can also create disk volumes from snapshots, which may be attached to a VM like any other disk volume. Snapshots of both root disks and data disks are supported. However, CloudStack does not currently support booting a VM from a recovered root disk. A disk recovered from snapshot of a root disk is treated as a regular data disk; the data on recovered disk can be accessed by attaching the disk to a VM.
	</div><div class="para">
		A completed snapshot is copied from primary storage to secondary storage, where it is stored until deleted or purged by newer snapshot.
	</div></div></div><div xml:lang="en-US" class="chapter" id="work-with-usage" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 14. Working with Usage</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#configure-usage-server">14.1. Configuring the Usage Server</a></span></dt><dt><span class="section"><a href="#set-usage-limit">14.2. Setting Usage Limits</a></span></dt><dt><span class="section"><a href="#globally-configured-limit">14.3. Globally Configured Limits</a></span></dt><dt><span class="section"><a href="#default-account-resource-limit">14.4. Default Account Resource Limits</a></span></dt><dt><span class="section"><a href="#per-domain-limits">14.5. Per-Domain Limits</a></span></dt></dl></div><div class="para">
		The Usage Server is an optional, separately-installed part of CloudStack that provides aggregated usage records which you can use to create billing integration for CloudStack. The Usage Server works by taking data from the events log and creating summary usage records that you can access using the listUsageRecords API call.
	</div><div class="para">
		The usage records show the amount of resources, such as VM run time or template storage space, consumed by guest instances.
	</div><div class="para">
		The Usage Server runs at least once per day. It can be configured to run multiple times per day.
	</div><div xml:lang="en-US" class="section" id="configure-usage-server" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="configure-usage-server">14.1. Configuring the Usage Server</h2></div></div></div><div class="para">
		To configure the usage server:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Be sure the Usage Server has been installed. This requires extra steps beyond just installing the CloudStack software. See Installing the Usage Server (Optional) in the Advanced Installation Guide.
			</div></li><li class="listitem"><div class="para">
				Log in to the CloudStack UI as administrator.
			</div></li><li class="listitem"><div class="para">
				Click Global Settings.
			</div></li><li class="listitem"><div class="para">
				In Search, type usage. Find the configuration parameter that controls the behavior you want to set. See the table below for a description of the available parameters.
			</div></li><li class="listitem"><div class="para">
				In Actions, click the Edit icon.
			</div></li><li class="listitem"><div class="para">
				Type the desired value and click the Save icon.
			</div></li><li class="listitem"><div class="para">
				Restart the Management Server (as usual with any global configuration change) and also the Usage Server:
			</div><pre class="programlisting"># service cloud-management restart
# service cloud-usage restart
</pre></li></ol></div><div class="para">
		The following table shows the global configuration settings that control the behavior of the Usage Server.
	</div><div class="informaltable"><table border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><thead><tr><th align="left">
						<div class="para">
							Parameter Name
						</div>
					</th><th align="left">
						<div class="para">
							Description
						</div>
					</th></tr></thead><tbody><tr><td align="left">
						<div class="para">
							enable.usage.server
						</div>
					</td><td align="left">
						<div class="para">
							Whether the Usage Server is active.
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							usage.aggregation.timezone
						</div>
					</td><td align="left">
						<div class="para">
							Time zone of usage records. Set this if the usage records and daily job execution are in different time zones. For example, with the following settings, the usage job will run at PST 00:15 and generate usage records for the 24 hours from 00:00:00 GMT to 23:59:59 GMT:
						</div>
						 
<pre class="programlisting">usage.stats.job.exec.time = 00:15    
usage.execution.timezone = PST
usage.aggregation.timezone = GMT
</pre>
						 <div class="para">
							Valid values for the time zone are specified in <a class="xref" href="#time-zones">Appendix A, <em>Time Zones</em></a>
						</div>
						 <div class="para">
							Default: GMT
						</div>

					</td></tr><tr><td align="left">
						<div class="para">
							usage.execution.timezone
						</div>
					</td><td align="left">
						<div class="para">
							The time zone of usage.stats.job.exec.time. Valid values for the time zone are specified in <a class="xref" href="#time-zones">Appendix A, <em>Time Zones</em></a>
						</div>
						 <div class="para">
							Default: The time zone of the management server.
						</div>

					</td></tr><tr><td align="left">
						<div class="para">
							usage.sanity.check.interval
						</div>
					</td><td align="left">
						<div class="para">
							The number of days between sanity checks. Set this in order to periodically search for records with erroneous data before issuing customer invoices. For example, this checks for VM usage records created after the VM was destroyed, and similar checks for templates, volumes, and so on. It also checks for usage times longer than the aggregation range. If any issue is found, the alert ALERT_TYPE_USAGE_SANITY_RESULT = 21 is sent.
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							usage.stats.job.aggregation.range
						</div>
					</td><td align="left">
						<div class="para">
							The time period in minutes between Usage Server processing jobs. For example, if you set it to 1440, the Usage Server will run once per day. If you set it to 600, it will run every ten hours. In general, when a Usage Server job runs, it processes all events generated since usage was last run.
						</div>
						 <div class="para">
							There is special handling for the case of 1440 (once per day). In this case the Usage Server does not necessarily process all records since Usage was last run. CloudStack assumes that you require processing once per day for the previous, complete day’s records. For example, if the current day is October 7, then it is assumed you would like to process records for October 6, from midnight to midnight. CloudStack assumes this "midnight to midnight" is relative to the usage.execution.timezone.
						</div>
						 <div class="para">
							Default: 1440
						</div>

					</td></tr><tr><td align="left">
						<div class="para">
							usage.stats.job.exec.time
						</div>
					</td><td align="left">
						<div class="para">
							The time when the Usage Server processing will start. It is specified in 24-hour format (HH:MM) in the time zone of the server, which should be GMT. For example, to start the Usage job at 10:30 GMT, enter "10:30".
						</div>
						 <div class="para">
							If usage.stats.job.aggregation.range is also set, and its value is not 1440, then its value will be added to usage.stats.job.exec.time to get the time to run the Usage Server job again. This is repeated until 24 hours have elapsed, and the next day's processing begins again at usage.stats.job.exec.time.
						</div>
						 <div class="para">
							Default: 00:15.
						</div>

					</td></tr></tbody></table></div><div class="para">
		For example, suppose that your server is in GMT, your user population is predominantly in the East Coast of the United States, and you would like to process usage records every night at 2 AM local (EST) time. Choose these settings:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				enable.usage.server = true
			</div></li><li class="listitem"><div class="para">
				usage.execution.timezone = America/New_York
			</div></li><li class="listitem"><div class="para">
				usage.stats.job.exec.time = 07:00. This will run the Usage job at 2:00 AM EST. Note that this will shift by an hour as the East Coast of the U.S. enters and exits Daylight Savings Time.
			</div></li><li class="listitem"><div class="para">
				usage.stats.job.aggregation.range = 1440
			</div></li></ul></div><div class="para">
		With this configuration, the Usage job will run every night at 2 AM EST and will process records for the previous day’s midnight-midnight as defined by the EST (America/New_York) time zone.
	</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			Because the special value 1440 has been used for usage.stats.job.aggregation.range, the Usage Server will ignore the data between midnight and 2 AM. That data will be included in the next day's run
		</div></div></div></div><div xml:lang="en-US" class="section" id="set-usage-limit" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="set-usage-limit">14.2. Setting Usage Limits</h2></div></div></div><div class="para">
		CloudStack provides several administrator control points for capping resource usage by users. Some of these limits are global configuration parameters. Others are applied at the ROOT domain and may be overridden on a per-account basis.
	</div><div class="para">
		Aggregate limits may be set on a per-domain basis. For example, you may limit a domain and all subdomains to the creation of 100 VMs.
	</div><div class="para">
		This section covers the following topics:
	</div><div class="para">
		<a class="xref" href="#globally-configured-limit">Section 14.3, “Globally Configured Limits”</a>Globally Configured Limits
	</div><div class="para">
		<a class="xref" href="#default-account-resource-limit">Section 14.4, “Default Account Resource Limits”</a>Default Account Resource Limits
	</div><div class="para">
		<a class="xref" href="#per-domain-limits">Section 14.5, “Per-Domain Limits”</a>Per Domain Limits
	</div></div><div xml:lang="en-US" class="section" id="globally-configured-limit" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="globally-configured-limit">14.3. Globally Configured Limits</h2></div></div></div><div class="para">
		In a zone, the guest virtual network has a 24 bit CIDR by default. This limits the guest virtual network to 254 running instances. It can be adjusted as needed, but this must be done before any instances are created in the zone. For example, 10.1.1.0/22 would provide for ~1000 addresses.
	</div><div class="para">
		The following table lists limits set in the Global Configuration:
	</div><div class="informaltable"><table border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><thead><tr><th>
						<div class="para">
							Parameter Name
						</div>
					</th><th>
						<div class="para">
							Definition
						</div>
					</th></tr></thead><tbody><tr><td>
						<div class="para">
							max.account.public.ips
						</div>
					</td><td>
						<div class="para">
							Number of public IP addresses that can be owned by an account
						</div>
					</td></tr><tr><td>
						<div class="para">
							max.account.snapshots
						</div>
					</td><td>
						<div class="para">
							Number of snapshots that can exist for an account
						</div>
					</td></tr><tr><td>
						<div class="para">
							max.account.templates
						</div>
					</td><td>
						<div class="para">
							Number of templates that can exist for an account
						</div>
					</td></tr><tr><td>
						<div class="para">
							max.account.user.vms
						</div>
					</td><td>
						<div class="para">
							Number of virtual machine instances that can exist for an account
						</div>
					</td></tr><tr><td>
						<div class="para">
							max.account.volumes
						</div>
					</td><td>
						<div class="para">
							Number of disk volumes that can exist for an account
						</div>
					</td></tr><tr><td>
						<div class="para">
							max.template.iso.size
						</div>
					</td><td>
						<div class="para">
							Maximum size for a downloaded template or ISO in GB
						</div>
					</td></tr><tr><td>
						<div class="para">
							max.volume.size.gb
						</div>
					</td><td>
						<div class="para">
							Maximum size for a volume in GB
						</div>
					</td></tr><tr><td>
						<div class="para">
							network.throttling.rate
						</div>
					</td><td>
						<div class="para">
							Default data transfer rate in megabits per second allowed per user (supported on XenServer)
						</div>
					</td></tr><tr><td>
						<div class="para">
							snapshot.max.hourly
						</div>
					</td><td>
						<div class="para">
							Maximum recurring hourly snapshots to be retained for a volume. If the limit is reached, early snapshots from the start of the hour are deleted so that newer ones can be saved. This limit does not apply to manual snapshots. If set to 0, recurring hourly snapshots can not be scheduled
						</div>
					</td></tr><tr><td>
						<div class="para">
							snapshot.max.daily
						</div>
					</td><td>
						<div class="para">
							Maximum recurring daily snapshots to be retained for a volume. If the limit is reached, snapshots from the start of the day are deleted so that newer ones can be saved. This limit does not apply to manual snapshots. If set to 0, recurring daily snapshots can not be scheduled
						</div>
					</td></tr><tr><td>
						<div class="para">
							snapshot.max.weekly
						</div>
					</td><td>
						<div class="para">
							Maximum recurring weekly snapshots to be retained for a volume. If the limit is reached, snapshots from the beginning of the week are deleted so that newer ones can be saved. This limit does not apply to manual snapshots. If set to 0, recurring weekly snapshots can not be scheduled
						</div>
					</td></tr><tr><td>
						<div class="para">
							snapshot.max.monthly
						</div>
					</td><td>
						<div class="para">
							Maximum recurring monthly snapshots to be retained for a volume. If the limit is reached, snapshots from the beginning of the month are deleted so that newer ones can be saved. This limit does not apply to manual snapshots. If set to 0, recurring monthly snapshots can not be scheduled.
						</div>
					</td></tr></tbody></table></div><div class="para">
		To modify global configuration parameters, use the global configuration screen in the CloudStack UI. See Setting Global Configuration Parameters
	</div></div><div xml:lang="en-US" class="section" id="default-account-resource-limit" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="default-account-resource-limit">14.4. Default Account Resource Limits</h2></div></div></div><div class="para">
		You can limit resource use by accounts. The default limits are set using global configuration parameters, and they affect all accounts within a cloud. The relevant parameters are those beginning with max.account (max.account.snapshots, etc.)..
	</div><div class="para">
		To override a default limit for a particular account, set a per-account resource limit.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation tree, click Accounts.
			</div></li><li class="listitem"><div class="para">
				Select the account you want to modify. The current limits are displayed. A value of -1 shows that there is no limit in place
			</div></li><li class="listitem"><div class="para">
				Click the Edit button
				<span class="inlinemediaobject"><img src="./images/edit-icon.png" alt="editbutton.png: edits the settings." /></span>
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="per-domain-limits" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="per-domain-limits">14.5. Per-Domain Limits</h2></div></div></div><div class="para">
		CloudStack allows the configuration of limits on a domain basis. With a domain limit in place, all users still have their account limits. They are additionally limited, as a group, to not exceed the resource limits set on their domain. Domain limits aggregate the usage of all accounts in the domain as well as all accounts in all subdomains of that domain. Limits set at the root domain level apply to the sum of resource usage by the accounts in all domains and sub-domains below that root domain.
	</div><div class="para">
		To set a domain limit:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation tree, click Domains.
			</div></li><li class="listitem"><div class="para">
				Select the domain you want to modify. The current domain limits are displayed. A value of -1 shows that there is no limit in place.
			</div></li><li class="listitem"><div class="para">
				Click the Edit button
				<span class="inlinemediaobject"><img src="./images/edit-icon.png" alt="editbutton.png: edits the settings." /></span>
			</div></li></ol></div></div></div><div xml:lang="en-US" class="chapter" id="networks" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 15. Managing Networks and Traffic</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#guest-traffic">15.1. Guest Traffic</a></span></dt><dt><span class="section"><a href="#networking-in-a-pod">15.2. Networking in a Pod</a></span></dt><dt><span class="section"><a href="#networking-in-a-zone">15.3. Networking in a Zone</a></span></dt><dt><span class="section"><a href="#basic-zone-physical-network-configuration">15.4. Basic Zone Physical Network Configuration</a></span></dt><dt><span class="section"><a href="#advanced-zone-physical-network-configuration">15.5. Advanced Zone Physical Network Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#configure-guest-traffic-in-advanced-zone">15.5.1. Configure Guest Traffic in an Advanced Zone</a></span></dt><dt><span class="section"><a href="#configure-public-traffic-in-an-advanced-zone">15.5.2. Configure Public Traffic in an Advanced Zone</a></span></dt></dl></dd><dt><span class="section"><a href="#using-multiple-guest-networks">15.6. Using Multiple Guest Networks</a></span></dt><dd><dl><dt><span class="section"><a href="#add-additional-guest-network">15.6.1. Adding an Additional Guest Network</a></span></dt><dt><span class="section"><a href="#change-network-offering-on-guest-network">15.6.2. Changing the Network Offering on a Guest Network</a></span></dt></dl></dd><dt><span class="section"><a href="#security-groups">15.7. Security Groups</a></span></dt><dd><dl><dt><span class="section"><a href="#about-security-groups">15.7.1. About Security Groups</a></span></dt><dt><span class="section"><a href="#add-security-group">15.7.2. Adding a Security Group</a></span></dt><dt><span class="section"><a href="#enable-security-groups">15.7.3. Enabling Security Groups</a></span></dt><dt><span class="section"><a href="#add-ingress-egress-rules">15.7.4. Adding Ingress and Egress Rules to a Security Group</a></span></dt></dl></dd><dt><span class="section"><a href="#external-firewalls-and-load-balancers">15.8. External Firewalls and Load Balancers</a></span></dt><dt><span class="section"><a href="#load-balancer-rules">15.9. Load Balancer Rules</a></span></dt><dt><span class="section"><a href="#guest-ip-ranges">15.10. Guest IP Ranges</a></span></dt><dt><span class="section"><a href="#acquire-new-ip-address">15.11. Acquiring a New IP Address</a></span></dt><dt><span class="section"><a href="#release-ip-address">15.12. Releasing an IP Address</a></span></dt><dt><span class="section"><a href="#static-nat">15.13. Static NAT</a></span></dt><dt><span class="section"><a href="#ip-forwarding-firewalling">15.14. IP Forwarding and Firewalling</a></span></dt><dt><span class="section"><a href="#ip-load-balancing">15.15. IP Load Balancing</a></span></dt><dt><span class="section"><a href="#dns-dhcp">15.16. DNS and DHCP</a></span></dt><dt><span class="section"><a href="#vpn">15.17. VPN</a></span></dt><dd><dl><dt><span class="section"><a href="#configure-vpn">15.17.1. Configuring VPN</a></span></dt><dt><span class="section"><a href="#using-vpn-with-windows">15.17.2. Using VPN with Windows</a></span></dt><dt><span class="section"><a href="#using-vpn-with-mac">15.17.3. Using VPN with Mac OS X</a></span></dt><dt><span class="section"><a href="#site-to-site-vpn">15.17.4. Setting Up a Site-to-Site VPN Connection</a></span></dt></dl></dd><dt><span class="section"><a href="#inter-vlan-routing">15.18. About Inter-VLAN Routing</a></span></dt><dt><span class="section"><a href="#configure-vpc">15.19. Configuring a Virtual Private Cloud</a></span></dt><dd><dl><dt><span class="section"><a href="#vpc">15.19.1. About Virtual Private Clouds</a></span></dt><dt><span class="section"><a href="#add-vpc">15.19.2. Adding a Virtual Private Cloud</a></span></dt><dt><span class="section"><a href="#add-tier">15.19.3. Adding Tiers</a></span></dt><dt><span class="section"><a href="#configure-acl">15.19.4. Configuring Access Control List</a></span></dt><dt><span class="section"><a href="#add-gateway-vpc">15.19.5. Adding a Private Gateway to a VPC</a></span></dt><dt><span class="section"><a href="#add-vm-to-tier">15.19.6. Deploying VMs to the Tier</a></span></dt><dt><span class="section"><a href="#acquire-new-ip-for-vpc">15.19.7. Acquiring a New IP Address for a VPC</a></span></dt><dt><span class="section"><a href="#release-ip-for-vpc">15.19.8. Releasing an IP Address Alloted to a VPC</a></span></dt><dt><span class="section"><a href="#enable-disable-static-nat-vpc">15.19.9. Enabling or Disabling Static NAT on a VPC</a></span></dt><dt><span class="section"><a href="#add-loadbalancer-rule-vpc">15.19.10. Adding Load Balancing Rules on a VPC</a></span></dt><dt><span class="section"><a href="#add-portforward-vpc">15.19.11. Adding a Port Forwarding Rule on a VPC</a></span></dt><dt><span class="section"><a href="#remove-tier">15.19.12. Removing Tiers</a></span></dt><dt><span class="section"><a href="#remove-vpc">15.19.13. Editing, Restarting, and Removing a Virtual Private Cloud</a></span></dt></dl></dd></dl></div><div class="para">
		In a CloudStack, guest VMs can communicate with each other using shared infrastructure with the security and user perception that the guests have a private LAN. The CloudStack virtual router is the main component providing networking features for guest traffic.
	</div><div xml:lang="en-US" class="section" id="guest-traffic" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="guest-traffic">15.1. Guest Traffic</h2></div></div></div><div class="para">
		A network can carry guest traffic only between VMs within one zone. Virtual machines in different zones cannot communicate with each other using their IP addresses; they must communicate with each other by routing through a public IP address.
	</div><div class="para">
		Figure 1 illustrates a typical guest traffic setup:
	</div><div class="mediaobject"><img src="./images/basic-deployment.png" alt="guesttraffic.png: Depicts a guest traffic setup" /></div><div class="para">
		The Management Server automatically creates a virtual router for each network. A virtual router is a special virtual machine that runs on the hosts. Each virtual router has three network interfaces. Its eth0 interface serves as the gateway for the guest traffic and has the IP address of 10.1.1.1. Its eth1 interface is used by the system to configure the virtual router. Its eth2 interface is assigned a public IP address for public traffic.
	</div><div class="para">
		The virtual router provides DHCP and will automatically assign an IP address for each guest VM within the IP range assigned for the network. The user can manually reconfigure guest VMs to assume different IP addresses.
	</div><div class="para">
		Source NAT is automatically configured in the virtual router to forward outbound traffic for all guest VMs
	</div></div><div xml:lang="en-US" class="section" id="networking-in-a-pod" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="networking-in-a-pod">15.2. Networking in a Pod</h2></div></div></div><div class="para">
		Figure 2 illustrates network setup within a single pod. The hosts are connected to a pod-level switch. At a minimum, the hosts should have one physical uplink to each switch. Bonded NICs are supported as well. The pod-level switch is a pair of redundant gigabit switches with 10 G uplinks.
	</div><div class="mediaobject"><img src="./images/networking-in-a-pod.png" width="444" alt="networking-in-a-pod.png: Network setup in a pod" /></div><div class="para">
		Servers are connected as follows:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Storage devices are connected to only the network that carries management traffic.
			</div></li><li class="listitem"><div class="para">
				Hosts are connected to networks for both management traffic and public traffic.
			</div></li><li class="listitem"><div class="para">
				Hosts are also connected to one or more networks carrying guest traffic.
			</div></li></ul></div><div class="para">
		We recommend the use of multiple physical Ethernet cards to implement each network interface as well as redundant switch fabric in order to maximize throughput and improve reliability.
	</div></div><div xml:lang="en-US" class="section" id="networking-in-a-zone" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="networking-in-a-zone">15.3. Networking in a Zone</h2></div></div></div><div class="para">
		Figure 3 illustrates the network setup within a single zone.
	</div><div class="mediaobject"><img src="./images/networking-in-a-zone.png" width="444" alt="networking-in-a-zone.png: Network setup in a single zone" /></div><div class="para">
		A firewall for management traffic operates in the NAT mode. The network typically is assigned IP addresses in the 192.168.0.0/16 Class B private address space. Each pod is assigned IP addresses in the 192.168.*.0/24 Class C private address space.
	</div><div class="para">
		Each zone has its own set of public IP addresses. Public IP addresses from different zones do not overlap.
	</div></div><div xml:lang="en-US" class="section" id="basic-zone-physical-network-configuration" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="basic-zone-physical-network-configuration">15.4. Basic Zone Physical Network Configuration</h2></div></div></div><div class="para">
		In a basic network, configuring the physical network is fairly straightforward. You only need to configure one guest network to carry traffic that is generated by guest VMs. When you first add a zone to CloudPlatform, you set up the guest network through the Add Zone screens.
	</div></div><div xml:lang="en-US" class="section" id="advanced-zone-physical-network-configuration" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="advanced-zone-physical-network-configuration">15.5. Advanced Zone Physical Network Configuration</h2></div></div></div><div class="para">
		Within a zone that uses advanced networking, you need to tell the Management Server how the physical network is set up to carry different kinds of traffic in isolation.
	</div><div xml:lang="en-US" class="section" id="configure-guest-traffic-in-advanced-zone" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="configure-guest-traffic-in-advanced-zone">15.5.1. Configure Guest Traffic in an Advanced Zone</h3></div></div></div><div class="para">
		These steps assume you have already logged in to the CloudStack UI. To configure the base guest network:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				In the left navigation, choose Infrastructure. On Zones, click View More, then click the zone to which you want to add a network.
			</div></li><li class="listitem"><div class="para">
				Click the Network tab.
			</div></li><li class="listitem"><div class="para">
				Click Add guest network.
			</div><div class="para">
				The Add guest network window is displayed:
			</div><div class="mediaobject"><img src="./images/add-guest-network.png" alt="networksetupzone.png: Depicts network setup in a single zone" /></div></li><li class="listitem"><div class="para">
				Provide the following information:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>. The name of the network. This will be user-visible
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Display Text</strong></span>: The description of the network. This will be user-visible
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Zone</strong></span>: The zone in which you are configuring the guest network.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Network offering</strong></span>: If the administrator has configured multiple network offerings, select the one you want to use for this network
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Guest Gateway</strong></span>: The gateway that the guests should use
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Guest Netmask</strong></span>: The netmask in use on the subnet the guests will use
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click OK.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="configure-public-traffic-in-an-advanced-zone" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="configure-public-traffic-in-an-advanced-zone">15.5.2. Configure Public Traffic in an Advanced Zone</h3></div></div></div><div class="para">
		In a zone that uses advanced networking, you need to configure at least one range of IP addresses for Internet traffic.
	</div></div></div><div xml:lang="en-US" class="section" id="using-multiple-guest-networks" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="using-multiple-guest-networks">15.6. Using Multiple Guest Networks</h2></div></div></div><div class="para">
		In zones that use advanced networking, additional networks for guest traffic may be added at any time after the initial installation. You can also customize the domain name associated with the network by specifying a DNS suffix for each network.
	</div><div class="para">
		A VM's networks are defined at VM creation time. A VM cannot add or remove networks after it has been created, although the user can go into the guest and remove the IP address from the NIC on a particular network.
	</div><div class="para">
		Each VM has just one default network. The virtual router's DHCP reply will set the guest's default gateway as that for the default network. Multiple non-default networks may be added to a guest in addition to the single, required default network. The administrator can control which networks are available as the default network.
	</div><div class="para">
		Additional networks can either be available to all accounts or be assigned to a specific account. Networks that are available to all accounts are zone-wide. Any user with access to the zone can create a VM with access to that network. These zone-wide networks provide little or no isolation between guests.Networks that are assigned to a specific account provide strong isolation.
	</div><div xml:lang="en-US" class="section" id="add-additional-guest-network" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-additional-guest-network">15.6.1. Adding an Additional Guest Network</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				Click Add guest network. Provide the following information:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: The name of the network. This will be user-visible.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Display Text</strong></span>: The description of the network. This will be user-visible.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Zone</strong></span>. The name of the zone this network applies to. Each zone is a broadcast domain, and therefore each zone has a different IP range for the guest network. The administrator must configure the IP range for each zone.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Network offering</strong></span>: If the administrator has configured multiple network offerings, select the one you want to use for this network.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Guest Gateway</strong></span>: The gateway that the guests should use.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Guest Netmask</strong></span>: The netmask in use on the subnet the guests will use.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click Create.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="change-network-offering-on-guest-network" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="change-network-offering-on-guest-network">15.6.2. Changing the Network Offering on a Guest Network</h3></div></div></div><div class="para">
		A user or administrator can change the network offering that is associated with an existing guest network.
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				If you are changing from a network offering that uses the CloudStack virtual router to one that uses external devices as network service providers, you must first stop all the VMs on the network. See Stopping and Starting VMs. Then return here and continue to the next step
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network
			</div></li><li class="listitem"><div class="para">
				Click the name of the network you want to modify 
				<span class="inlinemediaobject"><img src="./images/edit-icon.png" alt="AttachDiskButton.png: button to attach a volume" /></span>
				.
			</div></li><li class="listitem"><div class="para">
				In Network Offering, choose the new network offering, then click Apply.
			</div></li><li class="listitem"><div class="para">
				A prompt appears asking whether you want to keep the existing CIDR. This is to let you know that if you change the network offering, the CIDR will be affected. Choose No to proceed with the change.
			</div></li><li class="listitem"><div class="para">
				Wait for the update to complete. Don’t try to restart VMs until after the network change is complete.
			</div></li><li class="listitem"><div class="para">
				If you stopped any VMs in step 2, restart them.
			</div></li></ul></div></div></div><div xml:lang="en-US" class="section" id="security-groups" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="security-groups">15.7. Security Groups</h2></div></div></div><div xml:lang="en-US" class="section" id="about-security-groups" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="about-security-groups">15.7.1. About Security Groups</h3></div></div></div><div class="para">
		Security groups provide a way to isolate traffic to VMs. A security group is a group of VMs that filter their incoming and outgoing traffic according to a set of rules, called ingress and egress rules. These rules filter network traffic according to the IP address that is attempting to communicate with the VM. Security groups are particularly useful in zones that use basic networking, because there is a single guest network for all guest VMs. In CloudStack 3.0.3 - 3.0.5, security groups are supported only in zones that use basic networking.
	</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			In a zone that uses advanced networking, you can instead define multiple guest networks to isolate traffic to VMs.
		</div></div></div><div class="para">
	</div><div class="para">
		Each CloudStack account comes with a default security group that denies all inbound traffic and allows all outbound traffic. The default security group can be modified so that all new VMs inherit some other desired set of rules.
	</div><div class="para">
		Any CloudStack user can set up any number of additional security groups. When a new VM is launched, it is assigned to the default security group unless another user-defined security group is specified. A VM can be a member of any number of security groups. Once a VM is assigned to a security group, it remains in that group for its entire lifetime; you can not move a running VM from one security group to another.
	</div><div class="para">
		You can modify a security group by deleting or adding any number of ingress and egress rules. When you do, the new rules apply to all VMs in the group, whether running or stopped.
	</div><div class="para">
		If no ingress rules are specified, then no traffic will be allowed in, except for responses to any traffic that has been allowed out through an egress rule.
	</div></div><div xml:lang="en-US" class="section" id="add-security-group" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-security-group">15.7.2. Adding a Security Group</h3></div></div></div><div class="para">
		A user or administrator can define a new security group.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network
			</div></li><li class="listitem"><div class="para">
				In Select view, choose Security Groups.
			</div></li><li class="listitem"><div class="para">
				Click Add Security Group.
			</div></li><li class="listitem"><div class="para">
				Provide a name and description.
			</div></li><li class="listitem"><div class="para">
				Click OK.
			</div><div class="para">
				The new security group appears in the Security Groups Details tab.
			</div></li><li class="listitem"><div class="para">
				To make the security group useful, continue to Adding Ingress and Egress Rules to a Security Group.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="enable-security-groups" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="enable-security-groups">15.7.3. Enabling Security Groups</h3></div></div></div><div class="para">
		In order for security groups to function in a zone, the security groups feature must first be enabled for the zone. The administrator can do this when creating a new zone, by selecting a network offering that includes security groups. The procedure is described in Basic Zone Configuration in the Advanced Installation Guide.
	</div></div><div xml:lang="en-US" class="section" id="add-ingress-egress-rules" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-ingress-egress-rules">15.7.4. Adding Ingress and Egress Rules to a Security Group</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network
			</div></li><li class="listitem"><div class="para">
				In Select view, choose Security Groups, then click the security group you want .
			</div></li><li class="listitem"><div class="para">
				To add an ingress rule, click the Ingress Rules tab and fill out the following fields to specify what network traffic is allowed into VM instances in this security group. If no ingress rules are specified, then no traffic will be allowed in, except for responses to any traffic that has been allowed out through an egress rule.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Add by CIDR/Account</strong></span>. Indicate whether the source of the traffic will be defined by IP address (CIDR) or an existing security group in a CloudStack account (Account). Choose Account if you want to allow incoming traffic from all VMs in another security group
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol</strong></span>. The networking protocol that sources will use to send traffic to the security group. TCP and UDP are typically used for data exchange and end-user communications. ICMP is typically used to send error messages or network monitoring data.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start Port, End Port</strong></span>. (TCP, UDP only) A range of listening ports that are the destination for the incoming traffic. If you are opening a single port, use the same number in both fields.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ICMP Type, ICMP Code</strong></span>. (ICMP only) The type of message and error code that will be accepted.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CIDR</strong></span>. (Add by CIDR only) To accept only traffic from IP addresses within a particular address block, enter a CIDR or a comma-separated list of CIDRs. The CIDR is the base IP address of the incoming traffic. For example, 192.168.0.0/22. To allow all CIDRs, set to 0.0.0.0/0.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Account, Security Group</strong></span>. (Add by Account only) To accept only traffic from another security group, enter the CloudStack account and name of a security group that has already been defined in that account. To allow traffic between VMs within the security group you are editing now, enter the same name you used in step 7.
					</div></li></ul></div><div class="para">
				The following example allows inbound HTTP access from anywhere:
			</div><div class="mediaobject"><img src="./images/http-access.png" width="444" alt="httpaccess.png: allows inbound HTTP access from anywhere" /></div></li><li class="listitem"><div class="para">
				To add an egress rule, click the Egress Rules tab and fill out the following fields to specify what type of traffic is allowed to be sent out of VM instances in this security group. If no egress rules are specified, then all traffic will be allowed out. Once egress rules are specified, the following types of traffic are allowed out: traffic specified in egress rules; queries to DNS and DHCP servers; and responses to any traffic that has been allowed in through an ingress rule
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Add by CIDR/Account</strong></span>. Indicate whether the destination of the traffic will be defined by IP address (CIDR) or an existing security group in a CloudStack account (Account). Choose Account if you want to allow outgoing traffic to all VMs in another security group.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol</strong></span>. The networking protocol that VMs will use to send outgoing traffic. TCP and UDP are typically used for data exchange and end-user communications. ICMP is typically used to send error messages or network monitoring data.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start Port, End Port</strong></span>. (TCP, UDP only) A range of listening ports that are the destination for the outgoing traffic. If you are opening a single port, use the same number in both fields.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ICMP Type, ICMP Code</strong></span>. (ICMP only) The type of message and error code that will be sent
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CIDR</strong></span>. (Add by CIDR only) To send traffic only to IP addresses within a particular address block, enter a CIDR or a comma-separated list of CIDRs. The CIDR is the base IP address of the destination. For example, 192.168.0.0/22. To allow all CIDRs, set to 0.0.0.0/0.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Account, Security Group</strong></span>. (Add by Account only) To allow traffic to be sent to another security group, enter the CloudStack account and name of a security group that has already been defined in that account. To allow traffic between VMs within the security group you are editing now, enter its name.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click Add.
			</div></li></ol></div></div></div><div xml:lang="en-US" class="section" id="external-firewalls-and-load-balancers" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="external-firewalls-and-load-balancers">15.8. External Firewalls and Load Balancers</h2></div></div></div><div class="para">
		CloudStack is capable of replacing its Virtual Router with an external Juniper SRX device and an optional external NetScaler or F5 load balancer for gateway and load balancing services. In this case, the VMs use the SRX as their gateway.
	</div></div><div xml:lang="en-US" class="section" id="load-balancer-rules" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="load-balancer-rules">15.9. Load Balancer Rules</h2></div></div></div><div class="para">
		A CloudStack user or administrator may create load balancing rules that balance traffic received at a public IP to one or more VMs. A user creates a rule, specifies an algorithm, and assigns the rule to a set of VMs.
	</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			If you create load balancing rules while using a network service offering that includes an external load balancer device such as NetScaler, and later change the network service offering to one that uses the CloudStack virtual router, you must create a firewall rule on the virtual router for each of your existing load balancing rules so that they continue to function.
		</div></div></div></div><div xml:lang="en-US" class="section" id="guest-ip-ranges" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="guest-ip-ranges">15.10. Guest IP Ranges</h2></div></div></div><div class="para">
		The IP ranges for guest network traffic are set on a per-account basis by the user. This allows the users to configure their network in a fashion that will enable VPN linking between their guest network and their clients.
	</div></div><div xml:lang="en-US" class="section" id="acquire-new-ip-address" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="acquire-new-ip-address">15.11. Acquiring a New IP Address</h2></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				Click the name of the network where you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click View IP Addresses.
			</div></li><li class="listitem"><div class="para">
				Click Acquire New IP, and click Yes in the confirmation dialog.
			</div><div class="para">
				You are prompted for confirmation because, typically, IP addresses are a limited resource. Within a few moments, the new IP address should appear with the state Allocated. You can now use the IP address in port forwarding or static NAT rules.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="release-ip-address" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="release-ip-address">15.12. Releasing an IP Address</h2></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudPlatform UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				Click the name of the network where you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click View IP Addresses.
			</div></li><li class="listitem"><div class="para">
				Click the IP address you want to release.
			</div></li><li class="listitem"><div class="para">
				Click the Release IP button 
				<span class="inlinemediaobject"><img src="./images/release-ip-icon.png" alt="ReleaseIPButton.png: button to release an IP" /></span>
				.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="static-nat" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="static-nat">15.13. Static NAT</h2></div></div></div><div class="para">
		A static NAT rule maps a public IP address to the private IP address of a VM in order to allow Internet traffic into the VM. The public IP address always remains the same, which is why it is called "static" NAT. This section tells how to enable or disable static NAT for a particular IP address.
	</div></div><div xml:lang="en-US" class="section" id="ip-forwarding-firewalling" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="ip-forwarding-firewalling">15.14. IP Forwarding and Firewalling</h2></div></div></div><div class="para">
		By default, all incoming traffic to the public IP address is rejected. All outgoing traffic from the guests is translated via NAT to the public IP address and is allowed.
	</div><div class="para">
		To allow incoming traffic, users may set up firewall rules and/or port forwarding rules. For example, you can use a firewall rule to open a range of ports on the public IP address, such as 33 through 44. Then use port forwarding rules to direct traffic from individual ports within that range to specific ports on user VMs. For example, one port forwarding rule could route incoming traffic on the public IP's port 33 to port 100 on one user VM's private IP.
	</div><div class="para">
		For the steps to implement these rules, see Firewall Rules and Port Forwarding.
	</div></div><div xml:lang="en-US" class="section" id="ip-load-balancing" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="ip-load-balancing">15.15. IP Load Balancing</h2></div></div></div><div class="para">
		The user may choose to associate the same public IP for multiple guests. CloudStack implements a TCP-level load balancer with the following policies.
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Round-robin
			</div></li><li class="listitem"><div class="para">
				Least connection
			</div></li><li class="listitem"><div class="para">
				Source IP
			</div></li></ul></div><div class="para">
		This is similar to port forwarding but the destination may be multiple IP addresses.
	</div></div><div xml:lang="en-US" class="section" id="dns-dhcp" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="dns-dhcp">15.16. DNS and DHCP</h2></div></div></div><div class="para">
		The Virtual Router provides DNS and DHCP services to the guests. It proxies DNS requests to the DNS server configured on the Availability Zone.
	</div></div><div xml:lang="en-US" class="section" id="vpn" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="vpn">15.17. VPN</h2></div></div></div><div class="para">
		CloudStack account owners can create virtual private networks (VPN) to access their virtual machines. If the guest network is instantiated from a network offering that offers the Remote Access VPN service, the virtual router (based on the System VM) is used to provide the service. CloudStack provides a L2TP-over-IPsec-based remote access VPN service to guest virtual networks. Since each network gets its own virtual router, VPNs are not shared across the networks. VPN clients native to Windows, Mac OS X and iOS can be used to connect to the guest networks. The account owner can create and manage users for their VPN. CloudStack does not use its account database for this purpose but uses a separate table. The VPN user database is shared across all the VPNs created by the account owner. All VPN users get access to all VPNs created by the account owner.
	</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			Make sure that not all traffic goes through the VPN. That is, the route installed by the VPN should be only for the guest network and not for all traffic.
		</div></div></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Road Warrior / Remote Access</strong></span>. Users want to be able to connect securely from a home or office to a private network in the cloud. Typically, the IP address of the connecting client is dynamic and cannot be preconfigured on the VPN server.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Site to Site</strong></span>. In this scenario, two private subnets are connected over the public Internet with a secure VPN tunnel. The cloud user’s subnet (for example, an office network) is connected through a gateway to the network in the cloud. The address of the user’s gateway must be preconfigured on the VPN server in the cloud. Note that although L2TP-over-IPsec can be used to set up Site-to-Site VPNs, this is not the primary intent of this feature.
			</div></li></ul></div><div xml:lang="en-US" class="section" id="configure-vpn" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="configure-vpn">15.17.1. Configuring VPN</h3></div></div></div><div class="para">
		To set up VPN for the cloud:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Global Settings.
			</div></li><li class="listitem"><div class="para">
				Set the following global configuration parameters.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						remote.access.vpn.client.ip.range – The range of IP addressess to be allocated to remote access VPN clients. The first IP in the range is used by the VPN server.
					</div></li><li class="listitem"><div class="para">
						remote.access.vpn.psk.length – Length of the IPSec key.
					</div></li><li class="listitem"><div class="para">
						remote.access.vpn.user.limit – Maximum number of VPN users per account.
					</div></li></ul></div></li></ol></div><div class="para">
		To enable VPN for a particular network:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in as a user or administrator to the CloudStack UI.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, click Network.
			</div></li><li class="listitem"><div class="para">
				Click the name of the network you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click View IP Addresses.
			</div></li><li class="listitem"><div class="para">
				Click one of the displayed IP address names.
			</div></li><li class="listitem"><div class="para">
				Click the Enable VPN button 
				<span class="inlinemediaobject"><img src="./images/vpn-icon.png" alt="AttachDiskButton.png: button to attach a volume" /></span>
				.
			</div><div class="para">
				The IPsec key is displayed in a popup window.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="using-vpn-with-windows" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="using-vpn-with-windows">15.17.2. Using VPN with Windows</h3></div></div></div><div class="para">
		The procedure to use VPN varies by Windows version. Generally, the user must edit the VPN properties and make sure that the default route is not the VPN. The following steps are for Windows L2TP clients on Windows Vista. The commands should be similar for other Windows versions.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI and click on the source NAT IP for the account. The VPN tab should display the IPsec preshared key. Make a note of this and the source NAT IP. The UI also lists one or more users and their passwords. Choose one of these users, or, if none exists, add a user and password.
			</div></li><li class="listitem"><div class="para">
				On the Windows box, go to Control Panel, then select Network and Sharing center. Click Setup a connection or network.
			</div></li><li class="listitem"><div class="para">
				In the next dialog, select No, create a new connection.
			</div></li><li class="listitem"><div class="para">
				In the next dialog, select Use my Internet Connection (VPN).
			</div></li><li class="listitem"><div class="para">
				In the next dialog, enter the source NAT IP from step 1 and give the connection a name. Check Don't connect now.
			</div></li><li class="listitem"><div class="para">
				In the next dialog, enter the user name and password selected in step 1.
			</div></li><li class="listitem"><div class="para">
				Click Create.
			</div></li><li class="listitem"><div class="para">
				Go back to the Control Panel and click Network Connections to see the new connection. The connection is not active yet.
			</div></li><li class="listitem"><div class="para">
				Right-click the new connection and select Properties. In the Properties dialog, select the Networking tab.
			</div></li><li class="listitem"><div class="para">
				In Type of VPN, choose L2TP IPsec VPN, then click IPsec settings. Select Use preshared key. Enter the preshared key from Step 1.
			</div></li><li class="listitem"><div class="para">
				The connection is ready for activation. Go back to Control Panel -&gt; Network Connections and double-click the created connection.
			</div></li><li class="listitem"><div class="para">
				Enter the user name and password from Step 1.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="using-vpn-with-mac" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="using-vpn-with-mac">15.17.3. Using VPN with Mac OS X</h3></div></div></div><div class="para">
		In Mac OS X, in Network Preferences - Advanced, make sure Send all traffic over VPN connection is not checked.
	</div></div><div xml:lang="en-US" class="section" id="site-to-site-vpn" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="site-to-site-vpn">15.17.4. Setting Up a Site-to-Site VPN Connection</h3></div></div></div><div class="para">
		A Site-to-Site VPN connection helps you establish a secure connection from an enterprise datacenter to the cloud infrastructure. This allows users to access the guest VMs by establishing a VPN connection to the virtual router of the account from a device in the datacenter of the enterprise. Having this facility eliminates the need to establish VPN connections to individual VMs.
	</div><div class="para">
		The supported endpoints on the remote datacenters are:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Cisco ISR with IOS 12.4 or later
			</div></li><li class="listitem"><div class="para">
				Juniper J-Series routers with JunOS 9.5 or later
			</div></li></ul></div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			In addition to the specific Cisco and Juniper devices listed above, the expectation is that any Cisco or Juniper device running on the supported operating systems are able to establish VPN connections.
		</div></div></div><div class="para">
		To set up a Site-to-Site VPN connection, perform the following:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Create a Virtual Private Cloud (VPC).
			</div><div class="para">
				See <a class="xref" href="#configure-vpc">Section 15.19, “Configuring a Virtual Private Cloud”</a>.
			</div></li><li class="listitem"><div class="para">
				Create a VPN Customer Gateway.
			</div></li><li class="listitem"><div class="para">
				Create a VPN gateway for the VPC that you created.
			</div></li><li class="listitem"><div class="para">
				Create VPN connection from the VPC VPN gateway to the customer VPN gateway.
			</div></li></ol></div><div xml:lang="en-US" class="section" id="create-vpn-customer-gateway" lang="en-US"><div class="titlepage"><div><div><h4 class="title" id="create-vpn-customer-gateway">15.17.4.1. Creating and Updating a VPN Customer Gateway</h4></div></div></div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			A VPN customer gateway can be connected to only one VPN gateway at a time.
		</div></div></div><div class="para">
		To add a VPN Customer Gateway:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPN Customer Gateway.
			</div></li><li class="listitem"><div class="para">
				Click Add site-to-site VPN.
			</div><div class="mediaobject"><img src="./images/add-vpn-customer-gateway.png" alt="addvpncustomergateway.png: adding a customer gateway." /></div><div class="para">
				Provide the following information:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: A unique name for the VPN customer gateway you create.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Gateway</strong></span>: The IP address for the remote gateway.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CIDR list</strong></span>: The guest CIDR list of the remote subnets. Enter a CIDR or a comma-separated list of CIDRs. Ensure that a guest CIDR list is not overlapped with the VPC’s CIDR, or another guest CIDR. The CIDR must be RFC1918-compliant.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IPsec Preshared Key</strong></span>: Preshared keying is a method where the endpoints of the VPN share a secret key. This key value is used to authenticate the customer gateway and the VPC VPN gateway to each other.
					</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
							The IKE peers (VPN end points) authenticate each other by computing and sending a keyed hash of data that includes the Preshared key. If the receiving peer is able to create the same hash independently by using its Preshared key, it knows that both peers must share the same secret, thus authenticating the customer gateway.
						</div></div></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IKE Encryption</strong></span>: The Internet Key Exchange (IKE) policy for phase-1. The supported encryption algorithms are AES128, AES192, AES256, and 3DES. Authentication is accomplished through the Preshared Keys.
					</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
							The phase-1 is the first phase in the IKE process. In this initial negotiation phase, the two VPN endpoints agree on the methods to be used to provide security for the underlying IP traffic. The phase-1 authenticates the two VPN gateways to each other, by confirming that the remote gateway has a matching Preshared Key.
						</div></div></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IKE Hash</strong></span>: The IKE hash for phase-1. The supported hash algorithms are SHA1 and MD5.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IKE DH</strong></span>: A public-key cryptography protocol which allows two parties to establish a shared secret over an insecure communications channel. The 1536-bit Diffie-Hellman group is used within IKE to establish session keys. The supported options are None, Group-5 (1536-bit) and Group-2 (1024-bit).
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ESP Encryption</strong></span>: Encapsulating Security Payload (ESP) algorithm within phase-2. The supported encryption algorithms are AES128, AES192, AES256, and 3DES.
					</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
							The phase-2 is the second phase in the IKE process. The purpose of IKE phase-2 is to negotiate IPSec security associations (SA) to set up the IPSec tunnel. In phase-2, new keying material is extracted from the Diffie-Hellman key exchange in phase-1, to provide session keys to use in protecting the VPN data flow.
						</div></div></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ESP Hash</strong></span>: Encapsulating Security Payload (ESP) hash for phase-2. Supported hash algorithms are SHA1 and MD5.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Perfect Forward Secrecy</strong></span>: Perfect Forward Secrecy (or PFS) is the property that ensures that a session key derived from a set of long-term public and private keys will not be compromised. This property enforces a new Diffie-Hellman key exchange. It provides the keying material that has greater key material life and thereby greater resistance to cryptographic attacks. The available options are None, Group-5 (1536-bit) and Group-2 (1024-bit). The security of the key exchanges increase as the DH groups grow larger, as does the time of the exchanges.
					</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
							When PFS is turned on, for every negotiation of a new phase-2 SA the two gateways must generate a new set of phase-1 keys. This adds an extra layer of protection that PFS adds, which ensures if the phase-2 SA’s have expired, the keys used for new phase-2 SA’s have not been generated from the current phase-1 keying material.
						</div></div></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IKE Lifetime (seconds)</strong></span>: The phase-1 lifetime of the security association in seconds. Default is 86400 seconds (1 day). Whenever the time expires, a new phase-1 exchange is performed.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ESP Lifetime (seconds)</strong></span>: The phase-2 lifetime of the security association in seconds. Default is 3600 seconds (1 hour). Whenever the value is exceeded, a re-key is initiated to provide a new IPsec encryption and authentication session keys.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Dead Peer Detection</strong></span>: A method to detect an unavailable Internet Key Exchange (IKE) peer. Select this option if you want the virtual router to query the liveliness of its IKE peer at regular intervals. It’s recommended to have the same configuration of DPD on both side of VPN connection.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click OK.
			</div></li></ol></div><div class="formalpara"><h5 class="formalpara" id="idp13096056">Updating and Removing a VPN Customer Gateway</h5>
			You can update a customer gateway either with no VPN connection, or related VPN connection is in error state.
		</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPN Customer Gateway.
			</div></li><li class="listitem"><div class="para">
				Select the VPN customer gateway you want to work with.
			</div></li><li class="listitem"><div class="para">
				To modify the required parameters, click the Edit VPN Customer Gateway button
				<span class="inlinemediaobject"><img src="./images/edit-icon.png" alt="edit.png: button to edit a VPN customer gateway" /></span>
			</div></li><li class="listitem"><div class="para">
				To remove the VPN customer gateway, click the Delete VPN Customer Gateway button
				<span class="inlinemediaobject"><img src="./images/delete-button.png" alt="delete.png: button to remove a VPN customer gateway" /></span>
			</div></li><li class="listitem"><div class="para">
				Click OK.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="create-vpn-gateway-for-vpc" lang="en-US"><div class="titlepage"><div><div><h4 class="title" id="create-vpn-gateway-for-vpc">15.17.4.2. Creating a VPN gateway for the VPC</h4></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select Site-to-Site VPN.
			</div><div class="para">
				If you are creating the VPN gateway for the first time, selecting Site-to-Site VPN prompts you to create a VPN gateway.
			</div></li><li class="listitem"><div class="para">
				In the confirmation dialog, click Yes to confirm.
			</div><div class="para">
				Within a few moments, the VPN gateway is created. You will be prompted to view the details of the VPN gateway you have created. Click Yes to confirm.
			</div><div class="para">
				The following details are displayed in the VPN Gateway page:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Address
					</div></li><li class="listitem"><div class="para">
						Account
					</div></li><li class="listitem"><div class="para">
						Domain
					</div></li></ul></div></li></ol></div></div><div xml:lang="en-US" class="section" id="create-vpn-connection-vpc" lang="en-US"><div class="titlepage"><div><div><h4 class="title" id="create-vpn-connection-vpc">15.17.4.3. Creating a VPN Connection</h4></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you create for the account are listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ASLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select Site-to-Site VPN.
			</div><div class="para">
				The Site-to-Site VPN page is displayed.
			</div></li><li class="listitem"><div class="para">
				From the Select View drop-down, ensure that VPN Connection is selected.
			</div></li><li class="listitem"><div class="para">
				Click Create VPN Connection.
			</div><div class="para">
				The Create VPN Connection dialog is displayed:
			</div><div class="mediaobject"><img src="./images/create-vpn-connection.png" alt="createvpnconnection.png: creating a vpn connection to the customer gateway." /></div></li><li class="listitem"><div class="para">
				Select the desired customer gateway, then click OK to confirm.
			</div><div class="para">
				Within a few moments, the VPN Connection is displayed.
			</div><div class="para">
				The following information on the VPN connection is displayed:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Address
					</div></li><li class="listitem"><div class="para">
						Gateway
					</div></li><li class="listitem"><div class="para">
						State
					</div></li><li class="listitem"><div class="para">
						IPSec Preshared Key
					</div></li><li class="listitem"><div class="para">
						IKE Policy
					</div></li><li class="listitem"><div class="para">
						ESP Policy
					</div></li></ul></div></li></ol></div></div><div xml:lang="en-US" class="section" id="delete-reset-vpn" lang="en-US"><div class="titlepage"><div><div><h4 class="title" id="delete-reset-vpn">15.17.4.4. Restarting and Removing a VPN Connection</h4></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ASLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select Site-to-Site VPN.
			</div><div class="para">
				The Site-to-Site VPN page is displayed.
			</div></li><li class="listitem"><div class="para">
				From the Select View drop-down, ensure that VPN Connection is selected.
			</div><div class="para">
				All the VPN connections you created are displayed.
			</div></li><li class="listitem"><div class="para">
				Select the VPN connection you want to work with.
			</div><div class="para">
				The Details tab is displayed.
			</div></li><li class="listitem"><div class="para">
				To remove a VPN connection, click the Delete VPN connection button
				<span class="inlinemediaobject"><img src="./images/remove-vpn.png" alt="remove-vpn.png: button to remove a VPN connection" /></span>
			</div><div class="para">
				To restart a VPN connection, click the Reset VPN connection button present in the Details tab.
				<span class="inlinemediaobject"><img src="./images/reset-vpn.png" alt="reset-vpn.png: button to reset a VPN connection" /></span>
			</div></li></ol></div></div></div></div><div xml:lang="en-US" class="section" id="inter-vlan-routing" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="inter-vlan-routing">15.18. About Inter-VLAN Routing</h2></div></div></div><div class="para">
		Inter-VLAN Routing is the capability to route network traffic between VLANs. This feature enables you to build Virtual Private Clouds (VPC), an isolated segment of your cloud, that can hold multi-tier applications. These tiers are deployed on different VLANs that can communicate with each other. You provision VLANs to the tiers your create, and VMs can be deployed on different tiers. The VLANs are connected to a virtual router, which facilitates communication between the VMs. In effect, you can segment VMs by means of VLANs into different networks that can host multi-tier applications, such as Web, Application, or Database. Such segmentation by means of VLANs logically separate application VMs for higher security and lower broadcasts, while remaining physically connected to the same device.
	</div><div class="para">
		This feature is supported on XenServer and VMware hypervisors.
	</div><div class="para">
		The major advantages are:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				The administrator can deploy a set of VLANs and allow users to deploy VMs on these VLANs. A guest VLAN is randomly alloted to an account from a pre-specified set of guest VLANs. All the VMs of a certain tier of an account reside on the guest VLAN allotted to that account.
			</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					A VLAN allocated for an account cannot be shared between multiple accounts.
				</div></div></div></li><li class="listitem"><div class="para">
				The administrator can allow users create their own VPC and deploy the application. In this scenario, the VMs that belong to the account are deployed on the VLANs allotted to that account.
			</div></li><li class="listitem"><div class="para">
				Both administrators and users can create multiple VPCs. The guest network NIC is plugged to the VPC virtual router when the first VM is deployed in a tier.
			</div></li><li class="listitem"><div class="para">
				The administrator can create the following gateways to send to or receive traffic from the VMs:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VPN Gateway</strong></span>: For more information, see <a class="xref" href="#create-vpn-gateway-for-vpc">Section 15.17.4.2, “Creating a VPN gateway for the VPC”</a>.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public Gateway</strong></span>: The public gateway for a VPC is added to the virtual router when the virtual router is created for VPC. The public gateway is not exposed to the end users. You are not allowed to list it, nor allowed to create any static routes.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Private Gateway</strong></span>: For more information, see <a class="xref" href="#add-gateway-vpc">Section 15.19.5, “Adding a Private Gateway to a VPC”</a>.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Both administrators and users can create various possible destinations-gateway combinations. However, only one gateway of each type can be used in a deployment.
			</div><div class="para">
				For example:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VLANs and Public Gateway</strong></span>: For example, an application is deployed in the cloud, and the Web application VMs communicate with the Internet.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VLANs, VPN Gateway, and Public Gateway</strong></span>: For example, an application is deployed in the cloud; the Web application VMs communicate with the Internet; and the database VMs communicate with the on-premise devices.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				The administrator can define Access Control List (ACL) on the virtual router to filter the traffic among the VLANs or between the Internet and a VLAN. You can define ACL based on CIDR, port range, protocol, type code (if ICMP protocol is selected) and Ingress/Egress type.
			</div></li></ul></div><div class="para">
		The following figure shows the possible deployment scenarios of a Inter-VLAN setup:
	</div><div class="mediaobject"><img src="./images/multi-tier-app.png" width="444" alt="mutltier.png: a multi-tier setup." /></div><div class="para">
		To set up a multi-tier Inter-VLAN deployment, see <a class="xref" href="#configure-vpc">Section 15.19, “Configuring a Virtual Private Cloud”</a>.
	</div></div><div xml:lang="en-US" class="section" id="configure-vpc" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="configure-vpc">15.19. Configuring a Virtual Private Cloud</h2></div></div></div><div xml:lang="en-US" class="section" id="vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="vpc">15.19.1. About Virtual Private Clouds</h3></div></div></div><div class="para">
		CloudStack Virtual Private Cloud is a private, isolated part of CloudStack. A VPC can have its own virtual network topology that resembles a traditional physical network. You can launch VMs in the virtual network that can have private addresses in the range of your choice, for example: 10.0.0.0/16. You can define network tiers within your VPC network range, which in turn enables you to group similar kinds of instances based on IP address range.
	</div><div class="para">
		For example, if a VPC has the private range 10.0.0.0/16, its guest networks can have the network ranges 10.0.1.0/24, 10.0.2.0/24, 10.0.3.0/24, and so on.
	</div><div class="formalpara"><h5 class="formalpara" id="idm1348432">Major Components of a VPC:</h5>
			A VPC is comprised of the following network components:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				<span class="bold bold"><strong>VPC</strong></span>: A VPC acts as a container for multiple isolated networks that can communicate with each other via its virtual router.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Network Tiers</strong></span>: Each tier acts as an isolated network with its own VLANs and CIDR list, where you can place groups of resources, such as VMs. The tiers are segmented by means of VLANs. The NIC of each tier acts as its gateway.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Virtual Router</strong></span>: A virtual router is automatically created and started when you create a VPC. The virtual router connect the tiers and direct traffic among the public gateway, the VPN gateways, and the NAT instances. For each tier, a corresponding NIC and IP exist in the virtual router. The virtual router provides DNS and DHCP services through its IP.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Public Gateway</strong></span>: The traffic to and from the Internet routed to the VPC through the public gateway. In a VPC, the public gateway is not exposed to the end user; therefore, static routes are not support for the public gateway.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Private Gateway</strong></span>: All the traffic to and from a private network routed to the VPC through the private gateway. For more information, see <a class="xref" href="#add-gateway-vpc">Section 15.19.5, “Adding a Private Gateway to a VPC”</a>.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>VPN Gateway</strong></span>: The VPC side of a VPN connection.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Site-to-Site VPN Connection</strong></span>: A hardware-based VPN connection between your VPC and your datacenter, home network, or co-location facility. For more information, see <a class="xref" href="#site-to-site-vpn">Section 15.17.4, “Setting Up a Site-to-Site VPN Connection”</a>.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Customer Gateway</strong></span>: The customer side of a VPN Connection. For more information, see <a class="xref" href="#create-vpn-customer-gateway">Section 15.17.4.1, “Creating and Updating a VPN Customer Gateway”</a>.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>NAT Instance</strong></span>: An instance that provides Port Address Translation for instances to access the Internet via the public gateway. For more information, see <a class="xref" href="#enable-disable-static-nat-vpc">Section 15.19.9, “Enabling or Disabling Static NAT on a VPC”</a>.
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idm2142440">Network Architecture in a VPC</h5>
			In a VPC, the following four basic options of network architectures are present:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				VPC with a public gateway only
			</div></li><li class="listitem"><div class="para">
				VPC with public and private gateways
			</div></li><li class="listitem"><div class="para">
				VPC with public and private gateways and site-to-site VPN access
			</div></li><li class="listitem"><div class="para">
				VPC with a private gateway only and site-to-site VPN access
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idm636680">Connectivity Options for a VPC</h5>
			You can connect your VPC to:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				The Internet through the public gateway.
			</div></li><li class="listitem"><div class="para">
				The corporate datacenter by using a site-to-site VPN connection through the VPN gateway.
			</div></li><li class="listitem"><div class="para">
				Both the Internet and your corporate datacenter by using both the public gateway and a VPN gateway.
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idp522808">VPC Network Considerations</h5>
			Consider the following before you create a VPC:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				A VPC, by default, is created in the enabled state.
			</div></li><li class="listitem"><div class="para">
				A VPC can be created in Advance zone only, and can't belong to more than one zone at a time.
			</div></li><li class="listitem"><div class="para">
				The default number of VPCs an account can create is 20. However, you can change it by using the max.account.vpcs global parameter, which controls the maximum number of VPCs an account is allowed to create.
			</div></li><li class="listitem"><div class="para">
				The default number of tiers an account can create within a VPC is 3. You can configure this number by using the vpc.max.networks parameter.
			</div></li><li class="listitem"><div class="para">
				Each tier should have an unique CIDR in the VPC. Ensure that the tier's CIDR should be within the VPC CIDR range.
			</div></li><li class="listitem"><div class="para">
				A tier belongs to only one VPC.
			</div></li><li class="listitem"><div class="para">
				All network tiers inside the VPC should belong to the same account.
			</div></li><li class="listitem"><div class="para">
				When a VPC is created, by default, a SourceNAT IP is allocated to it. The Source NAT IP is released only when the VPC is removed.
			</div></li><li class="listitem"><div class="para">
				A public IP can be used for only one purpose at a time. If the IP is a sourceNAT, it cannot be used for StaticNAT or port forwarding.
			</div></li><li class="listitem"><div class="para">
				The instances only have a private IP address that you provision. To communicate with the Internet, enable NAT to an instance that you launch in your VPC.
			</div></li><li class="listitem"><div class="para">
				Only new networks can be added to a VPC. The maximum number of networks per VPC is limited by the value you specify in the vpc.max.networks parameter. The default value is three.
			</div></li><li class="listitem"><div class="para">
				The load balancing service can be supported by only one tier inside the VPC.
			</div></li><li class="listitem"><div class="para">
				If an IP address is assigned to a tier:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						That IP can't be used by more than one tier at a time in the VPC. For example, if you have tiers A and B, and a public IP1, you can create a port forwarding rule by using the IP either for A or B, but not for both.
					</div></li><li class="listitem"><div class="para">
						That IP can't be used for StaticNAT, load balancing, or port forwarding rules for another guest network inside the VPC.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Remote access VPN is not supported in VPC networks.
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="add-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-vpc">15.19.2. Adding a Virtual Private Cloud</h3></div></div></div><div class="para">
		When creating the VPC, you simply provide the zone and a set of IP addresses for the VPC network address space. You specify this set of addresses in the form of a Classless Inter-Domain Routing (CIDR) block.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div></li><li class="listitem"><div class="para">
				Click Add VPC. The Add VPC page is displayed as follows:
			</div><div class="mediaobject"><img src="./images/add-vpc.png" alt="add-vpc.png: adding a vpc." /></div><div class="para">
				Provide the following information:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: A short name for the VPC that you are creating.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Description</strong></span>: A brief description of the VPC.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Zone</strong></span>: Choose the zone where you want the VPC to be available.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Super CIDR for Guest Networks</strong></span>: Defines the CIDR range for all the tiers (guest networks) within a VPC. When you create a tier, ensure that its CIDR is within the Super CIDR value you enter. The CIDR must be RFC1918 compliant.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>DNS domain for Guest Networks</strong></span>: If you want to assign a special domain name, specify the DNS suffix. This parameter is applied to all the tiers within the VPC. That implies, all the tiers you create in the VPC belong to the same DNS domain. If the parameter is not specified, a DNS domain name is generated automatically.
					</div></li></ul></div></li></ol></div></div><div xml:lang="en-US" class="section" id="add-tier" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-tier">15.19.3. Adding Tiers</h3></div></div></div><div class="para">
		Tiers are distinct locations within a VPC that act as isolated networks, which do not have access to other tiers by default. Tiers are set up on different VLANs that can communicate with each other by using a virtual router. Tiers provide inexpensive, low latency network connectivity to other tiers within the VPC.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPC that you have created for the account is listed in the page.
			</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					The end users can see their own VPCs, while root and domain admin can see any VPC they are authorized to see.
				</div></div></div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC for which you want to set up tiers.
			</div><div class="para">
				The Add new tier dialog is displayed, as follows:
			</div><div class="mediaobject"><img src="./images/add-tier.png" alt="add-tier.png: adding a tier to a vpc." /></div><div class="para">
				If you have already created tiers, the VPC diagram is displayed. Click Create Tier to add a new tier.
			</div></li><li class="listitem"><div class="para">
				Specify the following:
			</div><div class="para">
				All the fields are mandatory.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: A unique name for the tier you create.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Network Offering</strong></span>: The following default network offerings are listed: DefaultIsolatedNetworkOfferingForVpcNetworksNoLB, DefaultIsolatedNetworkOfferingForVpcNetworks
					</div><div class="para">
						In a VPC, only one tier can be created by using LB-enabled network offering.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Gateway</strong></span>: The gateway for the tier you create. Ensure that the gateway is within the Super CIDR range that you specified while creating the VPC, and is not overlapped with the CIDR of any existing tier within the VPC.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Netmask</strong></span>: The netmask for the tier you create.
					</div><div class="para">
						For example, if the VPC CIDR is 10.0.0.0/16 and the network tier CIDR is 10.0.1.0/24, the gateway of the tier is 10.0.1.1, and the netmask of the tier is 255.255.255.0.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click OK.
			</div></li><li class="listitem"><div class="para">
				Continue with configuring access control list for the tier.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="configure-acl" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="configure-acl">15.19.4. Configuring Access Control List</h3></div></div></div><div class="para">
		Define Network Access Control List (ACL) on the VPC virtual router to control incoming (ingress) and outgoing (egress) traffic between the VPC tiers, and the tiers and Internet. By default, all incoming and outgoing traffic to the guest networks is blocked. To open the ports, you must create a new network ACL. The network ACLs can be created for the tiers only if the NetworkACL service is supported.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select Network ACLs.
			</div><div class="para">
				The Network ACLs page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click Add Network ACLs.
			</div><div class="para">
				To add an ACL rule, fill in the following fields to specify what kind of network traffic is allowed in this tier.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CIDR</strong></span>: The CIDR acts as the Source CIDR for the Ingress rules, and Destination CIDR for the Egress rules. To accept traffic only from or to the IP addresses within a particular address block, enter a CIDR or a comma-separated list of CIDRs. The CIDR is the base IP address of the incoming traffic. For example, 192.168.0.0/22. To allow all CIDRs, set to 0.0.0.0/0.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol</strong></span>: The networking protocol that sources use to send traffic to the tier. The TCP and UDP protocols are typically used for data exchange and end-user communications. The ICMP protocol is typically used to send error messages or network monitoring data.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start Port</strong></span>, <span class="bold bold"><strong>End Port</strong></span> (TCP, UDP only): A range of listening ports that are the destination for the incoming traffic. If you are opening a single port, use the same number in both fields.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Select Tier</strong></span>: Select the tier for which you want to add this ACL rule.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ICMP Type</strong></span>, <span class="bold bold"><strong>ICMP Code</strong></span> (ICMP only): The type of message and error code that will be sent.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Traffic Type</strong></span>: Select the traffic type you want to apply.
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								<span class="bold bold"><strong>Egress</strong></span>: To add an egress rule, select Egress from the Traffic type drop-down box and click Add. This specifies what type of traffic is allowed to be sent out of VM instances in this tier. If no egress rules are specified, all traffic from the tier is allowed out at the VPC virtual router. Once egress rules are specified, only the traffic specified in egress rules and the responses to any traffic that has been allowed in through an ingress rule are allowed out. No egress rule is required for the VMs in a tier to communicate with each other.
							</div></li><li class="listitem"><div class="para">
								<span class="bold bold"><strong>Ingress</strong></span>: To add an ingress rule, select Ingress from the Traffic type drop-down box and click Add. This specifies what network traffic is allowed into the VM instances in this tier. If no ingress rules are specified, then no traffic will be allowed in, except for responses to any traffic that has been allowed out through an egress rule.
							</div></li></ul></div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
							By default, all incoming and outgoing traffic to the guest networks is blocked. To open the ports, create a new network ACL.
						</div></div></div></li></ul></div></li><li class="listitem"><div class="para">
				Click Add. The ACL rule is added.
			</div><div class="para">
				To view the list of ACL rules you have added, click the desired tier from the Network ACLs page, then select the Network ACL tab.
			</div><div class="mediaobject"><img src="./images/network-acl.png" width="444" alt="network-acl.png: adding, editing, deleting an ACL rule." /></div><div class="para">
				You can edit the tags assigned to the ACL rules and delete the ACL rules you have created. Click the appropriate button in the Actions column.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="add-gateway-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-gateway-vpc">15.19.5. Adding a Private Gateway to a VPC</h3></div></div></div><div class="para">
		A private gateway can be added by the root admin only. The VPC private network has 1:1 relationship with the NIC of the physical network. No gateways with duplicated VLAN and IP are allowed in the same data center.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to configure load balancing rules.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Private Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select Private Gateways.
			</div><div class="para">
				The Gateways page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click Add new gateway:
			</div><div class="mediaobject"><img src="./images/add-new-gateway-vpc.png" alt="add-new-gateway-vpc.png: adding a private gateway for the VPC." /></div></li><li class="listitem"><div class="para">
				Specify the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Physical Network</strong></span>: The physical network you have created in the zone.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IP Address</strong></span>: The IP address associated with the VPC gateway.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Gateway</strong></span>: The gateway through which the traffic is routed to and from the VPC.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Netmask</strong></span>: The netmask associated with the VPC gateway.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VLAN</strong></span>: The VLAN associated with the VPC gateway.
					</div></li></ul></div><div class="para">
				The new gateway appears in the list. You can repeat these steps to add more gateway for this VPC.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="add-vm-to-tier" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-vm-to-tier">15.19.6. Deploying VMs to the Tier</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed.
			</div></li><li class="listitem"><div class="para">
				Click the Add VM button of the tier for which you want to add a VM.
			</div><div class="para">
				The Add Instance page is displayed.
			</div><div class="para">
				Follow the on-screen instruction to add an instance. For information on adding an instance, see Adding Instances section in the Installation Guide.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="acquire-new-ip-for-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="acquire-new-ip-for-vpc">15.19.7. Acquiring a New IP Address for a VPC</h3></div></div></div><div class="para">
		When you acquire an IP address, all IP addresses are allocated to VPC, not to the guest networks within the VPC. The IPs are associated to the guest network only when the first port-forwarding, load balancing, or Static NAT rule is created for the IP or the network. IP can't be associated to more than one network at a time.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select IP Addresses.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click Acquire New IP, and click Yes in the confirmation dialog.
			</div><div class="para">
				You are prompted for confirmation because, typically, IP addresses are a limited resource. Within a few moments, the new IP address should appear with the state Allocated. You can now use the IP address in port forwarding, load balancing, and static NAT rules.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="release-ip-for-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="release-ip-for-vpc">15.19.8. Releasing an IP Address Alloted to a VPC</h3></div></div></div><div class="para">
		The IP address is a limited resource. If you no longer need a particular IP, you can disassociate it from its VPC and return it to the pool of available addresses. An IP address can be released from its tier, only when all the networking ( port forwarding, load balancing, or StaticNAT ) rules are removed for this IP address. The released IP address will still belongs to the same VPC.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC whose IP you want to release.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select IP Addresses.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click the IP you want to release.
			</div></li><li class="listitem"><div class="para">
				In the Details tab, click the Release IP button 
				<span class="inlinemediaobject"><img src="./images/release-ip-icon.png" alt="release-ip-icon.png: button to release an IP." /></span>
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="enable-disable-static-nat-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="enable-disable-static-nat-vpc">15.19.9. Enabling or Disabling Static NAT on a VPC</h3></div></div></div><div class="para">
		A static NAT rule maps a public IP address to the private IP address of a VM in a VPC to allow Internet traffic to it. This section tells how to enable or disable static NAT for a particular IP address in a VPC.
	</div><div class="para">
		If port forwarding rules are already in effect for an IP address, you cannot enable static NAT to that IP.
	</div><div class="para">
		If a guest VM is part of more than one network, static NAT rules will function only if they are defined on the default network.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select IP Addresses.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click the IP you want to work with.
			</div></li><li class="listitem"><div class="para">
				In the Details tab,click the Static NAT button.
				<span class="inlinemediaobject"><img src="./images/enable-disable.png" alt="enable-disable.png: button to enable Statid NAT." /></span>
				The button toggles between Enable and Disable, depending on whether static NAT is currently enabled for the IP address.
			</div></li><li class="listitem"><div class="para">
				If you are enabling static NAT, a dialog appears as follows:
			</div><div class="mediaobject"><img src="./images/select-vm-staticnat-vpc.png" width="444" alt="select-vmstatic-nat.png: selecting a tier to apply staticNAT." /></div></li><li class="listitem"><div class="para">
				Select the tier and the destination VM, then click Apply.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="add-loadbalancer-rule-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-loadbalancer-rule-vpc">15.19.10. Adding Load Balancing Rules on a VPC</h3></div></div></div><div class="para">
		A CloudStack user or administrator may create load balancing rules that balance traffic received at a public IP to one or more VMs that belong to a network tier that provides load balancing service in a VPC. A user creates a rule, specifies an algorithm, and assigns the rule to a set of VMs within a VPC.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to configure load balancing rules.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select IP Addresses.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click the IP address for which you want to create the rule, then click the Configuration tab.
			</div></li><li class="listitem"><div class="para">
				In the Load Balancing node of the diagram, click View All.
			</div></li><li class="listitem"><div class="para">
				Select the tier to which you want to apply the rule.
			</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					In a VPC, the load balancing service is supported only on a single tier.
				</div></div></div></li><li class="listitem"><div class="para">
				Specify the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: A name for the load balancer rule.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public Port</strong></span>: The port that receives the incoming traffic to be balanced.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Private Port</strong></span>: The port that the VMs will use to receive the traffic.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Algorithm</strong></span>. Choose the load balancing algorithm you want CloudStack to use. CloudStack supports the following well-known algorithms:
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								Round-robin
							</div></li><li class="listitem"><div class="para">
								Least connections
							</div></li><li class="listitem"><div class="para">
								Source
							</div></li></ul></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Stickiness</strong></span>. (Optional) Click Configure and choose the algorithm for the stickiness policy. See Sticky Session Policies for Load Balancer Rules.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Add VMs</strong></span>: Click Add VMs, then select two or more VMs that will divide the load of incoming traffic, and click Apply.
					</div></li></ul></div></li></ol></div><div class="para">
		The new load balancing rule appears in the list. You can repeat these steps to add more load balancing rules for this IP address.
	</div></div><div xml:lang="en-US" class="section" id="add-portforward-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-portforward-vpc">15.19.11. Adding a Port Forwarding Rule on a VPC</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Choose an existing IP address or acquire a new IP address. Click the name of the IP address in the list.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click the IP address for which you want to create the rule, then click the Configuration tab.
			</div></li><li class="listitem"><div class="para">
				In the Port Forwarding node of the diagram, click View All.
			</div></li><li class="listitem"><div class="para">
				Select the tier to which you want to apply the rule.
			</div></li><li class="listitem"><div class="para">
				Specify the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public Port</strong></span>: The port to which public traffic will be addressed on the IP address you acquired in the previous step.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Private Port</strong></span>: The port on which the instance is listening for forwarded public traffic.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol</strong></span>: The communication protocol in use between the two ports.
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								TCP
							</div></li><li class="listitem"><div class="para">
								UDP
							</div></li></ul></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Add VM</strong></span>: Click Add VM. Select the name of the instance to which this rule applies, and click Apply.
					</div><div class="para">
						You can test the rule by opening an ssh session to the instance.
					</div></li></ul></div></li></ol></div></div><div xml:lang="en-US" class="section" id="remove-tier" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="remove-tier">15.19.12. Removing Tiers</h3></div></div></div><div class="para">
		You can remove a tier from a VPC. A removed tier cannot be revoked. When a tier is removed, only the resources of the tier are expunged. All the network rules (port forwarding, load balancing and staticNAT) and the IP addresses associated to the tier are removed. The IP address still be belonging to the same VPC.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPC that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC for which you want to set up tiers.
			</div><div class="para">
				The Configure VPC page is displayed. Locate the tier you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click the Remove VPC button:
			</div><div class="mediaobject"><img src="./images/remove-tier.png" alt="remove-tier.png: removing a tier from a vpc." /></div><div class="para">
				Wait for some time for the tier to be removed.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="remove-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="remove-vpc">15.19.13. Editing, Restarting, and Removing a Virtual Private Cloud</h3></div></div></div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			Ensure that all the tiers are removed before you remove a VPC.
		</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Select the VPC you want to work with.
			</div></li><li class="listitem"><div class="para">
				To remove, click the Remove VPC button
				<span class="inlinemediaobject"><img src="./images/remove-vpc.png" alt="remove-vpc.png: button to remove a VPC" /></span>
			</div><div class="para">
				You can edit the name and description of a VPC. To do that, select the VPC, then click the Edit button. 
				<span class="inlinemediaobject"><img src="./images/edit-icon.png" alt="edit-icon.png: button to edit a VPC" /></span>
			</div><div class="para">
				To restart a VPC, select the VPC, then click the Restart button.
				<span class="inlinemediaobject"><img src="./images/restart-vpc.png" alt="restart-vpc.png: button to restart a VPC" /></span>
			</div></li></ol></div></div></div></div><div xml:lang="en-US" class="chapter" id="working-with-system-vm" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 16. Working with System Virtual Machines</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#system-vm-template">16.1. The System VM Template</a></span></dt><dt><span class="section"><a href="#multiple-system-vm-vmware">16.2. Multiple System VM Support for VMware</a></span></dt><dt><span class="section"><a href="#console-proxy">16.3. Console Proxy</a></span></dt><dt><span class="section"><a href="#virtual-router">16.4. Virtual Router</a></span></dt><dt><span class="section"><a href="#secondary-storage-vm">16.5. Secondary Storage VM</a></span></dt></dl></div><div class="para">
		CloudStack uses several types of system virtual machines to perform tasks in the cloud. In general CloudStack manages these system VMs and creates, starts, and stops them as needed based on scale and immediate needs. However, the administrator should be aware of them and their roles to assist in debugging issues.
	</div><div xml:lang="en-US" class="section" id="system-vm-template" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="system-vm-template">16.1. The System VM Template</h2></div></div></div><div class="para">
		The System VMs come from a single template. The System VM has the following characteristics:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Debian 6.0 ("Squeeze"), 2.6.32 kernel with the latest security patches from the Debian security APT repository
			</div></li><li class="listitem"><div class="para">
				Has a minimal set of packages installed thereby reducing the attack surface
			</div></li><li class="listitem"><div class="para">
				32-bit for enhanced performance on Xen/VMWare
			</div></li><li class="listitem"><div class="para">
				pvops kernel with Xen PV drivers, KVM virtio drivers, and VMware tools for optimum performance on all hypervisors
			</div></li><li class="listitem"><div class="para">
				Xen tools inclusion allows performance monitoring
			</div></li><li class="listitem"><div class="para">
				Latest versions of HAProxy, iptables, IPsec, and Apache from debian repository ensures improved security and speed
			</div></li><li class="listitem"><div class="para">
				Latest version of JRE from Sun/Oracle ensures improved security and speed
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="multiple-system-vm-vmware" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="multiple-system-vm-vmware">16.2. Multiple System VM Support for VMware</h2></div></div></div><div class="para">
		Every CloudStack zone has single System VM for template processing tasks such as downloading templates, uploading templates, and uploading ISOs. In a zone where VMware is being used, additional System VMs can be launched to process VMware-specific tasks such as taking snapshots and creating private templates. The CloudStack management server launches additional System VMs for VMware-specific tasks as the load increases. The management server monitors and weights all commands sent to these System VMs and performs dynamic load balancing and scaling-up of more System VMs.
	</div></div><div xml:lang="en-US" class="section" id="console-proxy" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="console-proxy">16.3. Console Proxy</h2></div></div></div><div class="para">
		The Console Proxy is a type of System Virtual Machine that has a role in presenting a console view via the web UI. It connects the user’s browser to the VNC port made available via the hypervisor for the console of the guest. Both the administrator and end user web UIs offer a console connection.
	</div><div class="para">
		Clicking on a console icon brings up a new window. The AJAX code downloaded into that window refers to the public IP address of a console proxy VM. There is exactly one public IP address allocated per console proxy VM. The AJAX application connects to this IP. The console proxy then proxies the connection to the VNC port for the requested VM on the Host hosting the guest. .
	</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			The hypervisors will have many ports assigned to VNC usage so that multiple VNC sessions can occur simultaneously.
		</div></div></div><div class="para">
		There is never any traffic to the guest virtual IP, and there is no need to enable VNC within the guest.
	</div><div class="para">
		The console proxy VM will periodically report its active session count to the Management Server. The default reporting interval is five seconds. This can be changed through standard Management Server configuration with the parameter consoleproxy.loadscan.interval.
	</div><div class="para">
		Assignment of guest VM to console proxy is determined by first determining if the guest VM has a previous session associated with a console proxy. If it does, the Management Server will assign the guest VM to the target Console Proxy VM regardless of the load on the proxy VM. Failing that, the first available running Console Proxy VM that has the capacity to handle new sessions is used.
	</div><div class="para">
		Console proxies can be restarted by administrators but this will interrupt existing console sessions for users.
	</div><div class="para">
		The console viewing functionality uses a dynamic DNS service under the domain name realhostip.com to assist in providing SSL security to console sessions. The console proxy is assigned a public IP address. In order to avoid browser warnings for mismatched SSL certificates, the URL for the new console window is set to the form of https://aaa-bbb-ccc-ddd.realhostip.com. Customers will see this URL during console session creation. CloudStack includes the realhostip.com SSL certificate in the console proxy VM. Of course, CloudStack cannot know about DNS A records for our customers' public IPs prior to shipping the software. CloudStack therefore runs a dynamic DNS server that is authoritative for the realhostip.com domain. It maps the aaa-bbb-ccc-ddd part of the DNS name to the IP address aaa.bbb.ccc.ddd on lookups. This allows the browser to correctly connect to the console proxy's public IP, where it then expects and receives a SSL certificate for realhostip.com, and SSL is set up without browser warnings.
	</div></div><div xml:lang="en-US" class="section" id="virtual-router" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="virtual-router">16.4. Virtual Router</h2></div></div></div><div class="para">
		The virtual router is a type of System Virtual Machine. The virtual router is one of the most frequently used service providers in CloudStack. The end user has no direct access to the virtual router. Users can ping the virtual router and take actions that affect it (such as setting up port forwarding), but users do not have SSH access into the virtual router.
	</div><div class="para">
		There is no mechanism for the administrator to log in to the virtual router. Virtual routers can be restarted by administrators, but this will interrupt public network access and other services for end users. A basic test in debugging networking issues is to attempt to ping the virtual router from a guest VM. Some of the characteristics of the virtual router are determined by its associated system service offering.
	</div></div><div xml:lang="en-US" class="section" id="secondary-storage-vm" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="secondary-storage-vm">16.5. Secondary Storage VM</h2></div></div></div><div class="para">
		In addition to the hosts, CloudStack’s Secondary Storage VM mounts and writes to secondary storage.
	</div><div class="para">
		Submissions to secondary storage go through the Secondary Storage VM. The Secondary Storage VM can retrieve templates and ISO images from URLs using a variety of protocols.
	</div><div class="para">
		The secondary storage VM provides a background task that takes care of a variety of secondary storage activities: downloading a new template to a Zone, copying templates between Zones, and snapshot backups.
	</div><div class="para">
		The administrator can log in to the secondary storage VM if needed.
	</div></div></div><div xml:lang="en-US" class="chapter" id="sys-reliability-and-ha" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 17. System Reliability and High Availability</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#ha-management-server">17.1. HA for Management Server</a></span></dt><dt><span class="section"><a href="#ha-enabled-vm">17.2. HA-Enabled Virtual Machines</a></span></dt><dt><span class="section"><a href="#ha-for-hosts">17.3. HA for Hosts</a></span></dt><dt><span class="section"><a href="#primary-storage-outage-and-data-loss">17.4. Primary Storage Outage and Data Loss</a></span></dt><dt><span class="section"><a href="#secondary-storage-outage-and-data-loss">17.5. Secondary Storage Outage and Data Loss</a></span></dt></dl></div><div xml:lang="en-US" class="section" id="ha-management-server" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="ha-management-server">17.1. HA for Management Server</h2></div></div></div><div class="para">
		The CloudStack Management Server should be deployed in a multi-node configuration such that it is not susceptible to individual server failures. The Management Server itself (as distinct from the MySQL database) is stateless and may be placed behind a load balancer.
	</div><div class="para">
		Normal operation of Hosts is not impacted by an outage of all Management Serves. All guest VMs will continue to work.
	</div><div class="para">
		When the Management Server is down, no new VMs can be created, and the end user and admin UI, API, dynamic load distribution, and HA will cease to work.
	</div></div><div xml:lang="en-US" class="section" id="ha-enabled-vm" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="ha-enabled-vm">17.2. HA-Enabled Virtual Machines</h2></div></div></div><div class="para">
		The user can specify a virtual machine as HA-enabled. By default, all virtual router VMs and Elastic Load Balancing VMs are automatically configured as HA-enabled. When an HA-enabled VM crashes, CloudStack detects the crash and restarts the VM automatically within the same Availability Zone. HA is never performed across different Availability Zones. CloudStack has a conservative policy towards restarting VMs and ensures that there will never be two instances of the same VM running at the same time. The Management Server attempts to start the VM on another Host in the same cluster.
	</div><div class="para">
		HA features work with iSCSI or NFS primary storage. HA with local storage is not supported.
	</div></div><div xml:lang="en-US" class="section" id="ha-for-hosts" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="ha-for-hosts">17.3. HA for Hosts</h2></div></div></div><div class="para">
		The user can specify a virtual machine as HA-enabled. By default, all virtual router VMs and Elastic Load Balancing VMs are automatically configured as HA-enabled. When an HA-enabled VM crashes, CloudStack detects the crash and restarts the VM automatically within the same Availability Zone. HA is never performed across different Availability Zones. CloudStack has a conservative policy towards restarting VMs and ensures that there will never be two instances of the same VM running at the same time. The Management Server attempts to start the VM on another Host in the same cluster.
	</div><div class="para">
		HA features work with iSCSI or NFS primary storage. HA with local storage is not supported.
	</div></div><div xml:lang="en-US" class="section" id="primary-storage-outage-and-data-loss" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="primary-storage-outage-and-data-loss">17.4. Primary Storage Outage and Data Loss</h2></div></div></div><div class="para">
		When a primary storage outage occurs the hypervisor immediately stops all VMs stored on that storage device. Guests that are marked for HA will be restarted as soon as practical when the primary storage comes back on line. With NFS, the hypervisor may allow the virtual machines to continue running depending on the nature of the issue. For example, an NFS hang will cause the guest VMs to be suspended until storage connectivity is restored.Primary storage is not designed to be backed up. Individual volumes in primary storage can be backed up using snapshots.
	</div></div><div xml:lang="en-US" class="section" id="secondary-storage-outage-and-data-loss" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="secondary-storage-outage-and-data-loss">17.5. Secondary Storage Outage and Data Loss</h2></div></div></div><div class="para">
		For a Zone that has only one secondary storage server, a secondary storage outage will have feature level impact to the system but will not impact running guest VMs. It may become impossible to create a VM with the selected template for a user. A user may also not be able to save snapshots or examine/restore saved snapshots. These features will automatically be available when the secondary storage comes back online.
	</div><div class="para">
		Secondary storage data loss will impact recently added user data including templates, snapshots, and ISO images. Secondary storage should be backed up periodically. Multiple secondary storage servers can be provisioned within each zone to increase the scalability of the system.
	</div></div></div><div xml:lang="en-US" class="chapter" id="manage-cloud" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 18. Managing the Cloud</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#tagging-resources">18.1. Using Tags to Organize Resources in the Cloud</a></span></dt><dt><span class="section"><a href="#change-database-config">18.2. Changing the Database Configuration</a></span></dt><dt><span class="section"><a href="#admin-alerts">18.3. Administrator Alerts</a></span></dt><dt><span class="section"><a href="#customizing-dns">18.4. Customizing the Network Domain Name</a></span></dt><dt><span class="section"><a href="#stop-restart-management-server">18.5. Stopping and Restarting the Management Server</a></span></dt></dl></div><div xml:lang="en-US" class="section" id="tagging-resources" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="tagging-resources">18.1. Using Tags to Organize Resources in the Cloud</h2></div></div></div><div class="para">
		A tag is a key-value pair that stores metadata about a resource in the cloud. Tags are useful for categorizing resources. For example, you can tag a user VM with a value that indicates the user's city of residence. In this case, the key would be "city" and the value might be "Toronto" or "Tokyo." You can then request CloudStack to find all resources that have a given tag; for example, VMs for users in a given city.
	</div><div class="para">
		You can tag a user virtual machine, volume, snapshot, guest network, template, ISO, firewall rule, port forwarding rule, public IP address, security group, load balancer rule, project, VPC, network ACL, or static route. You can not tag a remote access VPN.
	</div><div class="para">
		You can work with tags through the UI or through the API commands createTags, deleteTags, and listTags. You can define multiple tags for each resource. There is no limit on the number of tags you can define. Each tag can be up to 255 characters long. Users can define tags on the resources they own, and administrators can define tags on any resources in the cloud.
	</div><div class="para">
		An optional input parameter, "tags," exists on many of the list* API commands. The following example shows how to use this new parameter to find all the volumes having tag region=canada OR tag city=Toronto:
	</div><pre class="programlisting">command=listVolumes
				&amp;listAll=true
				&amp;tags[0].key=region
				&amp;tags[0].value=canada
				&amp;tags[1].key=city
				&amp;tags[1].value=Toronto</pre><div class="para">
		The following API commands have the "tags" input parameter:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				listVirtualMachines
			</div></li><li class="listitem"><div class="para">
				listVolumes
			</div></li><li class="listitem"><div class="para">
				listSnapshots
			</div></li><li class="listitem"><div class="para">
				listNetworks
			</div></li><li class="listitem"><div class="para">
				listTemplates
			</div></li><li class="listitem"><div class="para">
				listIsos
			</div></li><li class="listitem"><div class="para">
				listFirewallRules
			</div></li><li class="listitem"><div class="para">
				listPortForwardingRules
			</div></li><li class="listitem"><div class="para">
				listPublicIpAddresses
			</div></li><li class="listitem"><div class="para">
				listSecurityGroups
			</div></li><li class="listitem"><div class="para">
				listLoadBalancerRules
			</div></li><li class="listitem"><div class="para">
				listProjects
			</div></li><li class="listitem"><div class="para">
				listVPCs
			</div></li><li class="listitem"><div class="para">
				listNetworkACLs
			</div></li><li class="listitem"><div class="para">
				listStaticRoutes
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="change-database-config" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="change-database-config">18.2. Changing the Database Configuration</h2></div></div></div><div class="para">
		The CloudStack Management Server stores database configuration information (e.g., hostname, port, credentials) in the file /etc/cloud/management/db.properties. To effect a change, edit this file on each Management Server, then restart the Management Server.
	</div></div><div xml:lang="en-US" class="section" id="admin-alerts" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="admin-alerts">18.3. Administrator Alerts</h2></div></div></div><div class="para">
		The system provides alerts and events to help with the management of the cloud. Alerts are notices to an administrator, generally delivered by e-mail, notifying the administrator that an error has occurred in the cloud. Alert behavior is configurable.
	</div><div class="para">
		Events track all of the user and administrator actions in the cloud. For example, every guest VM start creates an associated event. Events are stored in the Management Server’s database.
	</div><div class="para">
		Emails will be sent to administrators under the following circumstances:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				The Management Server cluster runs low on CPU, memory, or storage resources
			</div></li><li class="listitem"><div class="para">
				The Management Server loses heartbeat from a Host for more than 3 minutes
			</div></li><li class="listitem"><div class="para">
				The Host cluster runs low on CPU, memory, or storage resources
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="customizing-dns" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="customizing-dns">18.4. Customizing the Network Domain Name</h2></div></div></div><div class="para">
		The root administrator can optionally assign a custom DNS suffix at the level of a network, account, domain, zone, or entire CloudStack installation, and a domain administrator can do so within their own domain. To specify a custom domain name and put it into effect, follow these steps.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Set the DNS suffix at the desired scope
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						At the network level, the DNS suffix can be assigned through the UI when creating a new network, as described in <a class="xref" href="#add-additional-guest-network">Section 15.6.1, “Adding an Additional Guest Network”</a> or with the updateNetwork command in the CloudStack API.
					</div></li><li class="listitem"><div class="para">
						At the account, domain, or zone level, the DNS suffix can be assigned with the appropriate CloudStack API commands: createAccount, editAccount, createDomain, editDomain, createZone, or editZone.
					</div></li><li class="listitem"><div class="para">
						At the global level, use the configuration parameter guest.domain.suffix. You can also use the CloudStack API command updateConfiguration. After modifying this global configuration, restart the Management Server to put the new setting into effect.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				To make the new DNS suffix take effect for an existing network, call the CloudStack API command updateNetwork. This step is not necessary when the DNS suffix was specified while creating a new network.
			</div></li></ol></div><div class="para">
		The source of the network domain that is used depends on the following rules.
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				For all networks, if a network domain is specified as part of a network's own configuration, that value is used.
			</div></li><li class="listitem"><div class="para">
				For an account-specific network, the network domain specified for the account is used. If none is specified, the system looks for a value in the domain, zone, and global configuration, in that order.
			</div></li><li class="listitem"><div class="para">
				For a domain-specific network, the network domain specified for the domain is used. If none is specified, the system looks for a value in the zone and global configuration, in that order.
			</div></li><li class="listitem"><div class="para">
				For a zone-specific network, the network domain specified for the zone is used. If none is specified, the system looks for a value in the global configuration.
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="stop-restart-management-server" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="stop-restart-management-server">18.5. Stopping and Restarting the Management Server</h2></div></div></div><div class="para">
		The root administrator will need to stop and restart the Management Server from time to time.
	</div><div class="para">
		For example, after changing a global configuration parameter, a restart is required. If you have multiple Management Server nodes, restart all of them to put the new parameter value into effect consistently throughout the cloud.
	</div><div class="para">
		To stop the Management Server, issue the following command at the operating system prompt on the Management Server node:
	</div><pre class="programlisting"># service cloud-management stop</pre><div class="para">
		To start the Management Server:
	</div><pre class="programlisting"># service cloud-management start</pre><div class="para">
		To stop the Management Server:
	</div><pre class="programlisting"># service cloud-management stop</pre></div></div><div xml:lang="en-US" class="chapter" id="global-config" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 19. Setting Global Configuration Parameters</h2></div></div></div><div class="para">
		CloudStack provides parameters that you can set to control many aspects of the cloud. When CloudStack is first installed, and periodically thereafter, you might need to modify these settings.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the UI as administrator.
			</div></li><li class="listitem"><div class="para">
				In the left navigation bar, click Global Settings.
			</div></li><li class="listitem"><div class="para">
				In Select View, choose one of the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Global Settings. This displays a list of the parameters with brief descriptions and current values.
					</div></li><li class="listitem"><div class="para">
						Hypervisor Capabilities. This displays a list of hypervisor versions with the maximum number of guests supported for each.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Use the search box to narrow down the list to those you are interested in.
			</div></li><li class="listitem"><div class="para">
				Click the Edit icon to modify a value. If you are viewing Hypervisor Capabilities, you must click the name of the hypervisor first to display the editing screen.
			</div></li></ol></div></div><div xml:lang="en-US" class="chapter" id="api-overview" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 20. CloudStack API</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#provisioning-auth-api">20.1. Provisioning and Authentication API</a></span></dt><dt><span class="section"><a href="#allocators">20.2. Allocators</a></span></dt><dt><span class="section"><a href="#user-data-and-meta-data">20.3. User Data and Meta Data</a></span></dt></dl></div><div class="para">
		The CloudStack API is a low level API that has been used to implement the CloudStack web UIs. It is also a good basis for implementing other popular APIs such as EC2/S3 and emerging DMTF standards.
	</div><div class="para">
		Many CloudStack API calls are asynchronous. These will return a Job ID immediately when called. This Job ID can be used to query the status of the job later. Also, status calls on impacted resources will provide some indication of their state.
	</div><div class="para">
		The API has a REST-like query basis and returns results in XML or JSON.
	</div><div class="para">
		See <a href="http://docs.cloudstack.org/CloudStack_Documentation/Developer's_Guide%3A_CloudStack">the Developer’s Guide</a> and <a href="http://docs.cloudstack.org/CloudStack_Documentation/API_Reference%3A_CloudStack">the API Reference</a>.
	</div><div xml:lang="en-US" class="section" id="provisioning-auth-api" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="provisioning-auth-api">20.1. Provisioning and Authentication API</h2></div></div></div><div class="para">
		CloudStack expects that a customer will have their own user provisioning infrastructure. It provides APIs to integrate with these existing systems where the systems call out to CloudStack to add/remove users..
	</div><div class="para">
		CloudStack supports pluggable authenticators. By default, CloudStack assumes it is provisioned with the user’s password, and as a result authentication is done locally. However, external authentication is possible as well. For example, see Using an LDAP Server for User Authentication.
	</div></div><div xml:lang="en-US" class="section" id="allocators" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="allocators">20.2. Allocators</h2></div></div></div><div class="para">
		CloudStack enables administrators to write custom allocators that will choose the Host to place a new guest and the storage host from which to allocate guest virtual disk images.
	</div></div><div xml:lang="en-US" class="section" id="user-data-and-meta-data" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="user-data-and-meta-data">20.3. User Data and Meta Data</h2></div></div></div><div class="para">
		CloudStack provides API access to attach user data to a deployed VM. Deployed VMs also have access to instance metadata via the virtual router.
	</div><div class="para">
		User data can be accessed once the IP address of the virtual router is known. Once the IP address is known, use the following steps to access the user data:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Run the following command to find the virtual router.
			</div><pre class="programlisting"># cat /var/lib/dhclient/dhclient-eth0.leases | grep dhcp-server-identifier | tail -1</pre></li><li class="listitem"><div class="para">
				Access user data by running the following command using the result of the above command
			</div><pre class="programlisting"># curl http://10.1.1.1/latest/user-data</pre></li></ol></div><div class="para">
		Meta Data can be accessed similarly, using a URL of the form http://10.1.1.1/latest/meta-data/{metadata type}. (For backwards compatibility, the previous URL http://10.1.1.1/latest/{metadata type} is also supported.) For metadata type, use one of the following:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				service-offering. A description of the VMs service offering
			</div></li><li class="listitem"><div class="para">
				availability-zone. The Zone name
			</div></li><li class="listitem"><div class="para">
				local-ipv4. The guest IP of the VM
			</div></li><li class="listitem"><div class="para">
				local-hostname. The hostname of the VM
			</div></li><li class="listitem"><div class="para">
				public-ipv4. The first public IP for the router. (E.g. the first IP of eth2)
			</div></li><li class="listitem"><div class="para">
				public-hostname. This is the same as public-ipv4
			</div></li><li class="listitem"><div class="para">
				instance-id. The instance name of the VM
			</div></li></ul></div></div></div><div xml:lang="en-US" class="chapter" id="tuning" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 21. Tuning</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#performance-monitoring">21.1. Performance Monitoring</a></span></dt><dt><span class="section"><a href="#increase-management-server-max-memory">21.2. Increase Management Server Maximum Memory</a></span></dt><dt><span class="section"><a href="#set-database-buffer-pool-size">21.3. Set Database Buffer Pool Size</a></span></dt><dt><span class="section"><a href="#set-monitor-total-vm-limits-per-host">21.4. Set and Monitor Total VM Limits per Host</a></span></dt><dt><span class="section"><a href="#configure-xenserver-dom0-memory">21.5. Configure XenServer dom0 Memory</a></span></dt></dl></div><div class="para">
		This section provides tips on how to improve the performance of your cloud.
	</div><div xml:lang="en-US" class="section" id="performance-monitoring" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="performance-monitoring">21.1. Performance Monitoring</h2></div></div></div><div class="para">
		Host and guest performance monitoring is available to end users and administrators. This allows the user to monitor their utilization of resources and determine when it is appropriate to choose a more powerful service offering or larger disk.
	</div></div><div xml:lang="en-US" class="section" id="increase-management-server-max-memory" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="increase-management-server-max-memory">21.2. Increase Management Server Maximum Memory</h2></div></div></div><div class="para">
		If the Management Server is subject to high demand, the default maximum JVM memory allocation can be insufficient. To increase the memory:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Edit the Tomcat configuration file:
			</div><pre class="programlisting">/etc/cloud/management/tomcat6.conf</pre></li><li class="listitem"><div class="para">
				Change the command-line parameter -XmxNNNm to a higher value of N.
			</div><div class="para">
				For example, if the current value is -Xmx128m, change it to -Xmx1024m or higher.
			</div></li><li class="listitem"><div class="para">
				To put the new setting into effect, restart the Management Server.
			</div><pre class="programlisting"># service cloud-management restart</pre></li></ol></div><div class="para">
		For more information about memory issues, see "FAQ: Memory" at <a href="http://wiki.apache.org/tomcat/FAQ/Memory">Tomcat Wiki.</a>
	</div></div><div xml:lang="en-US" class="section" id="set-database-buffer-pool-size" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="set-database-buffer-pool-size">21.3. Set Database Buffer Pool Size</h2></div></div></div><div class="para">
		It is important to provide enough memory space for the MySQL database to cache data and indexes:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Edit the Tomcat configuration file:
			</div><pre class="programlisting">/etc/my.cnf</pre></li><li class="listitem"><div class="para">
				Insert the following line in the [mysqld] section, below the datadir line. Use a value that is appropriate for your situation. We recommend setting the buffer pool at 40% of RAM if MySQL is on the same server as the management server or 70% of RAM if MySQL has a dedicated server. The following example assumes a dedicated server with 1024M of RAM.
			</div><pre class="programlisting">innodb_buffer_pool_size=700M</pre></li><li class="listitem"><div class="para">
				Restart the MySQL service.
			</div><pre class="programlisting"># service mysqld restart</pre></li></ol></div><div class="para">
		For more information about the buffer pool, see "The InnoDB Buffer Pool" at <a href="http://dev.mysql.com/doc/refman/5.5/en/innodb-buffer-pool.html">MySQL Reference Manual</a>.
	</div></div><div xml:lang="en-US" class="section" id="set-monitor-total-vm-limits-per-host" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="set-monitor-total-vm-limits-per-host">21.4. Set and Monitor Total VM Limits per Host</h2></div></div></div><div class="para">
		The CloudStack administrator should monitor the total number of VM instances in each cluster, and disable allocation to the cluster if the total is approaching the maximum that the hypervisor can handle. Be sure to leave a safety margin to allow for the possibility of one or more hosts failing, which would increase the VM load on the other hosts as the VMs are automatically redeployed. Consult the documentation for your chosen hypervisor to find the maximum permitted number of VMs per host, then use CloudStack global configuration settings to set this as the default limit. Monitor the VM activity in each cluster at all times. Keep the total number of VMs below a safe level that allows for the occasional host failure. For example, if there are N hosts in the cluster, and you want to allow for one host in the cluster to be down at any given time, the total number of VM instances you can permit in the cluster is at most (N-1) * (per-host-limit). Once a cluster reaches this number of VMs, use the CloudStack UI to disable allocation of more VMs to the cluster.
	</div></div><div xml:lang="en-US" class="section" id="configure-xenserver-dom0-memory" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="configure-xenserver-dom0-memory">21.5. Configure XenServer dom0 Memory</h2></div></div></div><div class="para">
		Configure the XenServer dom0 settings to allocate more memory to dom0. This can enable XenServer to handle larger numbers of virtual machines. We recommend 2940 MB of RAM for XenServer dom0. For instructions on how to do this, see <a href="http://support.citrix.com/article/CTX126531">Citrix Knowledgebase Article</a>.The article refers to XenServer 5.6, but the same information applies to XenServer 6
	</div></div></div><div xml:lang="en-US" class="chapter" id="troubleshooting" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 22. Troubleshooting</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#events">22.1. Events</a></span></dt><dd><dl><dt><span class="section"><a href="#events-log">22.1.1. Event Logs</a></span></dt><dt><span class="section"><a href="#standard-events">22.1.2. Standard Events</a></span></dt><dt><span class="section"><a href="#long-running-job-events">22.1.3. Long Running Job Events</a></span></dt><dt><span class="section"><a href="#event-log-queries">22.1.4. Event Log Queries</a></span></dt></dl></dd><dt><span class="section"><a href="#troubleshooting-working-with-server-logs">22.2. Working with Server Logs</a></span></dt><dt><span class="section"><a href="#troubleshooting-dataloss-on-exported-primary-storage">22.3. Data Loss on Exported Primary Storage</a></span></dt><dt><span class="section"><a href="#troubleshooting-recover-lost-virtual-router">22.4. Recovering a Lost Virtual Router </a></span></dt><dt><span class="section"><a href="#troubleshooting-maintenance-mode-not-working-on-vCenter">22.5. Maintenance mode not working on vCenter</a></span></dt><dt><span class="section"><a href="#troubleshooting-unable-to-deploy-vms">22.6. Unable to deploy VMs from uploaded vSphere template</a></span></dt><dt><span class="section"><a href="#troubleshooting-unable-to-power-on-vm">22.7. Unable to power on virtual machine on VMware</a></span></dt><dt><span class="section"><a href="#troubleshooting-lb-rules-fails">22.8. Load balancer rules fail after changing network offering</a></span></dt></dl></div><div xml:lang="en-US" class="section" id="events" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="events">22.1. Events</h2></div></div></div><div xml:lang="en-US" class="section" id="events-log" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="events-log">22.1.1. Event Logs</h3></div></div></div><div class="para">
		There are two types of events logged in the CloudStack Event Log. Standard events log the success or failure of an event and can be used to identify jobs or processes that have failed. There are also long running job events. Events for asynchronous jobs log when a job is scheduled, when it starts, and when it completes. Other long running synchronous jobs log when a job starts, and when it completes. Long running synchronous and asynchronous event logs can be used to gain more information on the status of a pending job or can be used to identify a job that is hanging or has not started. The following sections provide more information on these events..
	</div></div><div xml:lang="en-US" class="section" id="standard-events" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="standard-events">22.1.2. Standard Events</h3></div></div></div><div class="para">
		The events log records three types of standard events.
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				INFO. This event is generated when an operation has been successfully performed.
			</div></li><li class="listitem"><div class="para">
				WARN. This event is generated in the following circumstances.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						When a network is disconnected while monitoring a template download.
					</div></li><li class="listitem"><div class="para">
						When a template download is abandoned.
					</div></li><li class="listitem"><div class="para">
						When an issue on the storage server causes the volumes to fail over to the mirror storage server.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				ERROR. This event is generated when an operation has not been successfully performed
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="long-running-job-events" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="long-running-job-events">22.1.3. Long Running Job Events</h3></div></div></div><div class="para">
		The events log records three types of standard events.
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				INFO. This event is generated when an operation has been successfully performed.
			</div></li><li class="listitem"><div class="para">
				WARN. This event is generated in the following circumstances.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						When a network is disconnected while monitoring a template download.
					</div></li><li class="listitem"><div class="para">
						When a template download is abandoned.
					</div></li><li class="listitem"><div class="para">
						When an issue on the storage server causes the volumes to fail over to the mirror storage server.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				ERROR. This event is generated when an operation has not been successfully performed
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="event-log-queries" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="event-log-queries">22.1.4. Event Log Queries</h3></div></div></div><div class="para">
		Database logs can be queried from the user interface. The list of events captured by the system includes:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Virtual machine creation, deletion, and on-going management operations
			</div></li><li class="listitem"><div class="para">
				Virtual router creation, deletion, and on-going management operations
			</div></li><li class="listitem"><div class="para">
				Template creation and deletion
			</div></li><li class="listitem"><div class="para">
				Network/load balancer rules creation and deletion
			</div></li><li class="listitem"><div class="para">
				Storage volume creation and deletion
			</div></li><li class="listitem"><div class="para">
				User login and logout
			</div></li></ul></div></div></div><div xml:lang="en-US" class="section" id="troubleshooting-working-with-server-logs" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="troubleshooting-working-with-server-logs">22.2. Working with Server Logs</h2></div></div></div><div class="para">
		The CloudStack Management Server logs all web site, middle tier, and database activities for diagnostics purposes in /var/log/cloud/management/. The CloudStack logs a variety of error messages. We recommend this command to find the problematic output in the Management Server log:.
	</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			When copying and pasting a command, be sure the command has pasted as a single line before executing. Some document viewers may introduce unwanted line breaks in copied text.
		</div></div></div><pre class="programlisting">
        grep -i -E 'exception|unable|fail|invalid|leak|warn|error' /var/log/cloud/management/management-server.log
</pre><div class="para">
		The CloudStack processes requests with a Job ID. If you find an error in the logs and you are interested in debugging the issue you can grep for this job ID in the management server log. For example, suppose that you find the following ERROR message:
	</div><pre class="programlisting">
        2010-10-04 13:49:32,595 ERROR [cloud.vm.UserVmManagerImpl] (Job-Executor-11:job-1076) Unable to find any host for [User|i-8-42-VM-untagged]
</pre><div class="para">
		Note that the job ID is 1076. You can track back the events relating to job 1076 with the following grep:
	</div><pre class="programlisting">
        grep "job-1076)" management-server.log
</pre><div class="para">
		The CloudStack Agent Server logs its activities in /var/log/cloud/agent/.
	</div></div><div xml:lang="en-US" class="section" id="troubleshooting-dataloss-on-exported-primary-storage" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="troubleshooting-dataloss-on-exported-primary-storage">22.3. Data Loss on Exported Primary Storage</h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idp11713464">Symptom</h5>
			Loss of existing data on primary storage which has been exposed as a Linux NFS server export on an iSCSI volume.
		</div><div class="formalpara"><h5 class="formalpara" id="idm5483880">Cause</h5>
			It is possible that a client from outside the intended pool has mounted the storage. When this occurs, the LVM is wiped and all data in the volume is lost
		</div><div class="formalpara"><h5 class="formalpara" id="idp7887192">Solution</h5>
			When setting up LUN exports, restrict the range of IP addresses that are allowed access by specifying a subnet mask. For example:
		</div><pre class="programlisting">echo “/export 192.168.1.0/24(rw,async,no_root_squash)” &gt; /etc/exports</pre><div class="para">
		Adjust the above command to suit your deployment needs.
	</div><div class="formalpara"><h5 class="formalpara" id="idp11983856">More Information</h5>
			See the export procedure in the "Secondary Storage" section of the CloudStack Installation Guide
		</div></div><div xml:lang="en-US" class="section" id="troubleshooting-recover-lost-virtual-router" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="troubleshooting-recover-lost-virtual-router">22.4. Recovering a Lost Virtual Router </h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idm3643216">Symptom</h5>
			A virtual router is running, but the host is disconnected. A virtual router no longer functions as expected.
		</div><div class="formalpara"><h5 class="formalpara" id="idm2551264">Cause</h5>
			The Virtual router is lost or down.
		</div><div class="formalpara"><h5 class="formalpara" id="idm1384136">Solution</h5>
			If you are sure that a virtual router is down forever, or no longer functions as expected, destroy it. You must create one afresh while keeping the backup router up and running (it is assumed this is in a redundant router setup):
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Force stop the router. Use the stopRouter API with forced=true parameter to do so.
			</div></li><li class="listitem"><div class="para">
				Before you continue with destroying this router, ensure that the backup router is running. Otherwise the network connection will be lost.
			</div></li><li class="listitem"><div class="para">
				Destroy the router by using the destroyRouter API.
			</div></li></ul></div><div class="para">
		Recreate the missing router by using the restartNetwork API with cleanup=false parameter. For more information about redundant router setup, see Creating a New Network Offering.
	</div><div class="para">
		For more information about the API syntax, see the API Reference at <a href="http://docs.cloudstack.org/CloudStack_Documentation/API_Reference%3A_CloudStack">http://docs.cloudstack.org/CloudStack_Documentation/API_Reference%3A_CloudStack</a>API Reference.
	</div></div><div xml:lang="en-US" class="section" id="troubleshooting-maintenance-mode-not-working-on-vCenter" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="troubleshooting-maintenance-mode-not-working-on-vCenter">22.5. Maintenance mode not working on vCenter</h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idp4066120">Symptom</h5>
			Host was placed in maintenance mode, but still appears live in vCenter.
		</div><div class="formalpara"><h5 class="formalpara" id="idm2093408">Cause</h5>
			The CloudPlatform administrator UI was used to place the host in scheduled maintenance mode. This mode is separate from vCenter's maintenance mode.
		</div><div class="formalpara"><h5 class="formalpara" id="idm1982728">Solution</h5>
			Use vCenter to place the host in maintenance mode.
		</div><div class="formalpara"><h5 class="formalpara" id="idm750720">More Information</h5>
			See <a class="xref" href="#scheduled-maintenance-maintenance-mode-hosts">Section 11.2, “Scheduled Maintenance and Maintenance Mode for Hosts”</a>
		</div></div><div xml:lang="en-US" class="section" id="troubleshooting-unable-to-deploy-vms" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="troubleshooting-unable-to-deploy-vms">22.6. Unable to deploy VMs from uploaded vSphere template</h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idm200392">Symptom</h5>
			When attempting to create a VM, the VM will not deploy.
		</div><div class="formalpara"><h5 class="formalpara" id="idp2780280">Cause</h5>
			If the template was created by uploading an OVA file that was created using vSphere Client, it is possible the OVA contained an ISO image. If it does, the deployment of VMs from the template will fail.
		</div><div class="formalpara"><h5 class="formalpara" id="idm1309536">Solution</h5>
			Remove the ISO and re-upload the template.
		</div></div><div xml:lang="en-US" class="section" id="troubleshooting-unable-to-power-on-vm" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="troubleshooting-unable-to-power-on-vm">22.7. Unable to power on virtual machine on VMware</h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idm16490128">Symptom</h5>
			Virtual machine does not power on. You might see errors like:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Unable to open Swap File
			</div></li><li class="listitem"><div class="para">
				Unable to access a file since it is locked
			</div></li><li class="listitem"><div class="para">
				Unable to access Virtual machine configuration
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idm17243120">Cause</h5>
			A known issue on VMware machines. ESX hosts lock certain critical virtual machine files and file systems to prevent concurrent changes. Sometimes the files are not unlocked when the virtual machine is powered off. When a virtual machine attempts to power on, it can not access these critical files, and the virtual machine is unable to power on.
		</div><div class="formalpara"><h5 class="formalpara" id="idp13002024">Solution</h5>
			See the following:
		</div><div class="para">
		<a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=10051/">VMware Knowledge Base Article</a>
	</div></div><div xml:lang="en-US" class="section" id="troubleshooting-lb-rules-fails" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="troubleshooting-lb-rules-fails">22.8. Load balancer rules fail after changing network offering</h2></div></div></div><div class="formalpara"><h5 class="formalpara" id="idp2519104">Symptom</h5>
			After changing the network offering on a network, load balancer rules stop working.
		</div><div class="formalpara"><h5 class="formalpara" id="idp2560456">Cause</h5>
			Load balancing rules were created while using a network service offering that includes an external load balancer device such as NetScaler, and later the network service offering changed to one that uses the CloudPlatform virtual router.
		</div><div class="formalpara"><h5 class="formalpara" id="idm5944872">Solution</h5>
			Create a firewall rule on the virtual router for each of your existing load balancing rules so that they continue to function.
		</div></div></div><div xml:lang="en-US" class="appendix" id="time-zones" lang="en-US"><div class="titlepage"><div><div><h1 class="title">Time Zones</h1></div></div></div><div class="para">
		The following time zone identifiers are accepted by CloudStack. There are several places that have a time zone as a required or optional parameter. These include scheduling recurring snapshots, creating a user, and specifying the usage time zone in the Configuration table.
	</div><div class="informaltable"><table border="1"><colgroup><col align="left" class="c1" width="33%" /><col align="left" class="c2" width="33%" /><col align="left" class="c3" width="33%" /></colgroup><tbody><tr><td align="left">
						<div class="para">
							Etc/GMT+12
						</div>
					</td><td align="left">
						<div class="para">
							Etc/GMT+11
						</div>
					</td><td align="left">
						<div class="para">
							Pacific/Samoa
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Pacific/Honolulu
						</div>
					</td><td align="left">
						<div class="para">
							US/Alaska
						</div>
					</td><td align="left">
						<div class="para">
							America/Los_Angeles
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Mexico/BajaNorte
						</div>
					</td><td align="left">
						<div class="para">
							US/Arizona
						</div>
					</td><td align="left">
						<div class="para">
							US/Mountain
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							America/Chihuahua
						</div>
					</td><td align="left">
						<div class="para">
							America/Chicago
						</div>
					</td><td align="left">
						<div class="para">
							America/Costa_Rica
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							America/Mexico_City
						</div>
					</td><td align="left">
						<div class="para">
							Canada/Saskatchewan
						</div>
					</td><td align="left">
						<div class="para">
							America/Bogota
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							America/New_York
						</div>
					</td><td align="left">
						<div class="para">
							America/Caracas
						</div>
					</td><td align="left">
						<div class="para">
							America/Asuncion
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							America/Cuiaba
						</div>
					</td><td align="left">
						<div class="para">
							America/Halifax
						</div>
					</td><td align="left">
						<div class="para">
							America/La_Paz
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							America/Santiago
						</div>
					</td><td align="left">
						<div class="para">
							America/St_Johns
						</div>
					</td><td align="left">
						<div class="para">
							America/Araguaina
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							America/Argentina/Buenos_Aires
						</div>
					</td><td align="left">
						<div class="para">
							America/Cayenne
						</div>
					</td><td align="left">
						<div class="para">
							America/Godthab
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							America/Montevideo
						</div>
					</td><td align="left">
						<div class="para">
							Etc/GMT+2
						</div>
					</td><td align="left">
						<div class="para">
							Atlantic/Azores
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Atlantic/Cape_Verde
						</div>
					</td><td align="left">
						<div class="para">
							Africa/Casablanca
						</div>
					</td><td align="left">
						<div class="para">
							Etc/UTC
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Atlantic/Reykjavik
						</div>
					</td><td align="left">
						<div class="para">
							Europe/London
						</div>
					</td><td align="left">
						<div class="para">
							CET
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Europe/Bucharest
						</div>
					</td><td align="left">
						<div class="para">
							Africa/Johannesburg
						</div>
					</td><td align="left">
						<div class="para">
							Asia/Beirut
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Africa/Cairo
						</div>
					</td><td align="left">
						<div class="para">
							Asia/Jerusalem
						</div>
					</td><td align="left">
						<div class="para">
							Europe/Minsk
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Europe/Moscow
						</div>
					</td><td align="left">
						<div class="para">
							Africa/Nairobi
						</div>
					</td><td align="left">
						<div class="para">
							Asia/Karachi
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Asia/Kolkata
						</div>
					</td><td align="left">
						<div class="para">
							Asia/Bangkok
						</div>
					</td><td align="left">
						<div class="para">
							Asia/Shanghai
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Asia/Kuala_Lumpur
						</div>
					</td><td align="left">
						<div class="para">
							Australia/Perth
						</div>
					</td><td align="left">
						<div class="para">
							Asia/Taipei
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Asia/Tokyo
						</div>
					</td><td align="left">
						<div class="para">
							Asia/Seoul
						</div>
					</td><td align="left">
						<div class="para">
							Australia/Adelaide
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Australia/Darwin
						</div>
					</td><td align="left">
						<div class="para">
							Australia/Brisbane
						</div>
					</td><td align="left">
						<div class="para">
							Australia/Canberra
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							Pacific/Guam
						</div>
					</td><td align="left">
						<div class="para">
							Pacific/Auckland
						</div>
					</td><td align="left">
						<div class="para">
						</div>
					</td></tr></tbody></table></div></div><div xml:lang="en-US" class="appendix" id="event-types" lang="en-US"><div class="titlepage"><div><div><h1 class="title">Event Types</h1></div></div></div><div class="informaltable"><table border="1"><colgroup><col align="left" class="c1" width="33%" /><col align="left" class="c2" width="33%" /><col width="33%" /></colgroup><tbody><tr><td align="left">
						<div class="para">
							VM.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							TEMPLATE.EXTRACT
						</div>
					</td><td align="left">
						<div class="para">
							SG.REVOKE.INGRESS
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							VM.DESTROY
						</div>
					</td><td align="left">
						<div class="para">
							TEMPLATE.UPLOAD
						</div>
					</td><td align="left">
						<div class="para">
							HOST.RECONNECT
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							VM.START
						</div>
					</td><td align="left">
						<div class="para">
							TEMPLATE.CLEANUP
						</div>
					</td><td align="left">
						<div class="para">
							MAINT.CANCEL
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							VM.STOP
						</div>
					</td><td align="left">
						<div class="para">
							VOLUME.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							MAINT.CANCEL.PS
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							VM.REBOOT
						</div>
					</td><td align="left">
						<div class="para">
							VOLUME.DELETE
						</div>
					</td><td align="left">
						<div class="para">
							MAINT.PREPARE
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							VM.UPGRADE
						</div>
					</td><td align="left">
						<div class="para">
							VOLUME.ATTACH
						</div>
					</td><td align="left">
						<div class="para">
							MAINT.PREPARE.PS
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							VM.RESETPASSWORD
						</div>
					</td><td align="left">
						<div class="para">
							VOLUME.DETACH
						</div>
					</td><td align="left">
						<div class="para">
							VPN.REMOTE.ACCESS.CREATE
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							ROUTER.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							VOLUME.UPLOAD
						</div>
					</td><td align="left">
						<div class="para">
							VPN.USER.ADD
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							ROUTER.DESTROY
						</div>
					</td><td align="left">
						<div class="para">
							SERVICEOFFERING.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							VPN.USER.REMOVE
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							ROUTER.START
						</div>
					</td><td align="left">
						<div class="para">
							SERVICEOFFERING.UPDATE
						</div>
					</td><td align="left">
						<div class="para">
							NETWORK.RESTART
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							ROUTER.STOP
						</div>
					</td><td align="left">
						<div class="para">
							SERVICEOFFERING.DELETE
						</div>
					</td><td align="left">
						<div class="para">
							UPLOAD.CUSTOM.CERTIFICATE
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							ROUTER.REBOOT
						</div>
					</td><td align="left">
						<div class="para">
							DOMAIN.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							UPLOAD.CUSTOM.CERTIFICATE
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							ROUTER.HA
						</div>
					</td><td align="left">
						<div class="para">
							DOMAIN.DELETE
						</div>
					</td><td align="left">
						<div class="para">
							STATICNAT.DISABLE
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							PROXY.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							DOMAIN.UPDATE
						</div>
					</td><td align="left">
						<div class="para">
							SSVM.CREATE
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							PROXY.DESTROY
						</div>
					</td><td align="left">
						<div class="para">
							SNAPSHOT.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							SSVM.DESTROY
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							PROXY.START
						</div>
					</td><td align="left">
						<div class="para">
							SNAPSHOT.DELETE
						</div>
					</td><td align="left">
						<div class="para">
							SSVM.START
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							PROXY.STOP
						</div>
					</td><td align="left">
						<div class="para">
							SNAPSHOTPOLICY.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							SSVM.STOP
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							PROXY.REBOOT
						</div>
					</td><td align="left">
						<div class="para">
							SNAPSHOTPOLICY.UPDATE
						</div>
					</td><td align="left">
						<div class="para">
							SSVM.REBOOT
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							PROXY.HA
						</div>
					</td><td align="left">
						<div class="para">
							SNAPSHOTPOLICY.DELETE
						</div>
					</td><td align="left">
						<div class="para">
							SSVM.H
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							VNC.CONNECT
						</div>
					</td><td align="left">
						<div class="para">
							VNC.DISCONNECT
						</div>
					</td><td align="left">
						<div class="para">
							NET.IPASSIGN
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							NET.IPRELEASE
						</div>
					</td><td align="left">
						<div class="para">
							NET.RULEADD
						</div>
					</td><td align="left">
						<div class="para">
							NET.RULEDELETE
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							NET.RULEMODIFY
						</div>
					</td><td align="left">
						<div class="para">
							NETWORK.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							NETWORK.DELETE
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							LB.ASSIGN.TO.RULE
						</div>
					</td><td align="left">
						<div class="para">
							LB.REMOVE.FROM.RULE
						</div>
					</td><td align="left">
						<div class="para">
							LB.CREATE
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							LB.DELETE
						</div>
					</td><td align="left">
						<div class="para">
							LB.UPDATE
						</div>
					</td><td align="left">
						<div class="para">
							USER.LOGIN
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							USER.LOGOUT
						</div>
					</td><td align="left">
						<div class="para">
							USER.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							USER.DELETE
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							USER.UPDATE
						</div>
					</td><td align="left">
						<div class="para">
							USER.DISABLE
						</div>
					</td><td align="left">
						<div class="para">
							TEMPLATE.CREATE
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							TEMPLATE.DELETE
						</div>
					</td><td align="left">
						<div class="para">
							TEMPLATE.UPDATE
						</div>
					</td><td align="left">
						<div class="para">
							TEMPLATE.COPY
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							TEMPLATE.DOWNLOAD.START
						</div>
					</td><td align="left">
						<div class="para">
							TEMPLATE.DOWNLOAD.SUCCESS
						</div>
					</td><td align="left">
						<div class="para">
							TEMPLATE.DOWNLOAD.FAILED
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							ISO.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							ISO.DELETE
						</div>
					</td><td align="left">
						<div class="para">
							ISO.COPY
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							ISO.ATTACH
						</div>
					</td><td align="left">
						<div class="para">
							ISO.DETACH
						</div>
					</td><td align="left">
						<div class="para">
							ISO.EXTRACT
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							ISO.UPLOAD
						</div>
					</td><td align="left">
						<div class="para">
							SERVICE.OFFERING.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							SERVICE.OFFERING.EDIT
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							SERVICE.OFFERING.DELETE
						</div>
					</td><td align="left">
						<div class="para">
							DISK.OFFERING.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							DISK.OFFERING.EDIT
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							DISK.OFFERING.DELETE
						</div>
					</td><td align="left">
						<div class="para">
							NETWORK.OFFERING.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							NETWORK.OFFERING.EDIT
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							NETWORK.OFFERING.DELETE
						</div>
					</td><td align="left">
						<div class="para">
							POD.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							POD.EDIT
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							POD.DELETE
						</div>
					</td><td align="left">
						<div class="para">
							ZONE.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							ZONE.EDIT
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							ZONE.DELETE
						</div>
					</td><td align="left">
						<div class="para">
							VLAN.IP.RANGE.CREATE
						</div>
					</td><td align="left">
						<div class="para">
							VLAN.IP.RANGE.DELETE
						</div>
					</td></tr><tr><td align="left">
						<div class="para">
							CONFIGURATION.VALUE.EDIT
						</div>
					</td><td align="left">
						<div class="para">
							SG.AUTH.INGRESS
						</div>
					</td><td align="left">
						<div class="para">
						</div>
					</td></tr></tbody></table></div></div><div xml:lang="en-US" class="appendix" id="alerts" lang="en-US"><div class="titlepage"><div><div><h1 class="title">Alerts</h1></div></div></div><div class="para">
		The following is the list of alert type numbers. The current alerts can be found by calling listAlerts.
	</div><pre class="programlisting">MEMORY = 0</pre><pre class="programlisting">CPU = 1</pre><pre class="programlisting">STORAGE =2</pre><pre class="programlisting">STORAGE_ALLOCATED = 3</pre><pre class="programlisting">PUBLIC_IP = 4</pre><pre class="programlisting">PRIVATE_IP = 5</pre><pre class="programlisting">HOST = 6</pre><pre class="programlisting">USERVM = 7</pre><pre class="programlisting">DOMAIN_ROUTER = 8</pre><pre class="programlisting">CONSOLE_PROXY = 9</pre><pre class="programlisting">ROUTING = 10// lost connection to default route (to the gateway)</pre><pre class="programlisting">STORAGE_MISC = 11 // lost connection to default route (to the gateway)</pre><pre class="programlisting">USAGE_SERVER = 12 // lost connection to default route (to the gateway)</pre><pre class="programlisting">MANAGMENT_NODE = 13 // lost connection to default route (to the gateway)</pre><pre class="programlisting">DOMAIN_ROUTER_MIGRATE = 14</pre><pre class="programlisting">CONSOLE_PROXY_MIGRATE = 15</pre><pre class="programlisting">USERVM_MIGRATE = 16</pre><pre class="programlisting">VLAN = 17</pre><pre class="programlisting">SSVM = 18</pre><pre class="programlisting">USAGE_SERVER_RESULT = 19</pre><pre class="programlisting">STORAGE_DELETE = 20;</pre><pre class="programlisting">UPDATE_RESOURCE_COUNT = 21; //Generated when we fail to update the resource count</pre><pre class="programlisting">USAGE_SANITY_RESULT = 22;</pre><pre class="programlisting">DIRECT_ATTACHED_PUBLIC_IP = 23;</pre><pre class="programlisting">LOCAL_STORAGE = 24;</pre><pre class="programlisting">RESOURCE_LIMIT_EXCEEDED = 25; //Generated when the resource limit exceeds the limit. Currently used for recurring snapshots only</pre></div><div xml:lang="en-US" class="appendix" id="appe-cloudstack-Revision_History" lang="en-US"><div class="titlepage"><div><div><h1 class="title">Revision History</h1></div></div></div><div class="para">
		<div class="revhistory"><table border="0" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><strong>Revision History</strong></th></tr><tr><td align="left">Revision 0-0</td><td align="left">Tue May 29 2012</td><td align="left"><span class="author"><span class="firstname">Jessica</span> <span class="surname">Tomechak</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>Initial creation of book by publican</td></tr></table>

				</td></tr></table></div>

	</div></div></div></body></html>
