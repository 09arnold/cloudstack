<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>12.8. Guest Network Usage Integration for Traffic Sentinel</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 2.8" /><meta name="package" content="Apache_CloudStack-Installation_Guide-4.0.0-incubating-en-US-1-" /><link rel="home" href="index.html" title="CloudStack Installation Guide" /><link rel="up" href="network-setup.html" title="Chapter 12. Network Setup" /><link rel="prev" href="topology-req.html" title="12.7. Topology Requirements" /><link rel="next" href="set-zone-vlan-run-vm-max.html" title="12.9. Setting Zone VLAN and Running VM Maximums" /></head><body><p id="title"><a class="left" href="http://cloudstack.org"><img src="Common_Content/images/image_left.png" alt="Product Site" /></a><a class="right" href="http://docs.cloudstack.org"><img src="Common_Content/images/image_right.png" alt="Documentation Site" /></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="topology-req.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="set-zone-vlan-run-vm-max.html"><strong>Next</strong></a></li></ul><div xml:lang="en-US" class="section" id="guest-nw-usage-with-traffic-sentinel" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="guest-nw-usage-with-traffic-sentinel">12.8. Guest Network Usage Integration for Traffic Sentinel</h2></div></div></div><div class="para">
		To collect usage data for a guest network, CloudStack needs to pull the data from an external network statistics collector installed on the network. Metering statistics for guest networks are available through CloudStack’s integration with inMon Traffic Sentinel.
	</div><div class="para">
		Traffic Sentinel is a network traffic usage data collection package. CloudStack can feed statistics from Traffic Sentinel into its own usage records, providing a basis for billing users of cloud infrastructure. Traffic Sentinel uses the traffic monitoring protocol sFlow. Routers and switches generate sFlow records and provide them for collection by Traffic Sentinel, then CloudStack queries the Traffic Sentinel database to obtain this information
	</div><div class="para">
		To construct the query, CloudStack determines what guest IPs were in use during the current query interval. This includes both newly assigned IPs and IPs that were assigned in a previous time period and continued to be in use. CloudStack queries Traffic Sentinel for network statistics that apply to these IPs during the time period they remained allocated in CloudStack. The returned data is correlated with the customer account that owned each IP and the timestamps when IPs were assigned and released in order to create billable metering records in CloudStack. When the Usage Server runs, it collects this data.
	</div><div class="para">
		To set up the integration between CloudStack and Traffic Sentinel:
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				On your network infrastructure, install Traffic Sentinel and configure it to gather traffic data. For installation and configuration steps, see inMon documentation at <a href="http://inmon.com.">Traffic Sentinel Documentation</a>.
			</div></li><li class="listitem"><div class="para">
				In the Traffic Sentinel UI, configure Traffic Sentinel to accept script querying from guest users. CloudStack will be the guest user performing the remote queries to gather network usage for one or more IP addresses.
			</div><div class="para">
				Click File &gt; Users &gt; Access Control &gt; Reports Query, then select Guest from the drop-down list.
			</div></li><li class="listitem"><div class="para">
				On CloudStack, add the Traffic Sentinel host by calling the CloudStack API command addTrafficMonitor. Pass in the URL of the Traffic Sentinel as protocol + host + port (optional); for example, http://10.147.28.100:8080. For the addTrafficMonitor command syntax, see the API Reference at <a href="http://incubator.apache.org/cloudstack/docs/api/index.html">API Documentation</a>.
			</div><div class="para">
				For information about how to call the CloudStack API, see the Developer’s Guide at <a href="http://incubator.apache.org/cloudstack/docs/en-US/Apache_CloudStack/4.0.0-incubating/html/API_Developers_Guide/index.html">CloudStack API Developer's Guide</a>.
			</div></li><li class="listitem"><div class="para">
				Log in to the CloudStack UI as administrator.
			</div></li><li class="listitem"><div class="para">
				Select Configuration from the Global Settings page, and set the following:
			</div><div class="para">
				direct.network.stats.interval: How often you want CloudStack to query Traffic Sentinel.
			</div></li></ol></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="topology-req.html"><strong>Prev</strong>12.7. Topology Requirements</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="set-zone-vlan-run-vm-max.html"><strong>Next</strong>12.9. Setting Zone VLAN and Running VM Maximums</a></li></ul></body></html>
