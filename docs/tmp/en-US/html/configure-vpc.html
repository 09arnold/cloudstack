<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>15.19. Configuring a Virtual Private Cloud</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 2.8" /><meta name="package" content="Apache_CloudStack-Admin_Guide-4.0.0-incubating-en-US-1-" /><link rel="home" href="index.html" title="CloudStack Administrator's Guide" /><link rel="up" href="networks.html" title="Chapter 15. Managing Networks and Traffic" /><link rel="prev" href="inter-vlan-routing.html" title="15.18. About Inter-VLAN Routing" /><link rel="next" href="working-with-system-vm.html" title="Chapter 16. Working with System Virtual Machines" /></head><body><p id="title"><a class="left" href="http://cloudstack.org"><img src="Common_Content/images/image_left.png" alt="Product Site" /></a><a class="right" href="http://docs.cloudstack.org"><img src="Common_Content/images/image_right.png" alt="Documentation Site" /></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="inter-vlan-routing.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="working-with-system-vm.html"><strong>Next</strong></a></li></ul><div xml:lang="en-US" class="section" id="configure-vpc" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="configure-vpc">15.19. Configuring a Virtual Private Cloud</h2></div></div></div><div xml:lang="en-US" class="section" id="vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="vpc">15.19.1. About Virtual Private Clouds</h3></div></div></div><div class="para">
		CloudStack Virtual Private Cloud is a private, isolated part of CloudStack. A VPC can have its own virtual network topology that resembles a traditional physical network. You can launch VMs in the virtual network that can have private addresses in the range of your choice, for example: 10.0.0.0/16. You can define network tiers within your VPC network range, which in turn enables you to group similar kinds of instances based on IP address range.
	</div><div class="para">
		For example, if a VPC has the private range 10.0.0.0/16, its guest networks can have the network ranges 10.0.1.0/24, 10.0.2.0/24, 10.0.3.0/24, and so on.
	</div><div class="formalpara"><h5 class="formalpara" id="idp22264960">Major Components of a VPC:</h5>
			A VPC is comprised of the following network components:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				<span class="bold bold"><strong>VPC</strong></span>: A VPC acts as a container for multiple isolated networks that can communicate with each other via its virtual router.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Network Tiers</strong></span>: Each tier acts as an isolated network with its own VLANs and CIDR list, where you can place groups of resources, such as VMs. The tiers are segmented by means of VLANs. The NIC of each tier acts as its gateway.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Virtual Router</strong></span>: A virtual router is automatically created and started when you create a VPC. The virtual router connect the tiers and direct traffic among the public gateway, the VPN gateways, and the NAT instances. For each tier, a corresponding NIC and IP exist in the virtual router. The virtual router provides DNS and DHCP services through its IP.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Public Gateway</strong></span>: The traffic to and from the Internet routed to the VPC through the public gateway. In a VPC, the public gateway is not exposed to the end user; therefore, static routes are not support for the public gateway.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Private Gateway</strong></span>: All the traffic to and from a private network routed to the VPC through the private gateway. For more information, see <a class="xref" href="configure-vpc.html#add-gateway-vpc">Section 15.19.5, “Adding a Private Gateway to a VPC”</a>.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>VPN Gateway</strong></span>: The VPC side of a VPN connection.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Site-to-Site VPN Connection</strong></span>: A hardware-based VPN connection between your VPC and your datacenter, home network, or co-location facility. For more information, see <a class="xref" href="vpn.html#site-to-site-vpn">Section 15.17.4, “Setting Up a Site-to-Site VPN Connection”</a>.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>Customer Gateway</strong></span>: The customer side of a VPN Connection. For more information, see <a class="xref" href="vpn.html#create-vpn-customer-gateway">Section 15.17.4.1, “Creating and Updating a VPN Customer Gateway”</a>.
			</div></li><li class="listitem"><div class="para">
				<span class="bold bold"><strong>NAT Instance</strong></span>: An instance that provides Port Address Translation for instances to access the Internet via the public gateway. For more information, see <a class="xref" href="configure-vpc.html#enable-disable-static-nat-vpc">Section 15.19.9, “Enabling or Disabling Static NAT on a VPC”</a>.
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idp20947848">Network Architecture in a VPC</h5>
			In a VPC, the following four basic options of network architectures are present:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				VPC with a public gateway only
			</div></li><li class="listitem"><div class="para">
				VPC with public and private gateways
			</div></li><li class="listitem"><div class="para">
				VPC with public and private gateways and site-to-site VPN access
			</div></li><li class="listitem"><div class="para">
				VPC with a private gateway only and site-to-site VPN access
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idp39595544">Connectivity Options for a VPC</h5>
			You can connect your VPC to:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				The Internet through the public gateway.
			</div></li><li class="listitem"><div class="para">
				The corporate datacenter by using a site-to-site VPN connection through the VPN gateway.
			</div></li><li class="listitem"><div class="para">
				Both the Internet and your corporate datacenter by using both the public gateway and a VPN gateway.
			</div></li></ul></div><div class="formalpara"><h5 class="formalpara" id="idp18549888">VPC Network Considerations</h5>
			Consider the following before you create a VPC:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				A VPC, by default, is created in the enabled state.
			</div></li><li class="listitem"><div class="para">
				A VPC can be created in Advance zone only, and can't belong to more than one zone at a time.
			</div></li><li class="listitem"><div class="para">
				The default number of VPCs an account can create is 20. However, you can change it by using the max.account.vpcs global parameter, which controls the maximum number of VPCs an account is allowed to create.
			</div></li><li class="listitem"><div class="para">
				The default number of tiers an account can create within a VPC is 3. You can configure this number by using the vpc.max.networks parameter.
			</div></li><li class="listitem"><div class="para">
				Each tier should have an unique CIDR in the VPC. Ensure that the tier's CIDR should be within the VPC CIDR range.
			</div></li><li class="listitem"><div class="para">
				A tier belongs to only one VPC.
			</div></li><li class="listitem"><div class="para">
				All network tiers inside the VPC should belong to the same account.
			</div></li><li class="listitem"><div class="para">
				When a VPC is created, by default, a SourceNAT IP is allocated to it. The Source NAT IP is released only when the VPC is removed.
			</div></li><li class="listitem"><div class="para">
				A public IP can be used for only one purpose at a time. If the IP is a sourceNAT, it cannot be used for StaticNAT or port forwarding.
			</div></li><li class="listitem"><div class="para">
				The instances only have a private IP address that you provision. To communicate with the Internet, enable NAT to an instance that you launch in your VPC.
			</div></li><li class="listitem"><div class="para">
				Only new networks can be added to a VPC. The maximum number of networks per VPC is limited by the value you specify in the vpc.max.networks parameter. The default value is three.
			</div></li><li class="listitem"><div class="para">
				The load balancing service can be supported by only one tier inside the VPC.
			</div></li><li class="listitem"><div class="para">
				If an IP address is assigned to a tier:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						That IP can't be used by more than one tier at a time in the VPC. For example, if you have tiers A and B, and a public IP1, you can create a port forwarding rule by using the IP either for A or B, but not for both.
					</div></li><li class="listitem"><div class="para">
						That IP can't be used for StaticNAT, load balancing, or port forwarding rules for another guest network inside the VPC.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Remote access VPN is not supported in VPC networks.
			</div></li></ul></div></div><div xml:lang="en-US" class="section" id="add-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-vpc">15.19.2. Adding a Virtual Private Cloud</h3></div></div></div><div class="para">
		When creating the VPC, you simply provide the zone and a set of IP addresses for the VPC network address space. You specify this set of addresses in the form of a Classless Inter-Domain Routing (CIDR) block.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div></li><li class="listitem"><div class="para">
				Click Add VPC. The Add VPC page is displayed as follows:
			</div><div class="mediaobject"><img src="./images/add-vpc.png" alt="add-vpc.png: adding a vpc." /></div><div class="para">
				Provide the following information:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: A short name for the VPC that you are creating.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Description</strong></span>: A brief description of the VPC.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Zone</strong></span>: Choose the zone where you want the VPC to be available.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Super CIDR for Guest Networks</strong></span>: Defines the CIDR range for all the tiers (guest networks) within a VPC. When you create a tier, ensure that its CIDR is within the Super CIDR value you enter. The CIDR must be RFC1918 compliant.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>DNS domain for Guest Networks</strong></span>: If you want to assign a special domain name, specify the DNS suffix. This parameter is applied to all the tiers within the VPC. That implies, all the tiers you create in the VPC belong to the same DNS domain. If the parameter is not specified, a DNS domain name is generated automatically.
					</div></li></ul></div></li></ol></div></div><div xml:lang="en-US" class="section" id="add-tier" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-tier">15.19.3. Adding Tiers</h3></div></div></div><div class="para">
		Tiers are distinct locations within a VPC that act as isolated networks, which do not have access to other tiers by default. Tiers are set up on different VLANs that can communicate with each other by using a virtual router. Tiers provide inexpensive, low latency network connectivity to other tiers within the VPC.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPC that you have created for the account is listed in the page.
			</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					The end users can see their own VPCs, while root and domain admin can see any VPC they are authorized to see.
				</div></div></div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC for which you want to set up tiers.
			</div><div class="para">
				The Add new tier dialog is displayed, as follows:
			</div><div class="mediaobject"><img src="./images/add-tier.png" alt="add-tier.png: adding a tier to a vpc." /></div><div class="para">
				If you have already created tiers, the VPC diagram is displayed. Click Create Tier to add a new tier.
			</div></li><li class="listitem"><div class="para">
				Specify the following:
			</div><div class="para">
				All the fields are mandatory.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: A unique name for the tier you create.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Network Offering</strong></span>: The following default network offerings are listed: DefaultIsolatedNetworkOfferingForVpcNetworksNoLB, DefaultIsolatedNetworkOfferingForVpcNetworks
					</div><div class="para">
						In a VPC, only one tier can be created by using LB-enabled network offering.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Gateway</strong></span>: The gateway for the tier you create. Ensure that the gateway is within the Super CIDR range that you specified while creating the VPC, and is not overlapped with the CIDR of any existing tier within the VPC.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Netmask</strong></span>: The netmask for the tier you create.
					</div><div class="para">
						For example, if the VPC CIDR is 10.0.0.0/16 and the network tier CIDR is 10.0.1.0/24, the gateway of the tier is 10.0.1.1, and the netmask of the tier is 255.255.255.0.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Click OK.
			</div></li><li class="listitem"><div class="para">
				Continue with configuring access control list for the tier.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="configure-acl" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="configure-acl">15.19.4. Configuring Access Control List</h3></div></div></div><div class="para">
		Define Network Access Control List (ACL) on the VPC virtual router to control incoming (ingress) and outgoing (egress) traffic between the VPC tiers, and the tiers and Internet. By default, all incoming and outgoing traffic to the guest networks is blocked. To open the ports, you must create a new network ACL. The network ACLs can be created for the tiers only if the NetworkACL service is supported.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select Network ACLs.
			</div><div class="para">
				The Network ACLs page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click Add Network ACLs.
			</div><div class="para">
				To add an ACL rule, fill in the following fields to specify what kind of network traffic is allowed in this tier.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>CIDR</strong></span>: The CIDR acts as the Source CIDR for the Ingress rules, and Destination CIDR for the Egress rules. To accept traffic only from or to the IP addresses within a particular address block, enter a CIDR or a comma-separated list of CIDRs. The CIDR is the base IP address of the incoming traffic. For example, 192.168.0.0/22. To allow all CIDRs, set to 0.0.0.0/0.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol</strong></span>: The networking protocol that sources use to send traffic to the tier. The TCP and UDP protocols are typically used for data exchange and end-user communications. The ICMP protocol is typically used to send error messages or network monitoring data.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Start Port</strong></span>, <span class="bold bold"><strong>End Port</strong></span> (TCP, UDP only): A range of listening ports that are the destination for the incoming traffic. If you are opening a single port, use the same number in both fields.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Select Tier</strong></span>: Select the tier for which you want to add this ACL rule.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>ICMP Type</strong></span>, <span class="bold bold"><strong>ICMP Code</strong></span> (ICMP only): The type of message and error code that will be sent.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Traffic Type</strong></span>: Select the traffic type you want to apply.
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								<span class="bold bold"><strong>Egress</strong></span>: To add an egress rule, select Egress from the Traffic type drop-down box and click Add. This specifies what type of traffic is allowed to be sent out of VM instances in this tier. If no egress rules are specified, all traffic from the tier is allowed out at the VPC virtual router. Once egress rules are specified, only the traffic specified in egress rules and the responses to any traffic that has been allowed in through an ingress rule are allowed out. No egress rule is required for the VMs in a tier to communicate with each other.
							</div></li><li class="listitem"><div class="para">
								<span class="bold bold"><strong>Ingress</strong></span>: To add an ingress rule, select Ingress from the Traffic type drop-down box and click Add. This specifies what network traffic is allowed into the VM instances in this tier. If no ingress rules are specified, then no traffic will be allowed in, except for responses to any traffic that has been allowed out through an egress rule.
							</div></li></ul></div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
							By default, all incoming and outgoing traffic to the guest networks is blocked. To open the ports, create a new network ACL.
						</div></div></div></li></ul></div></li><li class="listitem"><div class="para">
				Click Add. The ACL rule is added.
			</div><div class="para">
				To view the list of ACL rules you have added, click the desired tier from the Network ACLs page, then select the Network ACL tab.
			</div><div class="mediaobject"><img src="./images/network-acl.png" width="444" alt="network-acl.png: adding, editing, deleting an ACL rule." /></div><div class="para">
				You can edit the tags assigned to the ACL rules and delete the ACL rules you have created. Click the appropriate button in the Actions column.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="add-gateway-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-gateway-vpc">15.19.5. Adding a Private Gateway to a VPC</h3></div></div></div><div class="para">
		A private gateway can be added by the root admin only. The VPC private network has 1:1 relationship with the NIC of the physical network. No gateways with duplicated VLAN and IP are allowed in the same data center.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to configure load balancing rules.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Private Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select Private Gateways.
			</div><div class="para">
				The Gateways page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click Add new gateway:
			</div><div class="mediaobject"><img src="./images/add-new-gateway-vpc.png" alt="add-new-gateway-vpc.png: adding a private gateway for the VPC." /></div></li><li class="listitem"><div class="para">
				Specify the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Physical Network</strong></span>: The physical network you have created in the zone.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>IP Address</strong></span>: The IP address associated with the VPC gateway.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Gateway</strong></span>: The gateway through which the traffic is routed to and from the VPC.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Netmask</strong></span>: The netmask associated with the VPC gateway.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>VLAN</strong></span>: The VLAN associated with the VPC gateway.
					</div></li></ul></div><div class="para">
				The new gateway appears in the list. You can repeat these steps to add more gateway for this VPC.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="add-vm-to-tier" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-vm-to-tier">15.19.6. Deploying VMs to the Tier</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed.
			</div></li><li class="listitem"><div class="para">
				Click the Add VM button of the tier for which you want to add a VM.
			</div><div class="para">
				The Add Instance page is displayed.
			</div><div class="para">
				Follow the on-screen instruction to add an instance. For information on adding an instance, see Adding Instances section in the Installation Guide.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="acquire-new-ip-for-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="acquire-new-ip-for-vpc">15.19.7. Acquiring a New IP Address for a VPC</h3></div></div></div><div class="para">
		When you acquire an IP address, all IP addresses are allocated to VPC, not to the guest networks within the VPC. The IPs are associated to the guest network only when the first port-forwarding, load balancing, or Static NAT rule is created for the IP or the network. IP can't be associated to more than one network at a time.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select IP Addresses.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click Acquire New IP, and click Yes in the confirmation dialog.
			</div><div class="para">
				You are prompted for confirmation because, typically, IP addresses are a limited resource. Within a few moments, the new IP address should appear with the state Allocated. You can now use the IP address in port forwarding, load balancing, and static NAT rules.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="release-ip-for-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="release-ip-for-vpc">15.19.8. Releasing an IP Address Alloted to a VPC</h3></div></div></div><div class="para">
		The IP address is a limited resource. If you no longer need a particular IP, you can disassociate it from its VPC and return it to the pool of available addresses. An IP address can be released from its tier, only when all the networking ( port forwarding, load balancing, or StaticNAT ) rules are removed for this IP address. The released IP address will still belongs to the same VPC.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC whose IP you want to release.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select IP Addresses.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click the IP you want to release.
			</div></li><li class="listitem"><div class="para">
				In the Details tab, click the Release IP button 
				<span class="inlinemediaobject"><img src="./images/release-ip-icon.png" alt="release-ip-icon.png: button to release an IP." /></span>
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="enable-disable-static-nat-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="enable-disable-static-nat-vpc">15.19.9. Enabling or Disabling Static NAT on a VPC</h3></div></div></div><div class="para">
		A static NAT rule maps a public IP address to the private IP address of a VM in a VPC to allow Internet traffic to it. This section tells how to enable or disable static NAT for a particular IP address in a VPC.
	</div><div class="para">
		If port forwarding rules are already in effect for an IP address, you cannot enable static NAT to that IP.
	</div><div class="para">
		If a guest VM is part of more than one network, static NAT rules will function only if they are defined on the default network.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select IP Addresses.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click the IP you want to work with.
			</div></li><li class="listitem"><div class="para">
				In the Details tab,click the Static NAT button.
				<span class="inlinemediaobject"><img src="./images/enable-disable.png" alt="enable-disable.png: button to enable Statid NAT." /></span>
				The button toggles between Enable and Disable, depending on whether static NAT is currently enabled for the IP address.
			</div></li><li class="listitem"><div class="para">
				If you are enabling static NAT, a dialog appears as follows:
			</div><div class="mediaobject"><img src="./images/select-vm-staticnat-vpc.png" width="444" alt="select-vmstatic-nat.png: selecting a tier to apply staticNAT." /></div></li><li class="listitem"><div class="para">
				Select the tier and the destination VM, then click Apply.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="add-loadbalancer-rule-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-loadbalancer-rule-vpc">15.19.10. Adding Load Balancing Rules on a VPC</h3></div></div></div><div class="para">
		A CloudStack user or administrator may create load balancing rules that balance traffic received at a public IP to one or more VMs that belong to a network tier that provides load balancing service in a VPC. A user creates a rule, specifies an algorithm, and assigns the rule to a set of VMs within a VPC.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to configure load balancing rules.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Select IP Addresses.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click the IP address for which you want to create the rule, then click the Configuration tab.
			</div></li><li class="listitem"><div class="para">
				In the Load Balancing node of the diagram, click View All.
			</div></li><li class="listitem"><div class="para">
				Select the tier to which you want to apply the rule.
			</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					In a VPC, the load balancing service is supported only on a single tier.
				</div></div></div></li><li class="listitem"><div class="para">
				Specify the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Name</strong></span>: A name for the load balancer rule.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public Port</strong></span>: The port that receives the incoming traffic to be balanced.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Private Port</strong></span>: The port that the VMs will use to receive the traffic.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Algorithm</strong></span>. Choose the load balancing algorithm you want CloudStack to use. CloudStack supports the following well-known algorithms:
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								Round-robin
							</div></li><li class="listitem"><div class="para">
								Least connections
							</div></li><li class="listitem"><div class="para">
								Source
							</div></li></ul></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Stickiness</strong></span>. (Optional) Click Configure and choose the algorithm for the stickiness policy. See Sticky Session Policies for Load Balancer Rules.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Add VMs</strong></span>: Click Add VMs, then select two or more VMs that will divide the load of incoming traffic, and click Apply.
					</div></li></ul></div></li></ol></div><div class="para">
		The new load balancing rule appears in the list. You can repeat these steps to add more load balancing rules for this IP address.
	</div></div><div xml:lang="en-US" class="section" id="add-portforward-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="add-portforward-vpc">15.19.11. Adding a Port Forwarding Rule on a VPC</h3></div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC to which you want to deploy the VMs.
			</div><div class="para">
				The VPC page is displayed where all the tiers you created are listed in a diagram.
			</div></li><li class="listitem"><div class="para">
				Click the Settings icon.
			</div><div class="para">
				The following options are displayed.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						IP Addresses
					</div></li><li class="listitem"><div class="para">
						Gateways
					</div></li><li class="listitem"><div class="para">
						Site-to-Site VPN
					</div></li><li class="listitem"><div class="para">
						Network ACLs
					</div></li></ul></div></li><li class="listitem"><div class="para">
				Choose an existing IP address or acquire a new IP address. Click the name of the IP address in the list.
			</div><div class="para">
				The IP Addresses page is displayed.
			</div></li><li class="listitem"><div class="para">
				Click the IP address for which you want to create the rule, then click the Configuration tab.
			</div></li><li class="listitem"><div class="para">
				In the Port Forwarding node of the diagram, click View All.
			</div></li><li class="listitem"><div class="para">
				Select the tier to which you want to apply the rule.
			</div></li><li class="listitem"><div class="para">
				Specify the following:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Public Port</strong></span>: The port to which public traffic will be addressed on the IP address you acquired in the previous step.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Private Port</strong></span>: The port on which the instance is listening for forwarded public traffic.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Protocol</strong></span>: The communication protocol in use between the two ports.
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								TCP
							</div></li><li class="listitem"><div class="para">
								UDP
							</div></li></ul></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>Add VM</strong></span>: Click Add VM. Select the name of the instance to which this rule applies, and click Apply.
					</div><div class="para">
						You can test the rule by opening an ssh session to the instance.
					</div></li></ul></div></li></ol></div></div><div xml:lang="en-US" class="section" id="remove-tier" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="remove-tier">15.19.12. Removing Tiers</h3></div></div></div><div class="para">
		You can remove a tier from a VPC. A removed tier cannot be revoked. When a tier is removed, only the resources of the tier are expunged. All the network rules (port forwarding, load balancing and staticNAT) and the IP addresses associated to the tier are removed. The IP address still be belonging to the same VPC.
	</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPC that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Click the Configure button of the VPC for which you want to set up tiers.
			</div><div class="para">
				The Configure VPC page is displayed. Locate the tier you want to work with.
			</div></li><li class="listitem"><div class="para">
				Click the Remove VPC button:
			</div><div class="mediaobject"><img src="./images/remove-tier.png" alt="remove-tier.png: removing a tier from a vpc." /></div><div class="para">
				Wait for some time for the tier to be removed.
			</div></li></ol></div></div><div xml:lang="en-US" class="section" id="remove-vpc" lang="en-US"><div class="titlepage"><div><div><h3 class="title" id="remove-vpc">15.19.13. Editing, Restarting, and Removing a Virtual Private Cloud</h3></div></div></div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			Ensure that all the tiers are removed before you remove a VPC.
		</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
				Log in to the CloudStack UI as an administrator or end user.
			</div></li><li class="listitem"><div class="para">
				In the left navigation, choose Network.
			</div></li><li class="listitem"><div class="para">
				In the Select view, select VPC.
			</div><div class="para">
				All the VPCs that you have created for the account is listed in the page.
			</div></li><li class="listitem"><div class="para">
				Select the VPC you want to work with.
			</div></li><li class="listitem"><div class="para">
				To remove, click the Remove VPC button
				<span class="inlinemediaobject"><img src="./images/remove-vpc.png" alt="remove-vpc.png: button to remove a VPC" /></span>
			</div><div class="para">
				You can edit the name and description of a VPC. To do that, select the VPC, then click the Edit button. 
				<span class="inlinemediaobject"><img src="./images/edit-icon.png" alt="edit-icon.png: button to edit a VPC" /></span>
			</div><div class="para">
				To restart a VPC, select the VPC, then click the Restart button.
				<span class="inlinemediaobject"><img src="./images/restart-vpc.png" alt="restart-vpc.png: button to restart a VPC" /></span>
			</div></li></ol></div></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="inter-vlan-routing.html"><strong>Prev</strong>15.18. About Inter-VLAN Routing</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="working-with-system-vm.html"><strong>Next</strong>Chapter 16. Working with System Virtual Machines</a></li></ul></body></html>
